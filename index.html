<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>FAMILIADA - TABLICA RETRO</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root { --gold: #ffcc00; --blue: #0044ff; --bg: #050505; }
        body { 
            background: var(--bg); 
            background: radial-gradient(circle, #1a1a1a 0%, #000 100%);
            color: var(--gold); 
            font-family: 'VT323', monospace; 
            margin: 0; padding: 0; 
            overflow: hidden; height: 100vh; 
            text-transform: uppercase;
        }

        /* Poświata boczna dla drużyn */
        body::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 5px; background: var(--blue); box-shadow: 0 0 50px var(--blue); }
        body::after { content: ''; position: absolute; right: 0; top: 0; bottom: 0; width: 5px; background: #ff0000; box-shadow: 0 0 50px #ff0000; }

        #unlocker { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; align-items: center; justify-content: center; }
        #unlocker button { padding: 30px 60px; font-size: 40px; background: var(--gold); border: none; cursor: pointer; font-family: 'VT323'; border-radius: 10px; }

        #media-layer { position: fixed; inset: 0; z-index: 1000; display: none; background: #000; }
        video { width: 100%; height: 100%; object-fit: contain; }

        /* GŁÓWNA TABLICA */
        .container { display: none; flex-direction: column; height: 100vh; padding: 20px 60px; box-sizing: border-box; }
        
        .header { display: flex; justify-content: space-between; align-items: center; height: 20vh; margin-bottom: 20px; }
        .team { text-align: center; width: 250px; }
        .team-name { font-size: 40px; color: #fff; margin-bottom: 5px; }
        .team-score { font-size: 100px; line-height: 1; background: #111; border: 4px solid #333; padding: 10px; min-width: 120px; }

        .main-score-box { text-align: center; }
        .main-score-label { font-size: 30px; color: #888; }
        .main-score-val { font-size: 140px; color: #fff; text-shadow: 0 0 30px var(--gold); line-height: 1; }

        /* RAMA TABLICY */
        .board-frame { 
            flex-grow: 1; 
            background: #000; 
            border: 10px solid #222; 
            border-radius: 30px; 
            padding: 30px; 
            display: flex; 
            flex-direction: column; 
            box-shadow: inset 0 0 100px #111;
        }

        .row { 
            display: flex; 
            align-items: center; 
            height: 11vh; 
            margin-bottom: 10px; 
            background: #080808; 
            border-bottom: 2px solid #1a1a1a;
            font-size: 8vh; 
            position: relative;
        }
        .row-num { width: 80px; color: #333; text-align: center; border-right: 4px solid #111; }
        .row-content { flex-grow: 1; display: flex; justify-content: space-between; padding: 0 30px; position: relative; }
        
        .row-text { color: #fff; display: none; }
        .row-pts { color: var(--gold); display: none; }
        .dots { color: #111; position: absolute; left: 30px; letter-spacing: 15px; z-index: 0; }

        .revealed .row-text, .revealed .row-pts { display: block; z-index: 1; }
        .revealed .dots { display: none; }

        /* FINAŁ */
        #final-grid { display: none; grid-template-columns: 1fr 1fr; gap: 40px; height: 100%; }
        .final-col { display: flex; flex-direction: column; gap: 10px; }

        /* STRIKE (X) */
        #strike-overlay { 
            position: fixed; inset: 0; display: none; 
            align-items: center; justify-content: center; 
            z-index: 2000; pointer-events: none; 
        }
        .big-x { font-size: 40vh; color: #ff0000; text-shadow: 0 0 50px #ff0000, 5px 5px 0 white; font-weight: bold; }

        #timer { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); font-size: 60px; color: red; display: none; }
    </style>
</head>
<body>

    <div id="unlocker"><button onclick="startTV()">KLIKNIJ, ABY AKTYWOWAĆ SYSTEM</button></div>
    <div id="media-layer"><video id="v-player"></video></div>
    <div id="strike-overlay"><div class="big-x" id="x-txt">X</div></div>
    <div id="timer">0</div>

    <div class="container" id="board-ui">
        <div class="header">
            <div class="team">
                <div class="team-name" id="t1-n">DRUŻYNA A</div>
                <div class="team-score" id="t1-s">0</div>
            </div>
            <div class="main-score-box">
                <div class="main-score-label">SUMA</div>
                <div class="main-score-val" id="total-s">0</div>
            </div>
            <div class="team">
                <div class="team-name" id="t2-n">DRUŻYNA B</div>
                <div class="team-score" id="t2-s">0</div>
            </div>
        </div>

        <div class="board-frame">
            <div id="normal-grid"></div>
            <div id="final-grid">
                <div class="final-col" id="fc1"></div>
                <div class="final-col" id="fc2"></div>
            </div>
        </div>
    </div>

    <audio id="snd-ok" src="ok.mp3"></audio>
    <audio id="snd-zla" src="zla.mp3"></audio>
    <audio id="snd-intro" src="intro.mp3"></audio>
    <audio id="snd-runda" src="runda.mp3"></audio>
    <audio id="snd-final" src="final.mp3"></audio>

    <script>
        const peer = new Peer();
        function startTV() {
            document.getElementById('unlocker').style.display = 'none';
            document.getElementById('board-ui').style.display = 'flex';
        }

        peer.on('open', id => console.log("ID: " + id));

        peer.on('connection', conn => {
            conn.on('data', data => {
                if(data.type === 'INTRO') {
                    const v = document.getElementById('v-player');
                    const l = document.getElementById('media-layer');
                    document.getElementById('snd-intro').play();
                    v.src = 'czolowka.mp4'; l.style.display = 'block'; v.play();
                    v.onended = () => l.style.display = 'none';
                }

                if(data.type === 'SETUP') {
                    document.getElementById('snd-runda').play();
                    document.getElementById('normal-grid').style.display = 'block';
                    document.getElementById('final-grid').style.display = 'none';
                    const g = document.getElementById('normal-grid'); g.innerHTML = '';
                    data.ans.forEach((a, i) => {
                        g.innerHTML += `
                        <div class="row" id="r-${i}">
                            <div class="row-num">${i+1}</div>
                            <div class="row-content">
                                <div class="dots">................................</div>
                                <div class="row-text">${a.t}</div>
                                <div class="row-pts">${a.p}</div>
                            </div>
                        </div>`;
                    });
                }

                if(data.type === 'REV') {
                    document.getElementById('snd-ok').play();
                    document.getElementById('r-'+data.idx).classList.add('revealed');
                }

                if(data.type === 'STRIKE') {
                    document.getElementById('snd-zla').play();
                    const ov = document.getElementById('strike-overlay');
                    document.getElementById('x-txt').innerText = "X".repeat(data.num);
                    ov.style.display = 'flex';
                    setTimeout(() => ov.style.display = 'none', 1500);
                }

                if(data.type === 'SCORE') {
                    document.getElementById('t1-s').innerText = data.s1;
                    document.getElementById('t2-s').innerText = data.s2;
                    document.getElementById('total-s').innerText = data.sum;
                }

                if(data.type === 'NAMES') {
                    document.getElementById('t1-n').innerText = data.n1;
                    document.getElementById('t2-n').innerText = data.n2;
                }

                if(data.type === 'FINAL_MODE') {
                    document.getElementById('snd-final').play();
                    document.getElementById('normal-grid').style.display = 'none';
                    document.getElementById('final-grid').style.display = 'grid';
                    const c1 = document.getElementById('fc1'); const c2 = document.getElementById('fc2');
                    c1.innerHTML = ''; c2.innerHTML = '';
                    for(let i=0; i<5; i++) {
                        c1.innerHTML += `<div class="row" style="height:7vh"><div class="row-content"><div class="row-text" id="f1t-${i}" style="display:none">--</div><div class="row-pts" id="f1p-${i}" style="display:none">0</div></div></div>`;
                        c2.innerHTML += `<div class="row" style="height:7vh"><div class="row-content"><div class="row-text" id="f2t-${i}" style="display:none">--</div><div class="row-pts" id="f2p-${i}" style="display:none">0</div></div></div>`;
                    }
                }

                if(data.type === 'FINAL_REV') {
                    document.getElementById('snd-ok').play();
                    const t = document.getElementById(`f${data.p}t-${data.i}`);
                    const p = document.getElementById(`f${data.p}p-${data.i}`);
                    t.innerText = data.txt; p.innerText = data.pts;
                    t.style.display = 'block'; p.style.display = 'block';
                }
            });
        });
    </script>
</body>
</html>
