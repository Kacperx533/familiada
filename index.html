<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Pilot</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { background: #222; color: white; font-family: sans-serif; padding: 20px; }
        input, button { padding: 10px; margin: 5px; width: 100%; box-sizing: border-box; }
        button { background: #444; color: #fff; border: 1px solid #666; cursor: pointer; }
        .active { background: #0a0; }
        .row-c { display: flex; gap: 5px; margin-bottom: 5px; }
    </style>
</head>
<body>
    <input id="targetId" placeholder="Wpisz krótki kod z TV (np. A1B2)">
    <button onclick="connect()">POŁĄCZ</button>
    <hr>
    <h3>1. Ustawienia</h3>
    <textarea id="csv" rows="4" style="width:100%">ŚLĄSK,36
KASZUBY,27
PODHALE,17</textarea>
    <button onclick="setup()">WYŚLIJ NA TABLICĘ</button>
    
    <h3>2. Gra</h3>
    <div id="buttons"></div>
    <hr>
    <button onclick="sendX(1)" style="background:#a00">X</button>
    <button onclick="sendX(2)" style="background:#a00">XX</button>
    <button onclick="sendX(3)" style="background:#a00">XXX</button>
    <br>
    Suma: <input type="number" id="score" value="0" onchange="upScore()">

    <script>
        const peer = new Peer();
        let conn;
        let answers = [];

        function connect() {
            conn = peer.connect(document.getElementById('targetId').value.toUpperCase());
            conn.on('open', () => alert("Połączono!"));
        }

        function setup() {
            const lines = document.getElementById('csv').value.split('\n');
            answers = lines.map(l => { const p = l.split(','); return {t: p[0], p: p[1] || 0}; });
            conn.send({ type: 'SETUP', rows: answers });
            
            const div = document.getElementById('buttons');
            div.innerHTML = '';
            answers.forEach((a, i) => {
                div.innerHTML += `<div class="row-c"><span>${i+1}. ${a.t}</span><button onclick="reveal(${i})">Odkryj</button></div>`;
            });
            document.getElementById('score').value = 0;
        }

        function reveal(i) {
            conn.send({ type: 'REVEAL', index: i, text: answers[i].t, points: answers[i].p });
            let s = document.getElementById('score');
            s.value = parseInt(s.value) + parseInt(answers[i].p);
            upScore();
        }

        function sendX(n) { conn.send({ type: 'X', count: n }); }
        function upScore() { conn.send({ type: 'SCORE', val: document.getElementById('score').value }); }
    </script>
</body>
</html>
