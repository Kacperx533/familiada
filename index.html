<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>FAMILIADA TV - LED DOT MATRIX</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root { 
            --led-on: #dfff00; /* Żółto-zielony kolor LED */
            --led-off: #2a2a2a; 
            --bg-dark: #101010;
            --grid-line: #000;
        }
        
        body { 
            background-color: var(--bg-dark);
            color: var(--led-on);
            font-family: 'VT323', monospace; 
            margin: 0; 
            overflow: hidden; 
            height: 100vh; 
            text-transform: uppercase;
            /* Tło imitujące moduły tablicy (kratka konstrukcyjna) */
            background-image: 
                linear-gradient(90deg, #000 2px, transparent 2px), 
                linear-gradient(#000 2px, transparent 2px);
            background-size: 50px 50px; 
        }

        /* WARSTWA "KROPEK" - To robi efekt LED na tekście */
        .led-overlay {
            position: fixed;
            inset: 0;
            background-image: radial-gradient(circle, transparent 30%, #000 90%);
            background-size: 6px 6px; /* Rozmiar pojedynczej diody */
            pointer-events: none;
            z-index: 1000;
            opacity: 0.6;
        }

        /* POŚWIATA BOCZNA (fioletowo-niebieska jak na zdjęciu) */
        .glow-side {
            position: fixed;
            top: 0; bottom: 0;
            width: 150px;
            z-index: -1;
        }
        .glow-left { left: 0; background: linear-gradient(90deg, rgba(80,0,255,0.2), transparent); }
        .glow-right { right: 0; background: linear-gradient(-90deg, rgba(80,0,255,0.2), transparent); }

        /* GŁÓWNY KONTENER */
        .board-wrapper {
            width: 90vw;
            height: 80vh;
            margin: 10vh auto;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            position: relative;
        }

        /* WIERSZ TABLICY */
        .row { 
            display: flex; 
            align-items: center; 
            height: 12vh; /* Wysokie wiersze */
            font-size: 8vh; 
            letter-spacing: 5px; /* Odstępy jak w LED */
            text-shadow: 0 0 10px var(--led-on); /* Świecenie */
            border-bottom: 2px solid #000; /* Linia oddzielająca wiersze */
        }

        .row-num { 
            width: 80px; 
            text-align: center; 
            color: var(--led-on);
        }

        .row-txt { 
            flex-grow: 1; 
            padding-left: 20px; 
            white-space: nowrap;
            overflow: hidden;
        }

        .row-pts { 
            width: 120px; 
            text-align: right; 
            padding-right: 20px;
        }

        /* IKONA PO PRAWEJ (Ozdobnik ze zdjęcia) */
        .row-deco {
            width: 80px;
            font-size: 5vh;
            text-align: center;
            opacity: 0.7;
            color: #adff2f;
        }

        /* SUMA NA DOLE */
        .footer {
            position: absolute;
            bottom: 0;
            right: 100px;
            display: flex;
            gap: 40px;
            font-size: 9vh;
            text-shadow: 0 0 15px var(--led-on);
            letter-spacing: 5px;
        }

        /* IKSY */
        .strike-overlay {
            position: fixed;
            inset: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            pointer-events: none;
            z-index: 2000;
        }
        .strike {
            font-size: 60vh;
            color: var(--led-on);
            text-shadow: 5px 5px 0 #000, 0 0 30px var(--led-on);
            display: none;
        }

        /* UKRYWANIE ELEMENTÓW */
        .hidden-txt { display: none; }
        .dots-placeholder::after { content: "......................"; opacity: 0.5; letter-spacing: 2px; }

        /* MULTIMEDIA */
        #vid-layer { position: fixed; inset: 0; background:black; z-index:5000; display:none; }
        video { width:100%; height:100%; }
        #start-screen { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; justify-content: center; align-items: center; flex-direction: column;}
    </style>
</head>
<body>

    <div class="led-overlay"></div>
    <div class="glow-side glow-left"></div>
    <div class="glow-side glow-right"></div>

    <div id="start-screen">
        <div style="color: #dfff00; font-size: 40px; margin-bottom: 20px;">SYSTEM GOTOWY</div>
        <div id="my-id" style="color: white; font-size: 20px; font-family: sans-serif;">Generowanie ID...</div>
        <button onclick="document.getElementById('start-screen').style.display='none'" style="margin-top:20px; padding:10px 30px; font-size:20px; cursor:pointer;">URUCHOM TABLICĘ</button>
    </div>

    <div id="vid-layer"><video id="player"></video></div>

    <div class="strike-overlay">
        <div id="big-strike" class="strike">X</div>
    </div>

    <div class="board-wrapper">
        <div id="rows-container">
            </div>

        <div class="footer">
            <div>SUMA</div>
            <div id="total-sum">0</div>
        </div>
    </div>

    <audio id="snd-ok" src="ok.mp3"></audio>
    <audio id="snd-bad" src="zla.mp3"></audio>

    <script>
        const peer = new Peer();
        peer.on('open', id => document.getElementById('my-id').innerText = "Twój kod ID: " + id);

        // Funkcja generująca puste kropki, jeśli hasło jest ukryte
        function renderBoard(data) {
            const container = document.getElementById('rows-container');
            container.innerHTML = '';

            // Generujemy zawsze 5-6 wierszy, żeby tablica wyglądała na pełną (jak na zdjęciu)
            for(let i=0; i<6; i++) {
                let contentHTML = '';
                let ptsHTML = '';
                let numHTML = `<div class="row-num">${i+1}</div>`;

                // Jeśli mamy dane dla tego wiersza
                if (data.ans && data.ans[i]) {
                    const item = data.ans[i];
                    
                    if (item.revealed) {
                        // Odkryte hasło
                        contentHTML = `<div class="row-txt">${item.t}</div>`;
                        ptsHTML = `<div class="row-pts">${item.p}</div>`;
                    } else {
                        // Zakryte hasło (kropki)
                        contentHTML = `<div class="row-txt dots-placeholder"></div>`;
                        ptsHTML = `<div class="row-pts"></div>`; // Puste miejsce na punkty
                    }
                } else {
                    // Pusty wiersz (np. wiersz 5 i 6 jeśli brak pytań) - same kropki
                    numHTML = `<div class="row-num">${i+1}</div>`;
                    contentHTML = `<div class="row-txt dots-placeholder"></div>`;
                    ptsHTML = `<div class="row-pts"></div>`;
                }

                // Ozdobnik po prawej (ikona z kropek)
                const decoHTML = `<div class="row-deco">:::</div>`;

                container.innerHTML += `
                    <div class="row">
                        ${numHTML}
                        ${contentHTML}
                        ${ptsHTML}
                        ${decoHTML}
                    </div>
                `;
            }
        }

        // Domyślny stan (puste kropki)
        renderBoard({ans: []});

        let currentAns = [];

        peer.on('connection', conn => {
            conn.on('data', data => {
                
                if(data.type === 'SETUP') {
                    // Reset tablicy, wszystkie zakryte
                    currentAns = data.ans.map(a => ({...a, revealed: false}));
                    renderBoard({ans: currentAns});
                    // Reset X
                    document.getElementById('big-strike').style.display = 'none';
                    document.getElementById('total-sum').innerText = '0';
                }

                if(data.type === 'REV') {
                    document.getElementById('snd-ok').play();
                    // Odkrywamy konkretny wiersz
                    if(currentAns[data.idx]) {
                        currentAns[data.idx].revealed = true;
                        renderBoard({ans: currentAns});
                    }
                }

                if(data.type === 'SCORE') {
                    document.getElementById('total-sum').innerText = data.sum;
                }

                if(data.type === 'STRIKE') {
                    document.getElementById('snd-bad').play();
                    const el = document.getElementById('big-strike');
                    el.innerText = "X".repeat(data.n);
                    el.style.display = 'block';
                    // X znika po 2 sekundach (lub zostaje, jeśli wolisz usuń setTimeout)
                    // setTimeout(() => el.style.display = 'none', 2000); 
                }
                
                if(data.type === 'CLEAR_STRIKE') {
                    document.getElementById('big-strike').style.display = 'none';
                }

                if(data.type === 'VIDEO') {
                    const v = document.getElementById('player');
                    document.getElementById('vid-layer').style.display='block';
                    v.src = 'czolowka.mp4'; 
                    v.play();
                    v.onended = () => document.getElementById('vid-layer').style.display='none';
                }
            });
        });
    </script>
</body>
</html>
