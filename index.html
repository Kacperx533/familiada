<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>FAMILIADA - EKRAN TV</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root {
            --led-gold: #ffcc00;
            --border-blue: #0055ff;
            --border-red: #ff0044;
        }
        
        body {
            background-color: #000;
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'VT323', monospace;
            overflow: hidden;
            color: var(--led-gold);
            text-transform: uppercase;
            position: relative;
        }

        /* AMBIENT GLOW - MAKSYMALNIE W LEWO I PRAWO */
        body::before {
            content: '';
            position: absolute;
            top: 0; left: 0; bottom: 0;
            width: 45%;
            background: radial-gradient(circle at 0% 50%, rgba(0, 85, 255, 0.35), transparent 80%);
            pointer-events: none;
            z-index: 0;
        }

        body::after {
            content: '';
            position: absolute;
            top: 0; right: 0; bottom: 0;
            width: 45%;
            background: radial-gradient(circle at 100% 50%, rgba(255, 0, 68, 0.35), transparent 80%);
            pointer-events: none;
            z-index: 0;
        }

        .led-grid {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: 
                linear-gradient(rgba(15,15,15,0.4) 1px, transparent 1px),
                linear-gradient(90deg, rgba(15,15,15,0.4) 1px, transparent 1px);
            background-size: 5px 5px;
            z-index: -1;
        }

        /* EKRAN POWITALNY */
        #connect-screen {
            position: fixed; inset: 0; background: #000; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .code-display {
            font-size: 80px; border: 2px solid var(--led-gold);
            padding: 20px 40px; border-radius: 10px; box-shadow: 0 0 20px var(--led-gold);
        }

        /* CZOŁÓWKA */
        #intro-overlay {
            position: fixed; inset: 0; background: black; z-index: 20000;
            display: none; align-items: center; justify-content: center;
            flex-direction: column;
        }
        .logo-text { font-size: 180px; text-shadow: 0 0 50px gold; animation: zoom 3s infinite; }
        @keyframes zoom { 0%, 100% { transform: scale(0.9); } 50% { transform: scale(1.1); } }

        /* TABLICA */
        .game-board {
            display: none; width: 95vw; max-width: 1600px; position: relative; z-index: 10;
        }

        .round-score-box {
            width: 200px; margin: 0 auto 30px auto; text-align: center;
            font-size: 120px; color: #fff; text-shadow: 0 0 20px rgba(255,255,255,0.6);
        }

        .main-display { background: #000; min-height: 45vh; padding: 20px 80px; display: flex; flex-direction: column; justify-content: center; }

        .row { display: flex; align-items: center; font-size: 75px; margin-bottom: 20px; height: 85px; }
        .row-num { width: 80px; color: #111; margin-right: 30px; }
        .row-content { flex-grow: 1; position: relative; display: flex; justify-content: space-between; border-bottom: 1px solid #0d0d0d; }
        .dots { position: absolute; left: 0; width: 100%; letter-spacing: 15px; color: #0d0d0d; overflow: hidden; white-space: nowrap; }
        .answer-text, .points { z-index: 1; background: #000; display: none; text-shadow: 0 0 15px var(--led-gold); }

        .revealed .answer-text { display: block; padding-right: 30px; }
        .revealed .points { display: block; padding-left: 30px; color: #fff; }
        .revealed .dots { display: none; }

        .footer { margin-top: 50px; display: flex; justify-content: space-between; width: 100%; padding: 0 40px; box-sizing: border-box; }
        .strike { color: var(--border-red); font-size: 130px; text-shadow: 0 0 30px red; line-height: 0.6; }
        .total-val { font-size: 110px; color: #fff; text-shadow: 0 0 25px rgba(255,255,255,0.4); }

        /* WIELKIE X */
        #fullscreen-strike {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 10000;
            display: none; align-items: center; justify-content: center;
        }
        .big-x { width: 400px; height: 400px; position: relative; }
        .big-x::before, .big-x::after {
            content: ''; position: absolute; width: 100%; height: 70px;
            background: red; box-shadow: 0 0 70px red; top: 50%;
        }
        .big-x::before { transform: translateY(-50%) rotate(45deg); }
        .big-x::after { transform: translateY(-50%) rotate(-45deg); }
    </style>
</head>
<body>

    <div class="led-grid"></div>

    <div id="intro-overlay">
        <div class="logo-text">FAMILIADA</div>
        <div style="font-size: 40px; color: white;">ZAPRASZAMY!</div>
    </div>

    <div id="connect-screen">
        <div style="font-size: 24px; margin-bottom:15px; color:#555">ID SYSTEMU:</div>
        <div class="code-display" id="my-id">...</div>
        <button onclick="document.getElementById('connect-screen').style.display='none'; document.querySelector('.game-board').style.display='block';" 
            style="margin-top:30px; padding:15px 40px; cursor:pointer; font-family:'VT323'; font-size:24px;">OTWÓRZ TABLICĘ</button>
    </div>

    <div id="fullscreen-strike"><div class="big-x"></div></div>

    <div class="game-board">
        <div class="round-score-box" id="round-score">0</div>
        <div class="main-display" id="normal-rows"></div>
        <div class="footer">
            <div id="strikes-box" style="display:flex; gap:20px;"></div>
            <div class="total-score">
                <span style="font-size:40px; color:#1a1a1a;">SUMA </span>
                <span class="total-val" id="global-score">0</span>
            </div>
        </div>
    </div>

    <script>
        const peer = new Peer();
        peer.on('open', id => document.getElementById('my-id').innerText = id);

        peer.on('connection', conn => {
            conn.on('data', data => {
                if (data.type === 'MEDIA_CONTROL' && data.action === 'INTRO') {
                    const ov = document.getElementById('intro-overlay');
                    ov.style.display = 'flex';
                    setTimeout(() => ov.style.display = 'none', 5000);
                }

                if (data.type === 'SETUP_ROUND') {
                    document.getElementById('round-score').innerText = '0';
                    document.getElementById('strikes-box').innerHTML = '';
                    const container = document.getElementById('normal-rows');
                    container.innerHTML = '';
                    data.answers.forEach((ans, i) => {
                        container.innerHTML += `
                            <div class="row" id="row-${i}">
                                <div class="row-num">${i+1}</div>
                                <div class="row-content">
                                    <div class="dots">....................................................................</div>
                                    <div class="answer-text">${ans.text}</div>
                                    <div class="points">${ans.points}</div>
                                </div>
                            </div>`;
                    });
                }

                if (data.type === 'REVEAL_ANSWER') {
                    document.getElementById(`row-${data.index}`).classList.add('revealed');
                }

                if (data.type === 'STRIKE') {
                    const fs = document.getElementById('fullscreen-strike');
                    fs.style.display = 'flex';
                    setTimeout(() => fs.style.display = 'none', 1200);
                    document.getElementById('strikes-box').innerHTML += '<div class="strike">X</div>';
                }

                if (data.type === 'CLEAR_STRIKES') document.getElementById('strikes-box').innerHTML = '';

                if (data.type === 'UPDATE_SCORES') {
                    document.getElementById('round-score').innerText = data.roundScore;
                    document.getElementById('global-score').innerText = data.globalScore;
                }
            });
        });
    </script>
</body>
</html>
