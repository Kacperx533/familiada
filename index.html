<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>FAMILIADA – TABLICA TV</title>

<link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
<script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>

<style>
:root{
    --gold:#f5b041;
    --bg:#060606;
    --red:#e53935;
}

body{
    margin:0;
    background:#000;
    font-family:'VT323', monospace;
    color:var(--gold);
    text-transform:uppercase;
    overflow:hidden;
}

/* LED subtelny */
.led-bg{
    position:fixed;
    inset:0;
    background:
        radial-gradient(circle, rgba(255,200,120,.12) 1px, transparent 1px);
    background-size:5px 5px;
    pointer-events:none;
    z-index:1;
}

/* VIDEO */
#video-layer{
    position:fixed;
    inset:0;
    width:100%;
    height:100%;
    background:black;
    z-index:9000;
    display:none;
}

/* OVERLAY */
#overlay{
    position:fixed;
    inset:0;
    background:black;
    z-index:9999;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
}
#peer-id-display{
    font-size:64px;
    border:5px solid var(--gold);
    padding:25px 50px;
    border-radius:18px;
    margin-bottom:25px;
}

/* UKŁAD */
.main{
    display:flex;
    height:100vh;
    align-items:center;
    justify-content:center;
    gap:20px;
}

/* X */
.strike-zone{
    width:120px;
    display:flex;
    flex-direction:column;
    gap:25px;
}
.strike-x{
    width:90px;
    height:90px;
    position:relative;
    display:none;
    filter:drop-shadow(0 0 20px var(--red));
}
.strike-x::before,
.strike-x::after{
    content:'';
    position:absolute;
    top:45%;
    width:100%;
    height:14px;
    background:var(--red);
}
.strike-x::before{transform:rotate(45deg)}
.strike-x::after{transform:rotate(-45deg)}

/* RAMKA */
.board{
    width:80vw;
    height:85vh;
    background:var(--bg);
    border:12px solid #222;
    border-radius:28px;
    padding:35px;
    box-shadow:
        inset 0 0 80px #000,
        0 0 40px rgba(245,176,65,.35);
    display:flex;
    flex-direction:column;
    z-index:2;
}

/* WIERSZE */
#normal-ui{
    flex:1;
    display:flex;
    flex-direction:column;
    justify-content:center;
}

.row{
    display:flex;
    align-items:center;
    height:90px;
    font-size:72px;
    border-bottom:3px solid #222;
}

.row-num{
    width:70px;
    text-align:center;
    color:#555;
}

.row-content{
    flex:1;
    display:flex;
    justify-content:space-between;
    position:relative;
}

.dots{
    position:absolute;
    left:50%;
    transform:translateX(-50%);
    color:#1c1c1c;
    letter-spacing:14px;
}

.ans-text,.pts{
    display:none;
    background:var(--bg);
    padding:0 15px;
}

.revealed .ans-text,
.revealed .pts{
    display:block;
    animation:reveal .25s ease-out;
}
.revealed .dots{display:none}

@keyframes reveal{
    from{opacity:0;transform:scale(.95)}
    to{opacity:1;transform:scale(1)}
}

/* FINAŁ */
#final-ui{
    display:none;
    flex:1;
    flex-direction:column;
}

.timer{
    font-size:150px;
    text-align:center;
    color:var(--red);
    text-shadow:0 0 25px var(--red);
}

.final-cols{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:40px;
    margin-top:20px;
}

.final-slot{
    display:flex;
    align-items:center;
    height:75px;
    font-size:46px;
    border:3px solid #222;
    margin-bottom:10px;
    padding:0 12px;
}

.f-ans{flex:1;display:none}
.f-pts{width:90px;text-align:right;display:none}

.revealed .f-ans,
.revealed .f-pts{display:block}

/* STOPKA */
.footer{
    display:flex;
    justify-content:space-between;
    font-size:110px;
    border-top:5px solid #222;
    padding-top:10px;
}
</style>
</head>

<body>

<div id="overlay">
    <div id="peer-id-display">ŁADOWANIE…</div>
    <button onclick="this.parentElement.style.display='none'"
        style="font-size:40px;padding:15px 50px;font-family:'VT323';cursor:pointer">
        START
    </button>
</div>

<div class="led-bg"></div>
<video id="video-layer" playsinline></video>

<audio id="sndOk" src="ok.mp3"></audio>
<audio id="sndNo" src="zle.mp3"></audio>
<audio id="sndRunda" src="runda.mp3"></audio>
<audio id="sndFinal" src="final.mp3"></audio>
<audio id="sndBuzz" src="powtorzenie.mp3"></audio>

<div class="main">
    <div class="strike-zone">
        <div class="strike-x" id="xA1"></div>
        <div class="strike-x" id="xA2"></div>
        <div class="strike-x" id="xA3"></div>
    </div>

    <div class="board">
        <div id="normal-ui"></div>

        <div id="final-ui">
            <div class="timer" id="timer">15</div>
            <div class="final-cols">
                <div id="col-G1"></div>
                <div id="col-G2"></div>
            </div>
        </div>

        <div class="footer">
            <span>SUMA</span>
            <span id="total">0</span>
        </div>
    </div>

    <div class="strike-zone">
        <div class="strike-x" id="xB1"></div>
        <div class="strike-x" id="xB2"></div>
        <div class="strike-x" id="xB3"></div>
    </div>
</div>

<script>
const peer=new Peer();
let timerInt;

const play=id=>{
    const s=document.getElementById(id);
    if(s){s.currentTime=0;s.play().catch(()=>{});}
};

peer.on('open',id=>{
    document.getElementById('peer-id-display').innerText="KOD: "+id;
});

peer.on('connection',conn=>{
conn.on('data',m=>{

if(m.type==='PLAY_VIDEO'){
    const v=document.getElementById('video-layer');
    v.src=m.file;
    v.style.display='block';
    v.play();
    v.onended=()=>v.style.display='none';
}

if(m.type==='NEXT_ROUND'){
    play('sndRunda');
    document.getElementById('normal-ui').innerHTML='';
    document.getElementById('total').innerText=0;
    document.querySelectorAll('.strike-x').forEach(x=>x.style.display='none');
}

if(m.type==='SETUP'){
    document.getElementById('normal-ui').style.display='flex';
    document.getElementById('final-ui').style.display='none';
    document.getElementById('normal-ui').innerHTML=
        m.a.map((x,i)=>`
        <div class="row" id="row-${i}">
            <div class="row-num">${i+1}</div>
            <div class="row-content">
                <div class="dots">████████████</div>
                <div class="ans-text">${x.t}</div>
                <div class="pts">${x.p}</div>
            </div>
        </div>`).join('');
}

if(m.type==='REVEAL'){
    play('sndOk');
    document.getElementById(`row-${m.index}`).classList.add('revealed');
    document.getElementById('total').innerText=m.total;
}

if(m.type==='STRIKE'){
    play('sndNo');
    document.getElementById(`x${m.team}${m.num}`).style.display='block';
}

if(m.type==='RESET_X'){
    document.querySelectorAll('.strike-x').forEach(x=>x.style.display='none');
}

if(m.type==='UPDATE'){
    document.getElementById('total').innerText=m.sc;
}

if(m.type==='FINAL_MODE'){
    play('sndFinal');
    document.getElementById('normal-ui').style.display='none';
    document.getElementById('final-ui').style.display='flex';
    document.getElementById('timer').innerText=m.time;
    if(m.time==15){
        drawFinal('col-G1');
        drawFinal('col-G2');
    }
}

if(m.type==='START_TIMER'){
    let t=parseInt(timer.innerText);
    clearInterval(timerInt);
    timerInt=setInterval(()=>{
        t--;timer.innerText=t;
        if(t<=0){clearInterval(timerInt);play('sndNo');}
    },1000);
}

if(m.type==='FINAL_REVEAL'){
    play('sndOk');
    const s=document.getElementById(`f-col-G${m.gracz}-${m.index}`);
    s.querySelector('.f-ans').innerText=m.ans;
    s.querySelector('.f-pts').innerText=m.pts;
    s.classList.add('revealed');
    document.getElementById('total').innerText=m.total;
}

if(m.type==='BUZZER') play('sndBuzz');

});
});

function drawFinal(id){
    document.getElementById(id).innerHTML=
        Array(5).fill(0).map((_,i)=>`
        <div class="final-slot" id="f-${id}-${i}">
            <div class="f-ans"></div>
            <div class="f-pts">0</div>
        </div>`).join('');
}
</script>

</body>
</html>
