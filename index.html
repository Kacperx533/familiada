<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>FAMILIADA – TABLICA TV</title>

<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>

<style>
:root{
    --gold:#f5b041;
    --red:#ff2a2a;
    --bg:#050505;
}

body{
    margin:0;
    background:black;
    color:var(--gold);
    font-family:'Press Start 2P', monospace;
    text-transform:uppercase;
    overflow:hidden;
}

/* LED TŁO */
.led-bg{
    position:fixed;
    inset:0;
    background:radial-gradient(circle, rgba(255,200,80,.18) 1px, transparent 1px);
    background-size:6px 6px;
    pointer-events:none;
    z-index:1;
}

/* OVERLAY */
#overlay{
    position:fixed;
    inset:0;
    background:black;
    z-index:9999;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
}

#peer-id-display{
    font-size:48px;
    border:5px solid var(--gold);
    padding:25px 40px;
    border-radius:15px;
    margin-bottom:20px;
}

/* UKŁAD */
.main{
    display:flex;
    height:100vh;
    align-items:center;
    justify-content:center;
    gap:20px;
}

/* X */
.strike-zone{
    width:120px;
    display:flex;
    flex-direction:column;
    gap:20px;
}

.strike-x{
    width:90px;
    height:90px;
    position:relative;
    display:none;
    filter:drop-shadow(0 0 25px var(--red));
}

.strike-x::before,
.strike-x::after{
    content:'';
    position:absolute;
    top:42%;
    width:100%;
    height:14px;
    background:var(--red);
}
.strike-x::before{transform:rotate(45deg);}
.strike-x::after{transform:rotate(-45deg);}

/* RAMKA */
.board{
    width:82vw;
    height:86vh;
    background:var(--bg);
    border:12px solid var(--gold);
    border-radius:30px;
    padding:30px;
    box-shadow:0 0 40px rgba(245,176,65,.6), inset 0 0 80px #000;
    display:flex;
    flex-direction:column;
    z-index:2;
}

/* WIERSZE */
#normal-ui{
    flex:1;
    display:flex;
    flex-direction:column;
    justify-content:center;
}

.row{
    display:flex;
    align-items:center;
    height:90px;
    font-size:52px;
    border-bottom:3px solid #222;
}

.row-num{
    width:70px;
    text-align:center;
}

.row-content{
    flex:1;
    display:flex;
    justify-content:space-between;
    position:relative;
}

.dots{
    position:absolute;
    left:50%;
    transform:translateX(-50%);
    color:#222;
    letter-spacing:8px;
}

.ans-text,
.pts{
    display:none;
    background:var(--bg);
    padding:0 10px;
}

.revealed .ans-text,
.revealed .pts{
    display:block;
    animation:reveal .25s steps(4);
}

.revealed .dots{display:none;}

@keyframes reveal{
    from{opacity:0}
    to{opacity:1}
}

/* FINAŁ */
#final-ui{
    display:none;
    flex:1;
    flex-direction:column;
}

.timer{
    font-size:110px;
    text-align:center;
    color:var(--red);
    text-shadow:0 0 25px var(--red);
}

.final-cols{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:40px;
    margin-top:20px;
}

.final-slot{
    display:flex;
    height:70px;
    font-size:36px;
    border:3px solid #222;
    margin-bottom:8px;
    padding:0 10px;
    align-items:center;
}

.f-ans{flex:1;display:none}
.f-pts{width:80px;text-align:right;display:none}

.revealed .f-ans,
.revealed .f-pts{display:block}

/* STOPKA */
.footer{
    display:flex;
    justify-content:space-between;
    font-size:90px;
    border-top:5px solid #333;
    padding-top:10px;
}
</style>
</head>

<body>

<div id="overlay">
    <div id="peer-id-display">ŁADOWANIE...</div>
    <button onclick="this.parentElement.style.display='none'"
        style="font-size:32px;padding:15px 40px;font-family:'Press Start 2P';cursor:pointer">
        START
    </button>
</div>

<div class="led-bg"></div>

<div class="main">
    <div class="strike-zone">
        <div class="strike-x" id="xA1"></div>
        <div class="strike-x" id="xA2"></div>
        <div class="strike-x" id="xA3"></div>
    </div>

    <div class="board">
        <div id="normal-ui"></div>

        <div id="final-ui">
            <div class="timer" id="timer">15</div>
            <div class="final-cols">
                <div id="col-G1"></div>
                <div id="col-G2"></div>
            </div>
        </div>

        <div class="footer">
            <span>SUMA</span>
            <span id="total">0</span>
        </div>
    </div>

    <div class="strike-zone">
        <div class="strike-x" id="xB1"></div>
        <div class="strike-x" id="xB2"></div>
        <div class="strike-x" id="xB3"></div>
    </div>
</div>

<script>
const peer=new Peer();
let timerInt;

peer.on('open',id=>{
    document.getElementById('peer-id-display').innerText="KOD: "+id;
});

peer.on('connection',conn=>{
conn.on('data',m=>{

if(m.type==='SETUP'){
    normalUI();
    document.getElementById('normal-ui').innerHTML =
        m.a.map((x,i)=>`
        <div class="row" id="row-${i}">
            <div class="row-num">${i+1}</div>
            <div class="row-content">
                <div class="dots">███████████</div>
                <div class="ans-text">${x.t}</div>
                <div class="pts">${x.p}</div>
            </div>
        </div>`).join('');
}

if(m.type==='REVEAL'){
    document.getElementById(`row-${m.index}`).classList.add('revealed');
    document.getElementById('total').innerText=m.total;
}

if(m.type==='STRIKE'){
    document.getElementById(`x${m.team}${m.num}`).style.display='block';
}

if(m.type==='RESET_X'){
    document.querySelectorAll('.strike-x').forEach(x=>x.style.display='none');
}

if(m.type==='UPDATE'){
    document.getElementById('total').innerText=m.sc;
}

if(m.type==='FINAL_MODE'){
    finalUI();
    document.getElementById('timer').innerText=m.time;
    if(m.time==15){
        drawFinal('col-G1');
        drawFinal('col-G2');
    }
}

if(m.type==='START_TIMER'){
    let t=parseInt(timer.innerText);
    clearInterval(timerInt);
    timerInt=setInterval(()=>{
        t--;
        timer.innerText=t;
        if(t<=0) clearInterval(timerInt);
    },1000);
}

if(m.type==='FINAL_REVEAL'){
    const s=document.getElementById(`f-col-G${m.gracz}-${m.index}`);
    s.querySelector('.f-ans').innerText=m.ans;
    s.querySelector('.f-pts').innerText=m.pts;
    s.classList.add('revealed');
    document.getElementById('total').innerText=m.total;
}

});
});

function normalUI(){
    document.getElementById('final-ui').style.display='none';
    document.getElementById('normal-ui').style.display='flex';
}

function finalUI(){
    document.getElementById('normal-ui').style.display='none';
    document.getElementById('final-ui').style.display='flex';
}

function drawFinal(id){
    document.getElementById(id).innerHTML=
        Array(5).fill(0).map((_,i)=>`
        <div class="final-slot" id="f-${id}-${i}">
            <div class="f-ans"></div>
            <div class="f-pts">0</div>
        </div>`).join('');
}
</script>

</body>
</html>
