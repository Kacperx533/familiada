<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>FAMILIADA TV - EDYCJA SZKOLNA</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root { --gold: #f5b041; --red: #ff0000; --blue: #0055ff; }
        body { 
            margin: 0; overflow: hidden; font-family: 'VT323', monospace; text-transform: uppercase;
            height: 100vh; width: 100vw; background: radial-gradient(circle at 0% 50%, rgba(255, 0, 0, 0.2) 0%, transparent 50%), radial-gradient(circle at 100% 50%, rgba(0, 85, 255, 0.2) 0%, transparent 50%), #000;
            color: var(--gold);
        }

        /* Animacja napisu powitalnego */
        #intro-text {
            position: fixed; inset: 0; display: flex; align-items: center; justify-content: center;
            font-size: 120px; text-align: center; z-index: 1000; background: #000;
            opacity: 0; pointer-events: none; transition: opacity 1s;
        }
        .animate-intro { animation: zoomInOut 4s forwards; }
        @keyframes zoomInOut {
            0% { opacity: 0; transform: scale(0.5); }
            20% { opacity: 1; transform: scale(1.1); }
            80% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(1.5); }
        }

        .main-layout { display: flex; align-items: center; justify-content: center; height: 100vh; gap: 50px; }
        .big-x { font-size: 200px; color: var(--red); text-shadow: 0 0 30px var(--red); display: none; }
        
        /* Tablica */
        .main-frame {
            width: 70vw; height: 60vh; background: #000; border: 8px solid #222; border-radius: 40px;
            padding: 30px; box-shadow: 0 0 50px #000;
        }
        .row { display: flex; align-items: center; height: 16.6%; font-size: 80px; border-bottom: 2px solid #0a0a0a; }
        .ans-text, .pts-val { display: none; background: #000; padding: 0 15px; }
        .revealed .ans-text, .revealed .pts-val { display: block; }
        .revealed .dots { display: none; }
        .dots { color: #080808; letter-spacing: 15px; flex-grow: 1; text-align: center; }

        .round-counter { font-size: 100px; background: #000; padding: 10px 50px; border-radius: 10px; border: 2px solid #222; margin-bottom: 20px; }
        #video-layer { position: fixed; inset: 0; width: 100%; height: 100%; z-index: 5000; display: none; }
    </style>
</head>
<body>
    <div id="intro-text">FAMILIADA<br><span style="color:white; font-size:60px">EDYCJA SZKOLNA</span></div>
    <video id="video-layer"></video>

    <div class="main-layout">
        <div id="strikes-A"><div class="big-x">X</div><div class="big-x">X</div><div class="big-x">X</div></div>
        <div style="display:flex; flex-direction:column; align-items:center">
            <div class="round-counter" id="round-pts">0</div>
            <div class="main-frame"><div id="rows-box" style="height:100%"></div></div>
        </div>
        <div id="strikes-B"><div class="big-x">X</div><div class="big-x">X</div><div class="big-x">X</div></div>
    </div>

    <script>
        const peer = new Peer();
        const sounds = {
            ok: new Audio('dobra.mp3'),
            error: new Audio('blad.mp3'),
            intro: new Audio('czolowka.mp3'),
            round: new Audio('runda.mp3'),
            final: new Audio('final.mp3')
        };

        peer.on('open', id => console.log("ID: " + id));
        peer.on('connection', conn => {
            conn.on('data', m => {
                if(m.type === 'INTRO') {
                    sounds.intro.play();
                    const intro = document.getElementById('intro-text');
                    intro.style.opacity = "1";
                    intro.classList.add('animate-intro');
                    setTimeout(() => { intro.classList.remove('animate-intro'); intro.style.opacity="0"; }, 4000);
                }
                if(m.type === 'SOUND') { if(sounds[m.name]) sounds[m.name].play(); }
                if(m.type === 'SETUP') {
                    document.getElementById('rows-box').innerHTML = m.ans.map((a,i)=>`
                        <div class="row" id="r-${i}">
                            <div style="color:#111; width:50px">${i+1}</div>
                            <div class="ans-text">${a.t}</div>
                            <div class="dots">................</div>
                            <div class="pts-val">${a.p}</div>
                        </div>`).join('');
                }
                if(m.type === 'REVEAL') { document.getElementById(`r-${m.idx}`).classList.add('revealed'); sounds.ok.play(); }
                if(m.type === 'STRIKE') {
                    sounds.error.play();
                    const xs = document.querySelectorAll(`#strikes-${m.team} .big-x`);
                    xs.forEach((x, i) => x.style.display = i < m.count ? 'block' : 'none');
                }
                if(m.type === 'SYNC') { document.getElementById('round-pts').innerText = m.rt; }
            });
        });
    </script>
</body>
</html>
