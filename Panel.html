<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>ADMIN - FINAŁ PRO</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #1a1a1a; color: white; padding: 20px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .panel { background: #2d2d2d; padding: 15px; border-radius: 8px; border: 1px solid #444; }
        h3 { color: #eaff00; margin-top: 0; }
        button { padding: 10px; cursor: pointer; border: none; border-radius: 4px; font-weight: bold; margin-bottom: 5px; width: 100%; }
        .btn-timer { background: #ff3333; color: white; font-size: 18px; }
        .btn-rev { background: #007bff; color: white; }
        .btn-repeat { background: #ffc107; color: black; }
        input { width: 80%; padding: 5px; margin-bottom: 10px; background: #111; color: white; border: 1px solid #555; }
        .score-box { font-size: 30px; text-align: center; background: #000; padding: 10px; margin: 10px 0; color: #eaff00; }
    </style>
</head>
<body>
    <div style="margin-bottom: 20px;">
        ID TABLICY: <input id="peer-id" placeholder="Wpisz ID z ekranu TV" style="width: 200px;">
        <button onclick="connect()" style="width: 100px; background: #28a745; color: white;">POŁĄCZ</button>
        <button onclick="send({type:'RESET'})" style="width: 150px; background: #555; color: white;">RESET SYSTEMU</button>
    </div>

    <div class="grid">
        <div class="panel">
            <h3>GRACZ 1 (15 SEK)</h3>
            <button onclick="send({type:'TIMER', sec: 15})" class="btn-timer">START ZEGARA 15s</button>
            <hr>
            <div id="p1-inputs">
                <script>
                    for(let i=0; i<5; i++) {
                        document.write(`<div>${i+1}. <input id="p1t${i}" placeholder="Hasło"> <input id="p1p${i}" placeholder="Pkt" style="width:40px"> <button onclick="reveal(1, ${i})" class="btn-rev">ODKRYJ</button></div>`);
                    }
                </script>
            </div>
            <button onclick="send({type:'HIDE_P1'})" style="background: #666; margin-top: 10px;">UKRYJ ODPOWIEDZI G1 (Dla G2)</button>
        </div>

        <div class="panel">
            <h3>GRACZ 2 (20 SEK)</h3>
            <button onclick="send({type:'TIMER', sec: 20})" class="btn-timer">START ZEGARA 20s</button>
            <button onclick="send({type:'REPEAT'})" class="btn-repeat">⚠️ DŹWIĘK POWTÓRKI (POWTÓRZENIA.MP3)</button>
            <hr>
            <div id="p2-inputs">
                <script>
                    for(let i=0; i<5; i++) {
                        document.write(`<div>${i+1}. <input id="p2t${i}" placeholder="Hasło"> <input id="p2p${i}" placeholder="Pkt" style="width:40px"> <button onclick="reveal(2, ${i})" class="btn-rev">ODKRYJ</button></div>`);
                    }
                </script>
            </div>
        </div>
    </div>

    <div class="panel" style="margin-top: 20px; text-align: center;">
        <h3>SUMA PUNKTÓW</h3>
        <div class="score-box" id="local-score">0</div>
        <button onclick="updateScore()" style="background: #eaff00; color: black; font-size: 20px;">AKTUALIZUJ TABLICĘ</button>
    </div>

    <script>
        const peer = new Peer();
        let conn;
        let total = 0;

        function connect() {
            conn = peer.connect(document.getElementById('peer-id').value);
            conn.on('open', () => alert("POŁĄCZONO!"));
        }

        function send(data) { if(conn) conn.send(data); }

        function reveal(player, idx) {
            const t = document.getElementById(`p${player}t${idx}`).value;
            const p = document.getElementById(`p${player}p${idx}`).value;
            send({type: 'REV', player: player, idx: idx, t: t, p: p});
            
            if(p) {
                total += parseInt(p);
                document.getElementById('local-score').innerText = total;
            }
        }

        function updateScore() {
            send({type: 'SCORE', val: total});
        }
    </script>
</body>
</html>
