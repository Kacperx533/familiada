<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>PANEL STEROWANIA</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #1a1a1a; color: white; padding: 20px; }
        .card { background: #2a2a2a; padding: 15px; border-radius: 10px; border-top: 4px solid gold; margin-bottom: 15px; }
        button { padding: 10px; margin: 3px; cursor: pointer; border: none; border-radius: 5px; font-weight: bold; }
        .btn-blue { background: #0066ff; color: white; }
        .btn-red { background: #cc0000; color: white; }
        .btn-green { background: #28a745; color: white; }
        .btn-gold { background: gold; color: black; }
        .btn-grey { background: #555; color: white; }
        input { padding: 8px; background: #000; color: white; border: 1px solid #444; width: 80px; }
        .flex { display: flex; gap: 10px; }
        #panel-final { display: none; }
    </style>
</head>
<body>

    <div class="card">
        <h3>1. SYSTEM</h3>
        <input type="text" id="tv-id" placeholder="ID z TV" style="width:150px">
        <button class="btn-green" onclick="connect()">POŁĄCZ</button>
        <button class="btn-blue" onclick="send({type:'VIDEO'})">CZOŁÓWKA</button>
    </div>

    <div id="panel-rounds">
        <div class="card">
            <h3>2. WYBÓR RUNDY</h3>
            <button class="btn-gold" onclick="setRound(0)">RUNDA 1</button>
            <button class="btn-gold" onclick="setRound(1)">RUNDA 2</button>
            <button class="btn-gold" onclick="setRound(2)">RUNDA 3</button>
            <button class="btn-red" onclick="showFinal()">PRZEJDŹ DO FINAŁU</button>
        </div>
        <div class="card">
            <h3 id="q-title">WYBIERZ RUNDĘ</h3>
            <div id="ans-box"></div>
        </div>
    </div>

    <div id="panel-final">
        <div class="card">
            <h3>FINAŁ - STEROWANIE</h3>
            <button class="btn-grey" onclick="showRounds()">POWRÓT DO RUND</button>
            <button class="btn-red" onclick="send({type:'TIMER', val:15})">START 15s</button>
            <button class="btn-red" onclick="send({type:'TIMER', val:20})">START 20s</button>
            <button class="btn-gold" onclick="send({type:'SOUND', f:'rep'})">POWTÓRZENIE</button>
        </div>
        <div class="card">
            <h3>TABELA FINAŁOWA</h3>
            <table>
                <tr><th>PYTANIE</th><th>GRACZ 1 (Tekst | Pkt)</th><th>GRACZ 2 (Tekst | Pkt)</th></tr>
                <script>
                    for(let i=0; i<5; i++) {
                        document.write(`<tr>
                            <td>Pyt ${i+1}</td>
                            <td><input type="text" id="f1t-${i}" style="width:120px"> <input type="number" id="f1p-${i}"> <button onclick="revF(1, ${i})">Odsłoń</button></td>
                            <td><input type="text" id="f2t-${i}" style="width:120px"> <input type="number" id="f2p-${i}"> <button onclick="revF(2, ${i})">Odsłoń</button></td>
                        </tr>`);
                    }
                </script>
            </table>
        </div>
    </div>

    <div class="card">
        <h3>PUNKTY DRUŻYN</h3>
        <div class="flex">
            <div>Niebiescy: <span id="ds1">0</span> <button onclick="addScore('blue')">Dodaj sumę</button></div>
            <div>Czerwoni: <span id="ds2">0</span> <button onclick="addScore('red')">Dodaj sumę</button></div>
        </div>
        <div style="font-size: 20px; color: gold;">Suma rundy: <span id="dsum">0</span></div>
        <button class="btn-blue" onclick="send({type:'STRIKE', n:1, team:'blue'})">NIEBIESCY X</button>
        <button class="btn-red" onclick="send({type:'STRIKE', n:1, team:'red'})">CZERWONI X</button>
    </div>

    <script>
        const DB = [
            {q:"Więcej niż jedno zwierzę to?", a:[["OWCE",40],["LAMA",30],["STADO",20],["WATAHA",10]]},
            {q:"Co robimy w ferie?", a:[["NARTY",50],["SANKI",30],["ŁYŻWY",15]]},
            {q:"Przedmiot szkolny na literę M?", a:[["MATEMATYKA",60],["MUZYKA",30]]}
        ];

        let conn, peer = new Peer(), s1=0, s2=0, rSum=0;

        function connect() { conn = peer.connect(document.getElementById('tv-id').value); conn.on('open', () => alert("Połączono!")); }
        function setRound(i) {
            rSum = 0; update();
            const q = DB[i]; document.getElementById('q-title').innerText = q.q;
            const box = document.getElementById('ans-box'); box.innerHTML = '';
            q.a.forEach((x, idx) => {
                const b = document.createElement('button'); b.className='btn-grey'; b.innerText=`${x[0]} (${x[1]})`;
                b.onclick=()=>{ rSum+=x[1]; update(); send({type:'REV', idx:idx}); b.style.background='green'; };
                box.appendChild(b);
            });
            send({type:'SETUP', ans: q.a.map(x=>({t:x[0], p:x[1]}))});
        }
        function showFinal() { document.getElementById('panel-rounds').style.display='none'; document.getElementById('panel-final').style.display='block'; send({type:'FINAL_UI'}); }
        function showRounds() { document.getElementById('panel-rounds').style.display='block'; document.getElementById('panel-final').style.display='none'; }
        function revF(p, i) { send({type:'FINAL_REV', p:p, i:i, txt:document.getElementById(`f${p}t-${i}`).value.toUpperCase(), pts:document.getElementById(`f${p}p-${i}`).value}); }
        function addScore(team) { if(team==='blue') s1+=rSum; else s2+=rSum; rSum=0; update(); }
        function update() { document.getElementById('ds1').innerText=s1; document.getElementById('ds2').innerText=s2; document.getElementById('dsum').innerText=rSum; send({type:'SCORE', s1:s1, s2:s2, sum:rSum}); }
        function send(d) { if(conn) conn.send(d); }
    </script>
</body>
</html>
