<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>PANEL STEROWANIA</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #121212; color: white; display: grid; grid-template-columns: 320px 1fr 320px; gap: 15px; padding: 15px; }
        .card { background: #1e1e1e; padding: 12px; border-radius: 8px; border-top: 4px solid #e2ff00; margin-bottom: 10px; }
        button { width: 100%; padding: 10px; margin: 3px 0; cursor: pointer; font-weight: bold; border-radius: 4px; border: none; background: #333; color: white; }
        button:disabled { opacity: 0.2; cursor: not-allowed; }
        .btn-gold { background: #e2ff00; color: black; }
        .btn-red { background: #ff3333; }
        .btn-blue { background: #2196F3; }
        .btn-active-team { background: #4CAF50 !important; color: white; box-shadow: 0 0 10px #4CAF50; }
        .score-box { font-size: 24px; text-align: center; background: #000; color: #e2ff00; padding: 8px; margin: 5px 0; border: 1px solid #333; }
        input, select { width: 100%; padding: 8px; background: #000; color: white; border: 1px solid #444; margin-bottom: 8px; box-sizing: border-box; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 4px; }
        .scroll { height: 280px; overflow-y: auto; border: 1px solid #333; padding: 5px; background: #000; }
        h3 { color: #e2ff00; font-size: 13px; margin: 0 0 10px 0; text-transform: uppercase; }
    </style>
</head>
<body>
    <div>
        <div class="card"><h3>SYSTEM</h3><input id="tv-id" placeholder="ID z TV"><button class="btn-gold" onclick="connect()">PO≈ÅƒÑCZ</button></div>
        <div class="card">
            <h3>PUNKTY I B≈ÅƒòDY</h3>
            <div class="grid">
                <button id="team1-btn" onclick="selectTeam(1, 'L')">DRU≈ªYNA 1 (L)</button>
                <button id="team2-btn" onclick="selectTeam(2, 'R')">DRU≈ªYNA 2 (P)</button>
            </div>
            <div id="t1-pts" style="font-size:18px; margin-top:10px">D1: 0 pkt</div>
            <button class="btn-blue control" onclick="addPts(1)" disabled>DODAJ SUMƒò DO D1</button>
            <div id="t2-pts" style="font-size:18px; margin-top:10px">D2: 0 pkt</div>
            <button class="btn-blue control" onclick="addPts(2)" disabled>DODAJ SUMƒò DO D2</button>
        </div>
        <div class="card">
            <h3>MEDIA</h3>
            <button class="btn-gold" onclick="send({type:'PLAY_MEDIA', video:'czolowka.mp4'})">üé¨ CZO≈Å√ìWKA</button>
            <button onclick="send({type:'PLAY_MEDIA', audio:'intro'})">üéµ INTRO MUZYKA</button>
        </div>
    </div>

    <div>
        <div class="card">
            <h3>RUNDY</h3>
            <div class="grid">
                <button onclick="startR(1)">RUNDA 1</button><button onclick="startR(2)">RUNDA 2</button>
                <button onclick="startR(3)">RUNDA 3</button><button onclick="startR(4)">RUNDA 4</button>
            </div>
        </div>
        <div class="card">
            <h3>PYTANIA</h3>
            <select id="q-sel" onchange="preQ()"></select>
            <button class="btn-gold" onclick="sendQ()">ZA≈ÅADUJ NA TV</button>
            <div id="ans-pre" class="scroll"></div>
            <div class="score-box">SUMA RUNDY: <span id="cur-sum">0</span></div>
            <div class="grid">
                <button class="btn-red control" onclick="smartX()" disabled id="btn-smart-x">B≈ÅƒÑD (X)</button>
                <button onclick="clearX()">WYCZY≈öƒÜ X</button>
                <button onclick="send({type:'PLAY_MEDIA', audio:'bad'})" style="background:#a00">üîä TYLKO D≈πWIƒòK (ZLE)</button>
                <button onclick="send({type:'PLAY_MEDIA', audio:'powtorzenie'})" style="background:#555">üîÑ POWT√ìRZENIE</button>
            </div>
        </div>
    </div>

    <div>
        <div class="card">
            <h3>FINA≈Å</h3>
            <button class="btn-gold" onclick="send({type:'SETUP_FINAL'});send({type:'PLAY_MEDIA',video:'final.mp4'})">START FINA≈ÅU</button>
            <div class="grid"><button onclick="runT(15)">15s</button><button onclick="runT(20)">20s</button></div>
            <select id="f-sel" onchange="showFH()"></select>
            <div id="f-h" style="font-size:11px; color:#888; margin:10px 0"></div>
            <div id="f-ins" class="scroll"></div>
        </div>
    </div>

    <script>
        const DB = [
            {q:"Wiƒôcej ni≈º jedno zwierzƒô", a:[["STADO",52],["KLUCZ",17],["WATAHA",11],["≈ÅAWICA",8],["SFORA",5]]},
            {q:"Co≈õ co parzy", a:[["POKRZYWA",38],["OGIE≈É",31],["WRZƒÑTEK",19],["S≈ÅO≈ÉCE",7]]},
            {q:"Zwierzƒô na P", a:[["PIES",45],["PTAK",18],["PANDA",12]]}
        ];
        const FS = [["1.Ro≈õlina k≈ÇujƒÖca", "2.Marka auta", "3.Czƒô≈õƒá roweru", "4.Miasto w PL", "5.Imiƒô na A"]];

        let peer=new Peer(), conn, sum=0, activeTeamNum=null, activeSide='L', t1=0, t2=0;
        let errors = { L: 0, R: 0 };

        function connect() { conn=peer.connect(document.getElementById('tv-id').value); }
        
        function selectTeam(n, s) { 
            activeTeamNum=n; activeSide=s; 
            document.querySelectorAll('.control').forEach(b=>b.disabled=false);
            document.getElementById('team1-btn').className = (n===1?'btn-active-team':'');
            document.getElementById('team2-btn').className = (n===2?'btn-active-team':'');
            updateXButtonLabel();
        }

        function smartX() {
            if(!activeSide) return;
            if(errors[activeSide] < 3) {
                errors[activeSide]++;
                send({type:'X', side:activeSide, n:errors[activeSide]});
                updateXButtonLabel();
            }
        }

        function updateXButtonLabel() {
            const btn = document.getElementById('btn-smart-x');
            btn.innerText = activeSide ? `B≈ÅƒÑD D${activeTeamNum} (MAJƒÑ: ${errors[activeSide]})` : "WYBIERZ DRU≈ªYNƒò";
        }

        function clearX() {
            errors.L = 0; errors.R = 0;
            send({type:'X', side:'L', n:0});
            send({type:'X', side:'R', n:0});
            updateXButtonLabel();
        }

        function addPts(n) { 
            if(n===1) t1+=sum; else t2+=sum; 
            sum=0; updS(); updT(); 
            send({type:'SCORE',val:0}); 
            clearX(); resetSel(); 
        }

        function resetSel() { 
            activeTeamNum=null; activeSide=null;
            document.querySelectorAll('.control').forEach(b=>b.disabled=true); 
            document.getElementById('team1-btn').className=''; 
            document.getElementById('team2-btn').className=''; 
            document.getElementById('btn-smart-x').innerText = "B≈ÅƒÑD (X)";
        }

        function updT() { 
            document.getElementById('t1-pts').innerText="D1: "+t1+" pkt"; 
            document.getElementById('t2-pts').innerText="D2: "+t2+" pkt"; 
        }

        function startR(n) { 
            sum=0; updS(); clearX(); resetSel(); 
            send({type:'RESET_BOARD'}); 
            send({type:'PLAY_MEDIA',audio:'runda'}); 
        }

        window.onload=()=>{
            const s=document.getElementById('q-sel'); DB.forEach((x,i)=>s.innerHTML+=`<option value="${i}">${i+1}. ${x.q}</option>`);
            const fs=document.getElementById('f-sel'); for(let i=0;i<10;i++) fs.innerHTML+=`<option value="${i}">ZESTAW ${i+1}</option>`;
            const fi=document.getElementById('f-ins'); ['p1','p2'].forEach(p=>{
                fi.innerHTML+=`<div style="color:#e2ff00;margin-top:10px">${p.toUpperCase()}</div>`;
                for(let i=0;i<5;i++) fi.innerHTML+=`<div style="display:flex;gap:2px"><input id="f-${p}-t-${i}" style="width:100px"><input id="f-${p}-p-${i}" type="number" style="width:40px"><button onclick="revF('${p}',${i})" style="width:30px;background:#e2ff00;color:black">OK</button></div>`;
            });
            preQ();
        };

        function sendQ() { sum=0; updS(); const q=DB[document.getElementById('q-sel').value]; send({type:'SETUP_NORMAL',ans:q.a}); preQ(); }
        function preQ() { 
            const q=DB[document.getElementById('q-sel').value]; 
            document.getElementById('ans-pre').innerHTML=q.a.map((x,i)=>`<button class="control" onclick="revN(${i},'${x[0]}',${x[1]})" disabled style="text-align:left">${x[0]} (${x[1]})</button>`).join(''); 
        }
        function revN(i,t,p) { sum+=p; updS(); send({type:'REV_NORMAL',idx:i,t:t,p:p}); send({type:'SCORE',val:sum}); }
        function revF(p,i) { const t=document.getElementById(`f-${p}-t-${i}`).value.toUpperCase(), pts=parseInt(document.getElementById(`f-${p}-p-${i}`).value)||0; sum+=pts; updS(); send({type:'REV_FINAL',player:p,idx:i,t:t,p:pts}); send({type:'SCORE',val:sum}); }
        function showFH() { document.getElementById('f-h').innerHTML=FS[0].join("<br>"); }
        function updS() { document.getElementById('cur-sum').innerText=sum; }
        function runT(s) { let c=s; send({type:'TIMER',action:'start',val:c}); let i=setInterval(()=>{c--;send({type:'TIMER',action:'tick',val:c});if(c<=0){clearInterval(i);send({type:'TIMER',action:'stop'});}},1000); }
        function send(d) { if(conn) conn.send(d); }
    </script>
</body>
</html>
