<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PANEL STEROWANIA</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #121212; color: white; padding: 10px; }
        .card { background: #1e1e1e; padding: 15px; border-radius: 12px; margin-bottom: 10px; border: 1px solid #444; }
        button { padding: 10px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; }
        .btn-main { width: 100%; margin: 5px 0; }
        .ans-row { background: #333; padding: 8px; margin: 4px 0; display: flex; justify-content: space-between; border-radius: 6px; }
    </style>
</head>
<body>
    <div id="setup" class="card">
        <h3>1. POŁĄCZ Z TV</h3>
        <input type="text" id="tv-id" placeholder="ID Z EKRANU TV" style="padding: 10px; width: 70%;">
        <button onclick="connectToTV()" style="background: #4CAF50;">POŁĄCZ TV</button>
        <p id="panel-id-display" style="color: yellow; margin-top: 10px;">ID PANELU (DLA GRACZY): --</p>
    </div>

    <div id="controls" style="display:none">
        <button class="btn-main" onclick="sendToTV({type:'START_INTRO'})" style="background:#2e7d32; color:white;">▶ CZOŁÓWKA</button>
        
        <div class="card">
            <button onclick="broadcast({type:'UNLOCK'})" style="background:green; color:white; width:48%">ODBLOKUJ GRZYBKI</button>
            <button onclick="broadcast({type:'LOCK'})" style="background:red; color:white; width:48%">ZABLOKUJ GRZYBKI</button>
        </div>

        <div class="card">
            <select id="q-select" onchange="loadQ()" style="width:100%; padding:10px;"></select>
            <button class="btn-main" onclick="sendQ()" style="background:#bb86fc">WYŚLIJ PYTANIE</button>
            <div id="ans-list"></div>
        </div>

        <div class="card">
            <button onclick="setTeam('A')" id="btnA" style="background:#cf6679; width:48%">TEAM A</button>
            <button onclick="setTeam('B')" id="btnB" style="background:#03dac6; width:48%">TEAM B</button>
            <button class="btn-main" onclick="sendToTV({type:'STRIKE'}); if(activeTeam) strikes[activeTeam]++; sync();" style="background:red; height:60px; font-size:20px;">X (BŁĄD)</button>
        </div>
        
        <input type="number" id="scA" value="0" onchange="sync()"> PKT A | 
        <input type="number" id="scB" value="0" onchange="sync()"> PKT B
    </div>

    <script>
        let peer = new Peer();
        let tvConn = null;
        let buzzerConns = [];
        let activeTeam = null;
        let strikes = {A:0, B:0};
        let currentAnswers = [];

        const db = [{ q: "Polska potrawa:", a: [["Pierogi", 48], ["Bigos", 35], ["Schabowy", 22], ["Żurek", 14]] }];

        peer.on('open', id => document.getElementById('panel-id-display').innerText = "ID PANELU (DLA GRACZY): " + id);

        // Gracze łączą się z panelem
        peer.on('connection', conn => {
            buzzerConns.push(conn);
            conn.on('data', m => { if(m.type === 'BUZZ') sendToTV(m); });
        });

        function connectToTV() {
            tvConn = peer.connect(document.getElementById('tv-id').value);
            tvConn.on('open', () => {
                document.getElementById('setup').style.display='none';
                document.getElementById('controls').style.display='block';
                db.forEach((d, i) => document.getElementById('q-select').innerHTML += `<option value="${i}">${d.q}</option>`);
            });
        }

        function broadcast(m) { buzzerConns.forEach(c => c.send(m)); }
        function sendToTV(m) { if(tvConn) tvConn.send(m); }
        
        function loadQ() { 
            const d = db[document.getElementById('q-select').value];
            currentAnswers = d.a;
            document.getElementById('ans-list').innerHTML = "";
            d.a.forEach((a, i) => {
                document.getElementById('ans-list').innerHTML += `<div class="ans-row"><span>${a[0]}</span><button onclick="reveal(${i})">ODKRYJ</button></div>`;
            });
        }

        function sendQ() { sendToTV({type:'SETUP', q: db[document.getElementById('q-select').value].q, a: currentAnswers.map(x=>({t:x[0], p:x[1]}))}); }
        function reveal(i) { 
            sendToTV({type:'REVEAL', index:i, text:currentAnswers[i][0], pts:currentAnswers[i][1]});
            if(activeTeam) { let s = document.getElementById('sc'+activeTeam); s.value = parseInt(s.value) + currentAnswers[i][1]; sync(); }
        }
        function setTeam(t) { activeTeam = t; }
        function sync() { sendToTV({type:'UPDATE', scA:document.getElementById('scA').value, scB:document.getElementById('scB').value, strikes:strikes}); }
    </script>
</body>
</html>
