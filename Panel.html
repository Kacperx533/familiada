<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>FAMILIADA - PANEL STEROWANIA</title>
    <style>
        body { font-family: sans-serif; background: #1a1c2c; color: white; display: grid; grid-template-columns: 350px 1fr 350px; gap: 10px; margin: 0; height: 100vh; }
        .col { background: #292d3e; padding: 15px; border-right: 1px solid #444; overflow-y: auto; }
        .card { background: #1e2130; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #333; }
        h2 { font-size: 16px; color: #fbbf24; margin: 0 0 10px 0; border-bottom: 1px solid #444; padding-bottom: 5px; }
        button { width: 100%; padding: 10px; margin: 4px 0; cursor: pointer; border-radius: 5px; border: none; font-weight: bold; transition: 0.2s; }
        .btn-r { background: #3b82f6; color: white; }
        .btn-ok { background: #22c55e; color: white; }
        .btn-zle { background: #ef4444; color: white; }
        .timer { font-size: 40px; text-align: center; color: #fbbf24; font-family: monospace; }
        .q-item { background: #13141f; padding: 8px; margin-bottom: 5px; border-radius: 4px; font-size: 13px; cursor: pointer; }
        .q-item:hover { background: #333; }
        input { background: #000; color: #fbbf24; border: 1px solid #444; padding: 5px; width: 100%; box-sizing: border-box; }
    </style>
</head>
<body>

    <div class="col">
        <div class="card">
            <h2>PO≈ÅƒÑCZENIE</h2>
            <input type="text" id="target" placeholder="KOD Z TABLICY">
            <button onclick="connect()" class="btn-ok">PO≈ÅƒÑCZ</button>
        </div>
        <div class="card">
            <h2>RUNDY</h2>
            <button onclick="startRunda(1)" class="btn-r">RUNDA 1</button>
            <button onclick="startRunda(2)" class="btn-r">RUNDA 2</button>
            <button onclick="startRunda(3)" class="btn-r">RUNDA 3</button>
            <button onclick="startFinal()" class="btn-r" style="background:#fbbf24; color:black">FINA≈Å</button>
        </div>
        <div class="card">
            <h2>MULTIMEDIA</h2>
            <button onclick="play('intro')">INTRO.MP3</button>
            <button onclick="play('runda')">RUNDA.MP3</button>
            <button onclick="play('ok')">OK.MP3</button>
            <button onclick="play('zle')">ZLE.MP3</button>
            <div style="display:flex; gap:5px; margin-top:10px;">
                <button onclick="sendX(1)" class="btn-zle">X</button>
                <button onclick="sendX(2)" class="btn-zle">XX</button>
                <button onclick="sendX(3)" class="btn-zle">XXX</button>
            </div>
        </div>
    </div>

    <div class="col">
        <div id="game-controls">
            <h2>TABLICA G≈Å√ìWNA</h2>
            <div id="normal-inputs"></div>
            <div id="final-inputs" style="display:none">
                <h3>FINA≈Å - GRACZ 1</h3>
                <div id="f1-inputs"></div>
                <hr>
                <h3>FINA≈Å - GRACZ 2</h3>
                <div id="f2-inputs"></div>
            </div>
        </div>
    </div>

    <div class="col">
        <div class="card">
            <h2>STOPER FINA≈ÅOWY</h2>
            <div class="timer" id="timer">00</div>
            <div style="display:flex; gap:5px">
                <button onclick="startTimer(15)">15s</button>
                <button onclick="startTimer(20)">20s</button>
            </div>
        </div>
        <div class="card">
            <h2>BAZA PYTA≈É (≈öCIƒÑGA)</h2>
            <div id="baza-pytan"></div>
        </div>
    </div>

    <audio id="snd-intro" src="czolowka.mp3"></audio>
    <audio id="snd-runda" src="runda.mp3"></audio>
    <audio id="snd-ok" src="ok.mp3"></audio>
    <audio id="snd-zle" src="zle.mp3"></audio>

    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script>
        let conn, totalScore = 0;
        const peer = new Peer();

        const pytania = [
            { q: "Wiƒôcej ni≈º jeden to...", a: ["DWA", "GRUPA", "T≈ÅUM", "KILKA"], p: [40, 30, 20, 10] },
            { q: "Zwierzƒô na literƒô K", a: ["KOT", "KO≈É", "KROWA", "KURA"], p: [50, 20, 15, 10] },
            { q: "FINA≈Å: Nap√≥j na gorƒÖco", a: ["KAWA", "HERBATA", "KAKAO", "MLEKO", "NAPAR"], p: [45, 30, 15, 5, 5] }
        ];

        function initInputs() {
            const container = document.getElementById('normal-inputs');
            container.innerHTML = '';
            for(let i=0; i<6; i++) {
                container.innerHTML += `
                    <div style="display:flex; gap:5px; margin-bottom:5px">
                        <input id="t${i}" placeholder="Has≈Ço">
                        <input id="p${i}" type="number" placeholder="Pkt" style="width:60px">
                        <button onclick="reveal(${i})" class="btn-ok" style="width:70px">ODKRYJ</button>
                    </div>`;
            }
        }

        function initFinalInputs() {
            [1, 2].forEach(p => {
                const div = document.getElementById(`f${p}-inputs`);
                div.innerHTML = '';
                for(let i=0; i<5; i++) {
                    div.innerHTML += `<div style="display:flex; gap:5px; margin-bottom:5px">
                        <input id="f${p}-t${i}" placeholder="Odp">
                        <input id="f${p}-p${i}" type="number" placeholder="Pkt" style="width:50px">
                        <button onclick="revealFinal(${p}, ${i})" class="btn-ok">ODKRYJ</button>
                    </div>`;
                }
            });
        }

        function connect() {
            conn = peer.connect(document.getElementById('target').value.toUpperCase());
            conn.on('open', () => document.getElementById('stat').innerText = "üü¢ PO≈ÅƒÑCZONO");
        }

        function startRunda(n) {
            totalScore = 0;
            send('SETUP');
            play('runda');
            initInputs();
            document.getElementById('normal-inputs').style.display = 'block';
            document.getElementById('final-inputs').style.display = 'none';
        }

        function startFinal() {
            totalScore = 0;
            send('FINAL_MODE');
            play('runda');
            initFinalInputs();
            document.getElementById('normal-inputs').style.display = 'none';
            document.getElementById('final-inputs').style.display = 'block';
        }

        function reveal(idx) {
            const t = document.getElementById(`t${idx}`).value;
            const p = parseInt(document.getElementById(`p${idx}`).value) || 0;
            totalScore += p;
            conn.send({ type: 'REV', idx, t, p, total: totalScore });
            play('ok');
        }

        function revealFinal(player, idx) {
            const t = document.getElementById(`f${player}-t${idx}`).value;
            const p = parseInt(document.getElementById(`f${player}-p${idx}`).value) || 0;
            totalScore += p;
            conn.send({ type: 'REV_FINAL', player, idx, t, p, total: totalScore });
            play('ok');
        }

        function sendX(count) { conn.send({ type: 'X', count }); play('zle'); }
        function send(type) { if(conn) conn.send({type}); }
        function play(id) { document.getElementById('snd-'+id).play(); }

        function startTimer(sec) {
            let t = sec;
            const el = document.getElementById('timer');
            const interval = setInterval(() => {
                t--;
                el.innerText = t < 10 ? '0' + t : t;
                if(t <= 0) { clearInterval(interval); play('zle'); }
            }, 1000);
        }

        // Baza pyta≈Ñ w panelu
        const baza = document.getElementById('baza-pytan');
        pytania.forEach(item => {
            let html = `<div class="q-item"><b>${item.q}</b><br>`;
            item.a.forEach((ans, i) => html += `${ans} (${item.p[i]}p) | `);
            html += `</div>`;
            baza.innerHTML += html;
        });

        initInputs();
    </script>
</body>
</html>
