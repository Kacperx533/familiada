<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>PANEL - FAMILIADA</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #1a1a1a; color: #fff; padding: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .card { background: #222; padding: 15px; border-radius: 10px; border-top: 4px solid gold; margin-bottom: 10px; }
        button { padding: 10px; margin: 4px 0; width: 100%; cursor: pointer; font-weight: bold; border-radius: 5px; border: none; }
        .gold { background: gold; color: black; } .blue { background: #0055ff; color: #fff; } .red { background: #ff0044; color: #fff; }
        input, select { width: 100%; padding: 10px; margin: 5px 0; background: #000; color: #fff; border: 1px solid #444; font-size: 16px; }
        .active { outline: 4px solid yellow; }
    </style>
</head>
<body>
    <div>
        <div class="card">
            <h3>1. PO≈ÅƒÑCZ Z TV</h3>
            <input type="text" id="tv-id" placeholder="Wpisz ID z ekranu TV">
            <button class="gold" id="conn-btn" onclick="connectToTV()">PO≈ÅƒÑCZ</button>
        </div>
        <div class="card">
            <h3>2. MULTIMEDIA</h3>
            <button onclick="send({type:'INTRO'})">üé¨ CZO≈Å√ìWKA (VIDEO)</button>
            <button class="gold" onclick="send({type:'BG_MUSIC', play:true})">üéµ MUZYKA T≈ÅA (START)</button>
            <button onclick="send({type:'BG_MUSIC', play:false})">üîá MUZYKA T≈ÅA (STOP)</button>
            <button style="background:orange" onclick="send({type:'REPEAT'})">üîî POWT√ìRZENIE</button>
            <button class="red" onclick="send({type:'GO_FINAL'})">üèÅ FINA≈Å (D≈πWIƒòK)</button>
        </div>
        <div class="card">
            <h3>3. PUNKTY I B≈ÅƒòDY</h3>
            <div style="display:flex; gap:10px;">
                <button id="ta" class="blue" onclick="setTeam('A')">TEAM A (LEWY)</button>
                <button id="tb" class="red" onclick="setTeam('B')">TEAM B (PRAWY)</button>
            </div>
            <button class="red" style="margin-top:10px; height: 60px; font-size: 20px;" onclick="send({type:'STRIKE', team:currentTeam})">‚ùå WY≈öLIJ B≈ÅƒÑD (X)</button>
            <h2 style="text-align:center">SUMA RUNDY: <span id="scr">0</span></h2>
            <button class="gold" onclick="resetScore()">RESET PUNKT√ìW RUNDY</button>
        </div>
    </div>
    <div>
        <div class="card">
            <h3>4. WYB√ìR PYTANIA</h3>
            <select id="r-sel"><option value="1">R1 (x1)</option><option value="2">R2 (x1)</option><option value="3">R3 (x2)</option><option value="4">R4 (x3)</option></select>
            <select id="q-sel" onchange="preview()"></select>
            <button class="gold" style="height: 50px;" onclick="sendSetup()">WY≈öLIJ PYTANIE NA TABLICƒò</button>
            <div id="ans-list" style="margin-top:10px;"></div>
        </div>
    </div>

    <script>
        const db = [
            {q:"Przedmiot szkolny?", a:[["MATEMATYKA",45],["POLSKI",25],["WF",15],["HISTORIA",10],["BIOLOGIA",5]]},
            {q:"Co robimy na przerwie?", a:[["JEMY ≈öNIADANIE",40],["GADAMY",30],["BIEGAMY",15],["POWTARZAMY",10],["TELEFON",5]]},
            {q:"Co jest w pi√≥rniku?", a:[["D≈ÅUGOPIS",50],["O≈Å√ìWEK",20],["GUMKA",15],["LINIJKA",10],["TEMPER√ìWKA",5]]},
            {q:"Zwierzƒô na literƒô K?", a:[["KOT",45],["KO≈É",25],["KROWA",15],["KANGUR",10],["KROKODYL",5]]},
            {q:"Co kojarzy siƒô z wakacjami?", a:[["MORZE",40],["S≈ÅO≈ÉCE",30],["LODY",15],["G√ìRY",10],["PIASEK",5]]},
            {q:"Co mo≈ºna dostaƒá od nauczyciela?", a:[["OCENƒò",50],["POCHWA≈Åƒò",20],["UWAGƒò",15],["ZADANIE",10],["PYTANIE",5]]},
            {q:"Dyscyplina sportu?", a:[["PI≈ÅKA NO≈ªNA",45],["SIATK√ìWKA",25],["KOSZYK√ìWKA",15],["P≈ÅYWANIE",10],["TENIS",5]]},
            {q:"Co jest w plecaku?", a:[["ZESZYT",40],["KSIƒÑ≈ªKA",30],["≈öNIADANI√ìWKA",15],["STR√ìJ NA WF",10],["WODA",5]]},
            {q:"MiesiƒÖc letni?", a:[["LIPIEC",45],["SIERPIE≈É",35],["CZERWIEC",20]]},
            {q:"Kolor tƒôczy?", a:[["CZERWONY",30],["NIEBIESKI",25],["≈ª√ì≈ÅTY",20],["ZIELONY",15],["FIOLETOWY",10]]},
            {q:"Miasto w Polsce?", a:[["WARSZAWA",40],["KRAK√ìW",30],["WROC≈ÅAW",15],["GDA≈ÉSK",10],["POZNA≈É",5]]},
            {q:"Warzywo do zupy?", a:[["MARCHEW",40],["PIETRUSZKA",25],["SELER",15],["POR",10],["CEBULA",5]]}
        ];

        let peer = new Peer(), conn, currentScore=0, currentTeam='A';

        function connectToTV() {
            const id = document.getElementById('tv-id').value;
            conn = peer.connect(id);
            conn.on('open', () => {
                document.getElementById('conn-btn').innerText = "PO≈ÅƒÑCZONO!";
                document.getElementById('conn-btn').style.background = "lime";
            });
        }

        window.onload = () => {
            const s = document.getElementById('q-sel');
            db.forEach((it, i) => s.innerHTML += `<option value="${i}">${it.q}</option>`);
            preview(); setTeam('A');
        };

        function send(d) { if(conn) conn.send(d); }

        function preview() {
            const d = db[document.getElementById('q-sel').value];
            const div = document.getElementById('ans-list'); div.innerHTML = "";
            d.a.forEach((ans, i) => { 
                div.innerHTML += `<button onclick="reveal(${i}, ${ans[1]})">${ans[0]} (${ans[1]})</button>`; 
            });
        }

        function setTeam(t) {
            currentTeam = t;
            document.getElementById('ta').className = t==='A' ? 'blue active' : 'blue';
            document.getElementById('tb').className = t==='B' ? 'red active' : 'red';
        }

        function sendSetup() {
            currentScore = 0; document.getElementById('scr').innerText = 0;
            const q = db[document.getElementById('q-sel').value];
            const r = document.getElementById('r-sel').value;
            const m = r == 3 ? 2 : (r == 4 ? 3 : 1);
            send({type:'SETUP_ROUND', rNum:r, mult:m, answers: q.a.map(x=>({text:x[0], points:x[1]}))});
        }

        function reveal(i, p) {
            const r = document.getElementById('r-sel').value;
            const m = r == 3 ? 2 : (r == 4 ? 3 : 1);
            currentScore += (p * m); 
            document.getElementById('scr').innerText = currentScore;
            send({type:'REVEAL', idx:i}); 
            send({type:'SCORE', r:currentScore});
        }

        function resetScore() {
            currentScore = 0;
            document.getElementById('scr').innerText = 0;
            send({type:'SCORE', r:0});
        }
    </script>
</body>
</html>
