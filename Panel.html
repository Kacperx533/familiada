<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>PILOT - FAMILIADA CONTROL</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: #121212; color: #e0e0e0; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        .top { background: #000; padding: 15px; display: flex; gap: 15px; border-bottom: 3px solid #fbc02d; }
        .main { display: grid; grid-template-columns: 350px 1fr; flex: 1; overflow: hidden; }
        .side { background: #1e1e1e; padding: 20px; border-right: 1px solid #333; overflow-y: auto; }
        .work { padding: 20px; overflow-y: auto; background: #121212; }
        
        .card { background: #252525; border-radius: 10px; padding: 20px; margin-bottom: 20px; border: 1px solid #333; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        h3 { margin-top: 0; color: #fbc02d; text-transform: uppercase; font-size: 14px; letter-spacing: 1px; }

        button { border: none; padding: 12px; border-radius: 6px; font-weight: bold; cursor: pointer; transition: 0.3s; text-transform: uppercase; }
        button:active { transform: translateY(2px); }
        
        .btn-primary { background: #fbc02d; color: #000; width: 100%; margin-bottom: 8px; }
        .btn-blue { background: #1976d2; color: #fff; }
        .btn-red { background: #d32f2f; color: #fff; }
        .btn-gray { background: #424242; color: #fff; }

        input, textarea, select { width: 100%; padding: 10px; margin: 10px 0; background: #000; color: #fff; border: 1px solid #444; border-radius: 5px; }
        .score-val { font-size: 50px; text-align: center; color: #fbc02d; font-family: monospace; background: #000; border-radius: 10px; margin: 10px 0; }
        .row-item { display: flex; align-items: center; gap: 10px; background: #333; padding: 8px; margin-bottom: 5px; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="top">
        <input id="target-id" placeholder="ID Z EKRANU TV" style="width: 200px; margin: 0;">
        <button onclick="connect()" class="btn-blue" style="padding: 0 20px;">PO≈ÅƒÑCZ</button>
        <button onclick="send({type:'PLAY_VID'})" class="btn-primary" style="width: auto;">üé¨ CZO≈Å√ìWKA (WIDEO)</button>
        <button onclick="send({type:'PLAY_SND', id:'snd-intro'})" class="btn-gray">üéµ INTRO (AUDIO)</button>
    </div>

    <div class="main">
        <div class="side">
            <h3>D≈∫wiƒôki i Efekty</h3>
            <button class="btn-primary" onclick="send({type:'PLAY_SND', id:'snd-runda'})">üéµ START RUNDY</button>
            <button class="btn-primary" onclick="send({type:'PLAY_SND', id:'snd-final'})">üéµ MUZYKA FINA≈ÅU</button>
            <button class="btn-gray" onclick="send({type:'PLAY_SND', id:'snd-powt'})" style="background: #ef6c00;">‚ö†Ô∏è POWT√ìRKA</button>
            
            <h3 style="margin-top:20px">B≈Çƒôdy X</h3>
            <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:5px">
                <button class="btn-red" onclick="send({type:'X', count:1})">X</button>
                <button class="btn-red" onclick="send({type:'X', count:2})">XX</button>
                <button class="btn-red" onclick="send({type:'X', count:3})">XXX</button>
            </div>

            <h3 style="margin-top:20px">Punkty</h3>
            <div class="score-val" id="local-score">0</div>
            <input type="number" id="manual-score" value="0" onchange="syncScore()">
        </div>

        <div class="work">
            <div class="card">
                <h3>Gotowe Zestawy Pyta≈Ñ</h3>
                <select id="preset-select" onchange="applyPreset()">
                    <option value="">-- WYBIERZ ZESTAW --</option>
                    <option value="r1">Runda 1: Co mo≈ºna robiƒá rano?</option>
                    <option value="r2">Runda 2: Wiƒôcej ni≈º jedno zwierzƒô to...</option>
                    <option value="f1">FINA≈Å: Zestaw 1</option>
                </select>
                <textarea id="raw-data" rows="4" placeholder="Odpowied≈∫, Punkty"></textarea>
                <button onclick="setupNormal()" class="btn-primary">ZA≈ÅADUJ NA TABLICƒò</button>
                <div id="normal-controls" style="margin-top:15px"></div>
            </div>

            <div class="card">
                <h3>Tryb Fina≈Çowy</h3>
                <button onclick="setupFinal()" class="btn-blue" style="width:100%">PRZE≈ÅƒÑCZ EKRAN NA FINA≈Å</button>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-top:15px">
                    <div>
                        <button onclick="send({type:'TIMER', sec:15})" class="btn-red">ZEGAR 15S (G1)</button>
                        <div id="p1-ui" style="margin-top:10px"></div>
                        <button onclick="send({type:'HIDE_P1'})" class="btn-gray" style="width:100%; margin-top:5px">UKRYJ G1</button>
                    </div>
                    <div>
                        <button onclick="send({type:'TIMER', sec:20})" class="btn-red">ZEGAR 20S (G2)</button>
                        <div id="p2-ui" style="margin-top:10px"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const peer = new Peer();
        let conn;
        let score = 0;

        const presets = {
            r1: "MYƒÜ ZƒòBY,35\nPIƒÜ KAWƒò,25\nUBIERAƒÜ SIƒò,15\n≈öCIELIƒÜ ≈Å√ì≈ªKO,10",
            r2: "OWCE,40\nLUDZIE,30\nKROWY,15\nRYBY,10",
            f1: "JAB≈ÅKO,30\nBANAN,20\nGRUSZKA,15\nPOMARA≈ÉCZA,10\n≈öLIWKA,5"
        };

        function applyPreset() {
            const val = document.getElementById('preset-select').value;
            if(val) document.getElementById('raw-data').value = presets[val];
        }

        function connect() {
            conn = peer.connect(document.getElementById('target-id').value.toUpperCase());
            conn.on('open', () => alert("PO≈ÅƒÑCZONO!"));
        }

        function send(d) { if(conn) conn.send(d); }

        function setupNormal() {
            const lines = document.getElementById('raw-data').value.split('\n');
            const ans = lines.map(l => ({ t: l.split(',')[0], p: parseInt(l.split(',')[1]) || 0 }));
            send({type: 'SETUP_NORMAL', ans: ans});
            document.getElementById('normal-controls').innerHTML = ans.map((a, i) => `
                <div class="row-item"><span>${a.t} (${a.p})</span> 
                <button onclick="reveal(${i}, '${a.t}', ${a.p})" class="btn-blue">OK</button></div>`).join('');
        }

        function reveal(idx, t, p) {
            send({type: 'REV', mode: 'normal', idx: idx, t: t, p: p});
            score += p; syncScore();
        }

        function setupFinal() {
            send({type: 'SETUP_FINAL'});
            score = 0; syncScore();
            const gen = (pid) => {
                let h = '';
                for(let i=0; i<5; i++) {
                    h += `<div class="row-item"><input id="p${pid}t${i}" placeholder="Has≈Ço" style="width:80px">
                          <input id="p${pid}p${i}" placeholder="Pkt" style="width:40px">
                          <button onclick="revFinal(${pid}, ${i})" class="btn-blue">OK</button></div>`;
                }
                document.getElementById(`p${pid}-ui`).innerHTML = h;
            };
            gen(1); gen(2);
        }

        function revFinal(pid, idx) {
            const t = document.getElementById(`p${pid}t${idx}`).value;
            const p = parseInt(document.getElementById(`p${pid}p${idx}`).value) || 0;
            send({type: 'REV', mode: 'final', player: pid, idx: idx, t: t, p: p});
            score += p; syncScore();
        }

        function syncScore() {
            document.getElementById('local-score').innerText = score;
            document.getElementById('manual-score').value = score;
            send({type: 'SCORE', val: score});
        }
    </script>
</body>
</html>
