<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FAMILIADA - PANEL STEROWANIA</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root {
            --primary: #bb86fc;
            --secondary: #03dac6;
            --bg: #121212;
            --surface: #1e1e1e;
            --error: #cf6679;
            --on-surface: #ffffff;
            --gold: #f1c40f;
        }

        body {
            font-family: 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg);
            color: var(--on-surface);
            margin: 0;
            padding: 10px;
            padding-bottom: 40px;
        }

        .card {
            background: var(--surface);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            border: 1px solid #333;
        }

        h3, h4 { margin: 0 0 10px 0; color: var(--primary); text-transform: uppercase; font-size: 14px; }

        input, select {
            width: 100%;
            padding: 12px;
            margin: 5px 0;
            background: #2c2c2c;
            border: 1px solid #444;
            color: white;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
        }

        .btn {
            border: none;
            border-radius: 8px;
            padding: 12px;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            transition: opacity 0.2s;
            display: inline-block;
        }

        .btn-green { background: #2e7d32; color: white; }
        .btn-red { background: var(--error); color: white; }
        .btn-violet { background: var(--primary); color: black; }
        .btn-outline { background: transparent; border: 1px solid var(--primary); color: var(--primary); }

        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }

        .ans-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #2c2c2c;
            padding: 8px 12px;
            margin: 4px 0;
            border-radius: 6px;
            font-size: 14px;
        }

        #panel-id-display {
            background: rgba(241, 196, 15, 0.1);
            color: var(--gold);
            padding: 8px;
            border-radius: 6px;
            text-align: center;
            border: 1px solid var(--gold);
            font-weight: bold;
            font-size: 14px;
        }

        .strike-btn {
            background: #ff0000;
            height: 70px;
            font-size: 30px;
            color: white;
            width: 100%;
            margin-top: 10px;
            border-radius: 12px;
        }

        .final-grid {
            display: grid;
            grid-template-columns: 1fr 50px 40px 40px;
            gap: 4px;
            margin-bottom: 8px;
            align-items: center;
        }

        .final-grid span { font-size: 11px; grid-column: span 4; color: #aaa; }

        .active-team { border: 3px solid var(--gold) !important; }
    </style>
</head>
<body>

    <div id="setup" class="card">
        <h3>1. Po≈ÇƒÖcz z TV</h3>
        <input type="text" id="tv-id" placeholder="Wpisz ID z ekranu TV">
        <button onclick="connectToTV()" class="btn btn-green" style="width:100%">PO≈ÅƒÑCZ Z TABLICƒÑ</button>
        <p id="panel-id-display">Oczekiwanie na ID...</p>
    </div>

    <div id="controls" style="display:none">
        
        <div class="card grid-2">
            <button onclick="sendToTV({type:'START_INTRO'})" class="btn btn-green">‚ñ∂ START</button>
            <button onclick="sendToTV({type:'SHOW_CREDITS'})" class="btn btn-outline">NAPISY</button>
        </div>

        <div class="card">
            <h4>Runda / Grzybki</h4>
            <div class="grid-2" style="margin-bottom:8px;">
                <button onclick="setR(1)" class="btn btn-outline">R1</button>
                <button onclick="setR(2)" class="btn btn-outline">R2</button>
                <button onclick="setR(3)" class="btn btn-outline">R3</button>
                <button onclick="setR('final')" class="btn btn-violet">FINA≈Å</button>
            </div>
            <button onclick="broadcast({type:'UNLOCK'})" class="btn btn-green" style="width:100%">üîì ODBLOKUJ GRZYBKI</button>
        </div>

        <div id="normal-game" class="card">
            <h4>Pytania</h4>
            <select id="q-select" onchange="loadQ()"></select>
            <button onclick="sendQ()" class="btn btn-violet" style="width:100%">WY≈öLIJ NA TV</button>
            <div id="ans-list"></div>
        </div>

        <div id="final-game" class="card" style="display:none">
            <h4>Fina≈Ç</h4>
            <select id="f-select" onchange="loadFinal()"></select>
            <div id="f-inputs"></div>
        </div>

        <div class="card">
            <div class="grid-2">
                <button onclick="setTeam('A')" id="btnA" class="btn" style="background: var(--error);">TEAM A</button>
                <button onclick="setTeam('B')" id="btnB" class="btn" style="background: var(--secondary); color: black;">TEAM B</button>
            </div>
            <button onclick="sendToTV({type:'STRIKE'}); if(activeTeam) strikes[activeTeam]++; sync();" class="btn strike-btn">‚ùå B≈ÅƒÑD (X)</button>
            <div class="grid-2" style="margin-top:10px;">
                <input type="number" id="scA" value="0" onchange="sync()">
                <input type="number" id="scB" value="0" onchange="sync()">
            </div>
            <button onclick="strikes={A:0, B:0}; sync();" class="btn btn-outline" style="width:100%; margin-top:5px;">RESET X</button>
        </div>
    </div>

    <script>
        let peer = new Peer();
        let tvConn, buzzerConns = [], activeTeam = null, strikes = {A:0, B:0}, currentAnswers = [], multiplier = 1;

        const db = [
            { q: "Wiƒôcej ni≈º jedno zwierzƒô?", a: [["Owce", 32], ["Lama", 21], ["Stado", 15], ["Wataha", 10], ["Para", 5]] },
            { q: "Polska potrawa wigilijna?", a: [["Barszcz", 45], ["Karp", 30], ["Pierogi", 15], ["Uszka", 8], ["Kutia", 2]] },
            { q: "Przedmiot w szkole?", a: [["Matematyka", 40], ["Polski", 25], ["WF", 15], ["Historia", 10], ["Biologia", 5]] },
            { q: "Zwierzƒô na literƒô K?", a: [["Kot", 48], ["Ko≈Ñ", 22], ["Krowa", 15], ["Kura", 10], ["Kangur", 5]] },
            { q: "Co≈õ, co ma k√≥≈Çka?", a: [["Samoch√≥d", 50], ["Rower", 25], ["W√≥zek", 12], ["Hulajnoga", 8]] },
            { q: "Co robimy w lesie?", a: [["Spacerujemy", 42], ["Grzyby", 38], ["Biegamy", 10], ["Odpoczywamy", 7]] },
            { q: "Owoc cytrusowy?", a: [["Cytryna", 40], ["Pomara≈Ñcza", 35], ["Mandarynka", 15], ["Grejpfrut", 8]] },
            { q: "Zajƒôcie na wakacje?", a: [["P≈Çywanie", 40], ["Opalanie", 30], ["Zwiedzanie", 15], ["G√≥ry", 10]] },
            { q: "Co pijemy rano?", a: [["Kawa", 45], ["Herbata", 30], ["Woda", 15], ["Sok", 10]] },
            { q: "Element pogody?", a: [["Deszcz", 40], ["S≈Ço≈Ñce", 35], ["Wiatr", 15], ["≈önieg", 10]] },
            { q: "Co≈õ na literƒô B?", a: [["Banan", 30], ["Buty", 25], ["Buda", 15], ["Bia≈Çy", 10]] },
            { q: "Kwiat na randkƒô?", a: [["R√≥≈ºa", 60], ["Tulipan", 20], ["Go≈∫dzik", 10], ["Lilie", 5]] },
            { q: "Sprzƒôt w kuchni?", a: [["Lod√≥wka", 40], ["Kuchenka", 30], ["Mikser", 15], ["Zmywarka", 10]] },
            { q: "S≈Çodki deser?", a: [["Lody", 45], ["Ciasto", 30], ["Czekolada", 15], ["Budy≈Ñ", 10]] },
            { q: "Co≈õ, co lata?", a: [["Ptak", 50], ["Samolot", 30], ["Mucha", 15], ["Balon", 5]] }
        ];

        const finalDb = [
            { n: "Fina≈Ç 1: Wakacje", qs: ["Miejsce?", "W walizce?", "Nap√≥j?", "Pojazd?", "Na pla≈ºƒô?"], q: ["Morze", "Ubrania", "Woda", "Samolot", "Rƒôcznik"], p: [45, 30, 20, 15, 10] },
            { n: "Fina≈Ç 2: Dom", qs: ["Pok√≥j?", "Mebel?", "Kuchnia?", "≈öciana?", "Zwierzƒô?"], q: ["Salon", "Kanapa", "Lod√≥wka", "Obraz", "Pies"], p: [40, 35, 25, 10, 5] },
            { n: "Fina≈Ç 3: Natura", qs: ["Drzewo?", "Zwierzƒô?", "Kwiat?", "Pogoda?", "G√≥ry?"], q: ["DƒÖb", "Jele≈Ñ", "Tulipan", "Deszcz", "Rysy"], p: [35, 25, 20, 15, 5] },
            { n: "Fina≈Ç 4: Zawody", qs: ["Mundur?", "Szko≈Ça?", "Szpital?", "Biuro?", "Fizyczna?"], q: ["Policjant", "Nauczyciel", "Lekarz", "Informatyk", "Budowlaniec"], p: [40, 30, 20, 5, 5] },
            { n: "Fina≈Ç 5: Jedzenie", qs: ["Bia≈Çy nap√≥j?", "Obiad?", "S≈Çodycz?", "Pizza?", "Chleb?"], q: ["Mleko", "Ziemniaki", "Czekolada", "Ser", "Chleb"], p: [50, 25, 10, 10, 5] }
        ];

        peer.on('open', id => document.getElementById('panel-id-display').innerText = "ID PANELU: " + id);
        peer.on('connection', conn => {
            buzzerConns.push(conn);
            conn.on('data', m => { if(m.type === 'BUZZ') sendToTV(m); });
        });

        function connectToTV() {
            tvConn = peer.connect(document.getElementById('tv-id').value);
            tvConn.on('open', () => {
                document.getElementById('setup').style.display='none';
                document.getElementById('controls').style.display='block';
                const qs = document.getElementById('q-select');
                qs.innerHTML = '<option value="">-- WYBIERZ PYTANIE --</option>';
                db.forEach((d, i) => qs.innerHTML += `<option value="${i}">${d.q}</option>`);
                const fs = document.getElementById('f-select');
                fs.innerHTML = '<option value="">-- WYBIERZ FINA≈Å --</option>';
                finalDb.forEach((f, i) => fs.innerHTML += `<option value="${i}">${f.n}</option>`);
            });
        }

        function broadcast(m) { buzzerConns.forEach(c => { if(c.open) c.send(m); }); }
        function sendToTV(m) { if(tvConn && tvConn.open) tvConn.send(m); }
        function setR(r) { multiplier = (typeof r === 'number') ? r : 1; document.getElementById('normal-game').style.display = (r === 'final') ? 'none' : 'block'; document.getElementById('final-game').style.display = (r === 'final') ? 'block' : 'none'; sendToTV({type: 'NEXT_ROUND', round: r}); strikes = {A:0, B:0}; sync(); }
        
        function loadQ() { 
            const val = document.getElementById('q-select').value; if(val==="") return; 
            const d = db[val]; currentAnswers = d.a; 
            let list = document.getElementById('ans-list'); list.innerHTML = ""; 
            d.a.forEach((a, i) => { list.innerHTML += `<div class="ans-row"><span>${a[0]} (${a[1]})</span><button onclick="reveal(${i})" class="btn btn-outline" style="padding:5px 10px">ODKRYJ</button></div>`; }); 
        }

        function sendQ() { const val = document.getElementById('q-select').value; if(val==="") return; sendToTV({type:'SETUP', q: db[val].q, a: currentAnswers.map(x=>({t:x[0], p:x[1]}))}); }
        function reveal(i) { let pts = currentAnswers[i][1] * multiplier; sendToTV({type:'REVEAL', index:i, text:currentAnswers[i][0], pts: pts}); if(activeTeam) { let s = document.getElementById('sc'+activeTeam); s.value = parseInt(s.value) + pts; sync(); } }
        
        function loadFinal() { 
            const val = document.getElementById('f-select').value; if(val==="") return; 
            const f = finalDb[val]; const div = document.getElementById('f-inputs'); div.innerHTML = ""; 
            for(let p=1; p<=2; p++) { div.innerHTML += `<h4>GRACZ ${p}</h4>`; for(let i=0; i<5; i++) { div.innerHTML += `<div class="final-grid"><span>${f.qs[i]}</span><input id="f-t-${p}-${i}" value="${p==1?f.q[i]:''}" placeholder="Odp"><input id="f-p-${p}-${i}" value="${p==1?f.p[i]:''}" style="width:40px"><button onclick="rf(${p},${i},'t')" class="btn btn-outline" style="padding:5px">T</button><button onclick="rf(${p},${i},'p')" class="btn btn-green" style="padding:5px">P</button></div>`; } } 
        }

        function rf(p, r, k) { const val = document.getElementById(`f-${k}-${p}-${r}`).value; sendToTV({type:'FINAL_REVEAL', p:p, r:r, k:k, v:val}); }
        function setTeam(t) { activeTeam = t; document.getElementById('btnA').classList.toggle('active-team', t==='A'); document.getElementById('btnB').classList.toggle('active-team', t==='B'); }
        function sync() { sendToTV({type:'UPDATE', scA:document.getElementById('scA').value, scB:document.getElementById('scB').value, strikes:strikes}); }
    </script>
</body>
</html>
