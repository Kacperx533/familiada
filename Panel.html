<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>PILOT FAMILIADA - PRO</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #121212; color: #fff; margin: 0; display: grid; grid-template-columns: 300px 1fr; height: 100vh; }
        .sidebar { background: #1e1e1e; padding: 20px; border-right: 2px solid #fbc02d; }
        .main { padding: 20px; overflow-y: auto; }
        .card { background: #252525; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #333; }
        h3 { color: #fbc02d; margin: 0 0 10px 0; font-size: 14px; }
        button { width: 100%; padding: 10px; margin-bottom: 5px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; text-transform: uppercase; }
        .btn-yellow { background: #fbc02d; color: #000; }
        .btn-blue { background: #1976d2; color: #fff; }
        .btn-red { background: #d32f2f; color: #fff; }
        input, select, textarea { width: 100%; padding: 8px; margin: 5px 0; background: #000; color: #fff; border: 1px solid #444; box-sizing: border-box; }
        .score-display { font-size: 40px; text-align: center; color: #fbc02d; background: #000; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .row-ctrl { display: flex; gap: 5px; align-items: center; margin-bottom: 5px; background: #333; padding: 5px; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="sidebar">
        <h3>PO≈ÅƒÑCZENIE</h3>
        <input id="target-id" placeholder="KOD (3 ZNAKI)" maxlength="3" style="font-size: 20px; text-align: center;">
        <button onclick="connect()" class="btn-blue">PO≈ÅƒÑCZ</button>
        
        <h3 style="margin-top:20px">MULTIMEDIA</h3>
        <button class="btn-yellow" onclick="send({type:'PLAY_VID'})">üé¨ CZO≈Å√ìWKA (WIDEO)</button>
        <button class="btn-yellow" onclick="send({type:'PLAY_SND', id:'snd-runda'})">üéµ START RUNDY</button>
        <button class="btn-yellow" onclick="send({type:'PLAY_SND', id:'snd-final'})">üéµ MUZYKA FINA≈ÅU</button>
        <button class="btn-blue" onclick="send({type:'PLAY_SND', id:'snd-powt'})">‚ö†Ô∏è POWT√ìRZENIE</button>
        
        <h3 style="margin-top:20px">B≈ÅƒòDY X</h3>
        <div style="display:flex; gap:5px">
            <button class="btn-red" onclick="send({type:'X', count:1})">X</button>
            <button class="btn-red" onclick="send({type:'X', count:2})">XX</button>
            <button class="btn-red" onclick="send({type:'X', count:3})">XXX</button>
        </div>

        <h3 style="margin-top:20px">PUNKTY</h3>
        <div class="score-display" id="local-score">0</div>
        <button onclick="addPoints(5)" class="btn-blue">+5 PKT</button>
        <button onclick="score=0; syncScore()" style="background:#444; color:#fff">ZERUJ</button>
    </div>

    <div class="main">
        <div class="card">
            <h3>RUNDY 1-4 (WYBIERZ ZESTAW)</h3>
            <select id="preset-sel" onchange="loadPreset()">
                <option value="">-- Wybierz runda --</option>
                <option value="r1">Runda 1: Co robimy rano?</option>
                <option value="r2">Runda 2: Zwierzƒô domowe</option>
            </select>
            <textarea id="raw-data" rows="3" placeholder="Has≈Ço, Punkty"></textarea>
            <button onclick="setupNormal()" class="btn-yellow">WY≈öLIJ NA TABLICƒò</button>
            <div id="normal-btns" style="margin-top:10px"></div>
        </div>

        <div class="card">
            <h3>TRYB FINA≈ÅOWY</h3>
            <button onclick="setupFinal()" class="btn-blue">W≈ÅƒÑCZ TABLICƒò FINA≈ÅU</button>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-top:15px">
                <div>
                    <button onclick="send({type:'TIMER', sec:15})" class="btn-red">ZEGAR 15S</button>
                    <div id="p1-inputs" style="margin-top:10px"></div>
                    <button onclick="send({type:'HIDE_P1'})" style="background:#555; color:#fff">UKRYJ G1</button>
                </div>
                <div>
                    <button onclick="send({type:'TIMER', sec:20})" class="btn-red">ZEGAR 20S</button>
                    <div id="p2-inputs" style="margin-top:10px"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const peer = new Peer();
        let conn, score = 0;
        const presets = {
            r1: "MYƒÜ ZƒòBY,35\nPIƒÜ KAWƒò,25\nUBIERAƒÜ SIƒò,15\n≈öCIELIƒÜ ≈Å√ì≈ªKO,10",
            r2: "PIES,40\nKOT,30\nCHOMIK,15\nRYBKI,10"
        };

        function loadPreset() { const p = presets[document.getElementById('preset-sel').value]; if(p) document.getElementById('raw-data').value = p; }
        function connect() { conn = peer.connect(document.getElementById('target-id').value.toUpperCase()); conn.on('open', () => alert("PO≈ÅƒÑCZONO!")); }
        function send(d) { if(conn) conn.send(d); }

        function setupNormal() {
            const lines = document.getElementById('raw-data').value.split('\n');
            const ans = lines.map(l => ({ t: l.split(',')[0], p: parseInt(l.split(',')[1]) || 0 }));
            send({type: 'SETUP_NORMAL', ans: ans});
            document.getElementById('normal-btns').innerHTML = ans.map((a, i) => `
                <div class="row-ctrl"><span>${a.t} (${a.p})</span> 
                <button onclick="rev(${i},'${a.t}',${a.p})" style="width:60px" class="btn-blue">OK</button></div>`).join('');
        }

        function rev(idx, t, p) { send({type:'REV', mode:'normal', idx:idx, t:t, p:p}); score += p; syncScore(); }

        function setupFinal() {
            send({type: 'SETUP_FINAL'}); score = 0; syncScore();
            const gen = (pid) => {
                let h = '';
                for(let i=0; i<5; i++) h += `<div class="row-ctrl"><input id="p${pid}t${i}" placeholder="H" style="width:70px"><input id="p${pid}p${i}" placeholder="P" style="width:30px"><button onclick="revF(${pid},${i})" class="btn-blue">OK</button></div>`;
                document.getElementById(`p${pid}-inputs`).innerHTML = h;
            };
            gen(1); gen(2);
        }

        function revF(pid, idx) {
            const t = document.getElementById(`p${pid}t${idx}`).value;
            const p = parseInt(document.getElementById(`p${pid}p${idx}`).value) || 0;
            send({type:'REV', mode:'final', player:pid, idx:idx, t:t, p:p}); score += p; syncScore();
        }

        function addPoints(v) { score += v; syncScore(); }
        function syncScore() { document.getElementById('local-score').innerText = score; send({type:'SCORE', val:score}); }
    </script>
</body>
</html>
