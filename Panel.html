<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>PANEL FAMILIADA</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #222; color: #fff; display: grid; grid-template-columns: 320px 1fr 320px; gap: 10px; padding: 10px; }
        .card { background: #333; padding: 15px; border-radius: 8px; border-top: 4px solid gold; margin-bottom: 10px; }
        h3 { margin: 0 0 10px; font-size: 14px; color: gold; text-transform: uppercase; }
        button { width: 100%; padding: 10px; margin: 2px 0; cursor: pointer; border: none; font-weight: bold; border-radius: 4px; }
        .b-ok { background: #28a745; color: white; }
        .b-zla { background: #dc3545; color: white; }
        .b-blue { background: #007bff; color: white; }
        .b-gold { background: gold; color: #000; }
        input, select { width: 100%; padding: 8px; box-sizing: border-box; background: #000; color: #fff; border: 1px solid #555; margin-bottom: 5px; }
        .preview-btn { text-align: left; background: #444; color: #fff; }
    </style>
</head>
<body>

    <div class="col">
        <div class="card">
            <h3>1. Po≈ÇƒÖczenie</h3>
            <input type="text" id="peer-id" placeholder="Wklej ID z TV">
            <button class="b-ok" onclick="connect()">PO≈ÅƒÑCZ</button>
        </div>
        <div class="card">
            <h3>2. Dru≈ºyny</h3>
            <input type="text" id="n1" value="DRU≈ªYNA A">
            <input type="text" id="n2" value="DRU≈ªYNA B">
            <button class="b-blue" onclick="updateNames()">USTAW NAZWY</button>
            <hr>
            <button class="b-gold" onclick="addPts('1')">DAJ PUNKTY LEWEJ</button>
            <button class="b-gold" onclick="addPts('2')">DAJ PUNKTY PRAWEJ</button>
            <button onclick="resetAll()">RESET PUNKT√ìW</button>
        </div>
        <div class="card">
            <h3>3. Multimedia</h3>
            <button class="b-blue" onclick="send({type:'INTRO'})">üé¨ CZO≈Å√ìWKA</button>
            <button class="b-zla" onclick="send({type:'STRIKE', num:1})">‚ùå Z≈ÅA (X)</button>
            <button class="b-zla" onclick="send({type:'STRIKE', num:2})">‚ùå‚ùå Z≈ÅA (XX)</button>
            <button class="b-zla" onclick="send({type:'STRIKE', num:3})">‚ùå‚ùå‚ùå Z≈ÅA (XXX)</button>
        </div>
    </div>

    <div class="col">
        <div class="card">
            <h3>4. Pytania i Rundy</h3>
            <select id="m-select"><option value="1">Mno≈ºnik x1</option><option value="2">Mno≈ºnik x2</option><option value="3">Mno≈ºnik x3</option></select>
            <select id="q-select" onchange="loadQ()" size="12"></select>
            <button class="b-ok" onclick="sendQ()">WY≈öLIJ PYTANIE NA TABLICƒò</button>
        </div>
        <div class="card" id="ans-list">
            <h3>Odpowiedzi (Kliknij = OK)</h3>
        </div>
    </div>

    <div class="col">
        <div class="card">
            <h3>5. Fina≈Ç</h3>
            <button class="b-zla" onclick="send({type:'FINAL_MODE'})">AKTYWUJ FINA≈Å</button>
            <input type="text" id="ft" placeholder="S≈Çowo">
            <input type="number" id="fp" placeholder="Punkty">
            <select id="fi"><option value="0">Pytanie 1</option><option value="1">Pytanie 2</option><option value="2">Pytanie 3</option><option value="3">Pytanie 4</option><option value="4">Pytanie 5</option></select>
            <button class="b-blue" onclick="sendF(1)">GRACZ 1 (OK)</button>
            <button class="b-gold" onclick="sendF(2)">GRACZ 2 (OK)</button>
        </div>
    </div>

    <script>
        const DB = [
            {q:"Co robimy rano?", a:[["MYJEMY ZƒòBY",40],["PIJEMY KAWƒò",30],["UBIERAMY SIƒò",15],["≈öCIELIMY ≈Å√ì≈ªKO",10],["ƒÜWICZYMY",5]]},
            {q:"Zwierzƒô na wie≈õ?", a:[["KROWA",45],["KO≈É",25],["KURA",15],["≈öWINIA",10],["KACZKA",5]]},
            {q:"Przedmiot szkolny?", a:[["MATEMATYKA",40],["POLSKI",20],["WF",20],["HISTORIA",10],["PLASTYKA",10]]}
        ];
        for(let i=4; i<=50; i++) DB.push({q:"Pytanie zapasowe "+i, a:[["ODPOWIED≈π 1",50],["ODPOWIED≈π 2",30],["ODPOWIED≈π 3",20]]});

        let conn, peer = new Peer(), s1=0, s2=0, rSum=0;

        window.onload = () => {
            const sel = document.getElementById('q-select');
            DB.forEach((x, i) => sel.innerHTML += `<option value="${i}">${i+1}. ${x.q}</option>`);
        };

        function connect() {
            conn = peer.connect(document.getElementById('peer-id').value);
            conn.on('open', () => alert("Po≈ÇƒÖczono!"));
        }

        function send(d) { if(conn) conn.send(d); }

        function loadQ() {
            const q = DB[document.getElementById('q-select').value];
            const list = document.getElementById('ans-list');
            list.innerHTML = '<h3>Odpowiedzi (Kliknij = OK)</h3>';
            q.a.forEach((x, i) => {
                list.innerHTML += `<button class="preview-btn" onclick="reveal(${i}, ${x[1]})">${x[0]} (${x[1]})</button>`;
            });
        }

        function sendQ() {
            rSum = 0; updateScore();
            const q = DB[document.getElementById('q-select').value];
            const m = document.getElementById('m-select').value;
            send({type:'SETUP', ans: q.a.map(x=>({t:x[0], p:x[1]*m}))});
            loadQ();
        }

        function reveal(idx, pts) {
            const m = document.getElementById('m-select').value;
            rSum += (pts * m);
            updateScore();
            send({type:'REV', idx: idx});
        }

        function updateNames() {
            send({type:'NAMES', n1: document.getElementById('n1').value, n2: document.getElementById('n2').value});
        }

        function addPts(t) {
            if(t==='1') s1 += rSum; else s2 += rSum;
            rSum = 0; updateScore();
        }

        function updateScore() {
            send({type:'SCORE', s1:s1, s2:s2, sum:rSum});
        }

        function resetAll() { s1=0; s2=0; rSum=0; updateScore(); }

        function sendF(p) {
            send({type:'FINAL_REV', p:p, i:document.getElementById('fi').value, txt:document.getElementById('ft').value.toUpperCase(), pts:document.getElementById('fp').value});
        }
    </script>
</body>
</html>
