<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>PANEL STEROWANIA</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #111; color: white; padding: 20px; display: grid; grid-template-columns: 380px 1fr; gap: 20px; }
        .card { background: #222; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-top: 3px solid #dfff00; }
        button { width: 100%; padding: 10px; margin: 2px 0; cursor: pointer; font-weight: bold; border: none; border-radius: 4px; }
        .btn-gold { background: #dfff00; color: #000; }
        .btn-blue { background: #0055ff; color: #fff; }
        .btn-red { background: #aa0000; color: #fff; }
        input { width: 100%; padding: 8px; background: #000; color: #fff; border: 1px solid #444; box-sizing: border-box; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; }
        h3 { margin-top: 0; color: #dfff00; font-size: 14px; }
    </style>
</head>
<body>
    <div>
        <div class="card">
            <h3>1. PO≈ÅƒÑCZENIE</h3>
            <input id="tv-id" placeholder="Wpisz ID z TV">
            <button class="btn-gold" onclick="connect()">PO≈ÅƒÑCZ</button>
            <button onclick="send({type:'INTRO'})">POKAZ TYTU≈Å (START)</button>
        </div>

        <div class="card">
            <h3>2. RUNDY I MULTIMEDIA</h3>
            <div class="grid">
                <button onclick="startR(1)">RUNDA 1</button>
                <button onclick="startR(2)">RUNDA 2</button>
                <button onclick="startR(3)">RUNDA 3</button>
                <button onclick="startR('FINA≈Å')">FINA≈Å</button>
            </div>
            <button onclick="send({type:'VIDEO'})" style="background:orange;">üé¨ CZO≈Å√ìWKA WIDEO</button>
        </div>

        <div class="card">
            <h3>3. B≈ÅƒòDY (X)</h3>
            <div class="grid">
                <button class="btn-blue" onclick="send({type:'X', side:'L', n:1})">X (L)</button>
                <button class="btn-red" onclick="send({type:'X', side:'R', n:1})">X (P)</button>
                <button class="btn-blue" onclick="send({type:'X', side:'L', n:2})">XX (L)</button>
                <button class="btn-red" onclick="send({type:'X', side:'R', n:2})">XX (P)</button>
                <button class="btn-blue" onclick="send({type:'X', side:'L', n:3})">XXX (L)</button>
                <button class="btn-red" onclick="send({type:'X', side:'R', n:3})">XXX (P)</button>
            </div>
            <button onclick="send({type:'CLEAR_X'})" style="margin-top:5px;">CZY≈öƒÜ WSZYSTKIE IKSY</button>
        </div>
    </div>

    <div>
        <div class="card" id="normal-game">
            <h3>4. STEROWANIE RUNDƒÑ</h3>
            <select id="q-sel" onchange="preview()" style="width:100%; padding:10px; margin-bottom:10px;"></select>
            <button class="btn-gold" onclick="loadQ()">WY≈öLIJ PYTANIE NA TABLICƒò</button>
            <div id="ans-box" style="margin:15px 0"></div>
            <div style="text-align:right; font-size:30px; color:gold">SUMA: <span id="s-sum">0</span></div>
        </div>

        <div class="card" style="border-top-color: #ff00ff;">
            <h3>5. TRYB FINA≈ÅOWY</h3>
            <button class="btn-blue" onclick="prepFinal()">PRZYGOTUJ TABLICƒò FINA≈ÅOWƒÑ</button>
            <div id="final-ui" style="margin-top:10px">
                <div id="f-rows"></div>
            </div>
        </div>
    </div>

    <script>
        const DB = [
            {q:"Przedmiot szkolny", a:[["MATEMATYKA",45],["POLSKI",30],["WF",15],["HISTORIA",10]]},
            {q:"Zwierzƒô domowe", a:[["PIES",50],["KOT",40],["CHOMIK",10]]}
        ];
        let peer = new Peer(), conn, sum = 0;

        function connect() { conn = peer.connect(document.getElementById('tv-id').value); }
        
        window.onload = () => {
            const sel = document.getElementById('q-sel');
            DB.forEach((x,i) => sel.innerHTML += `<option value="${i}">${x.q}</option>`);
            preview();
            
            let fRows = document.getElementById('f-rows');
            for(let i=0; i<5; i++) {
                fRows.innerHTML += `
                    <div class="grid" style="margin-bottom:5px">
                        <input id="ft${i}" placeholder="Odp">
                        <input id="fp${i}" type="number" placeholder="Pkt" style="width:60px">
                        <button onclick="revF(${i})" style="grid-column: span 2; background:#444; color:white">ODKRYJ ${i+1}</button>
                    </div>`;
            }
        };

        function startR(n) { send({type:'ROUND_START', num: n}); }

        function preview() {
            const q = DB[document.getElementById('q-sel').value];
            const box = document.getElementById('ans-box'); box.innerHTML = '';
            q.a.forEach((x, i) => {
                const b = document.createElement('button');
                b.style.textAlign = 'left';
                b.innerHTML = `<span>${i+1}. ${x[0]}</span> <span style="float:right">${x[1]}</span>`;
                b.onclick = () => {
                    if(b.disabled) return;
                    sum += x[1];
                    document.getElementById('s-sum').innerText = sum;
                    send({type:'REV', idx:i, isFinal:false});
                    send({type:'SCORE', val:sum});
                    b.style.background = 'green'; b.disabled = true;
                };
                box.appendChild(b);
            });
        }

        function loadQ() {
            sum = 0; document.getElementById('s-sum').innerText = 0;
            const q = DB[document.getElementById('q-sel').value];
            send({type:'SETUP', ans: q.a.map(x=>({t:x[0], p:x[1]})), isFinal:false});
            preview();
        }

        function prepFinal() {
            sum = 0; document.getElementById('s-sum').innerText = 0;
            send({type:'SETUP', ans:[], isFinal:true});
        }

        function revF(i) {
            const t = document.getElementById('ft'+i).value.toUpperCase();
            const p = parseInt(document.getElementById('fp'+i).value) || 0;
            sum += p;
            document.getElementById('s-sum').innerText = sum;
            send({type:'FINAL_REV', idx:i, t:t, p:p});
            send({type:'SCORE', val:sum});
        }

        function send(d) { if(conn) conn.send(d); }
    </script>
</body>
</html>
