<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>FAMILIADA TV</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root { --led: #dfff00; --red: #ff3333; --bg: #050505; }
        body { background: var(--bg); color: var(--led); font-family: 'VT323', monospace; margin: 0; overflow: hidden; height: 100vh; text-transform: uppercase; }
        .led-overlay { position: fixed; inset: 0; background-image: radial-gradient(circle, transparent 30%, #000 80%); background-size: 5px 5px; pointer-events: none; z-index: 1000; opacity: 0.5; }
        .grid-bg { position: fixed; inset: 0; background-image: linear-gradient(90deg, #000 2px, transparent 2px), linear-gradient(#000 2px, transparent 2px); background-size: 60px 60px; z-index: -1; }
        .stage { display: grid; grid-template-columns: 200px 1fr 200px; width: 98vw; height: 90vh; margin: 5vh auto; gap: 10px; }
        .side-x { display: flex; flex-direction: column; gap: 15px; justify-content: center; }
        .x-box { width: 180px; height: 180px; border: 6px solid #1a1a1a; display: flex; justify-content: center; align-items: center; font-size: 150px; color: #151515; transition: 0.2s; }
        .x-box.active { color: var(--red); text-shadow: 0 0 40px var(--red); border-color: #600; }
        .board { display: flex; flex-direction: column; position: relative; border: 4px solid #111; background: rgba(10,10,10,0.8); }
        .row { display: flex; align-items: center; height: 12vh; font-size: 8vh; border-bottom: 2px solid #000; padding-left: 60px; }
        .row-num { width: 100px; color: var(--led); }
        .row-txt { flex-grow: 1; letter-spacing: 3px; }
        .row-pts { width: 150px; text-align: right; padding-right: 40px; }
        .dots::after { content: "...................."; opacity: 0.15; }
        .sum-box { position: absolute; bottom: 20px; right: 40px; font-size: 10vh; display: flex; gap: 30px; border-top: 2px solid #222; }
        #timer-display { position: absolute; bottom: 20px; left: 40px; font-size: 12vh; color: var(--red); display: none; }
        #msg-overlay { position: fixed; inset: 0; background: var(--bg); display: flex; justify-content: center; align-items: center; z-index: 2000; font-size: 8vh; text-align: center; padding: 20px; }
        #vid-layer { position: fixed; inset: 0; background:black; z-index:5000; display:none; }
        video { width:100%; height:100%; }
    </style>
</head>
<body>
    <div class="led-overlay"></div>
    <div class="grid-bg"></div>
    <div id="msg-overlay">≈Åadowanie systemu...</div>
    <div id="vid-layer"><video id="player"></video></div>
    <div id="timer-display">00</div>
    <div class="stage">
        <div class="side-x"><div class="x-box" id="L1">X</div><div class="x-box" id="L2">X</div><div class="x-box" id="L3">X</div></div>
        <div class="board"><div id="rows"></div><div class="sum-box"><span>SUMA</span><span id="total">0</span></div></div>
        <div class="side-x"><div class="x-box" id="R1">X</div><div class="x-box" id="R2">X</div><div class="x-box" id="R3">X</div></div>
    </div>
    <audio id="snd-ok" src="ok.mp3"></audio>
    <audio id="snd-bad" src="zla.mp3"></audio>
    <audio id="snd-runda" src="runda.mp4"></audio>
    <audio id="snd-timer" src="czas.mp3"></audio>
    <script>
        const peer = new Peer();
        const msg = document.getElementById('msg-overlay');
        let current = [];
        peer.on('open', id => msg.innerText = "PODAJ TEN ID W PANELU: " + id);
        function render(ans, isFinal = false) {
            const container = document.getElementById('rows');
            container.innerHTML = '';
            const count = isFinal ? 5 : 6;
            for(let i=0; i<count; i++) {
                let txt = `<div class="row-txt dots"></div>`, pts = `<div class="row-pts"></div>`;
                if(ans[i] && ans[i].rev) { txt = `<div class="row-txt">${ans[i].t}</div>`; pts = `<div class="row-pts">${ans[i].p}</div>`; }
                const num = isFinal ? "?" : i+1;
                container.innerHTML += `<div class="row"><div class="row-num">${num}</div>${txt}${pts}</div>`;
            }
        }
        peer.on('connection', conn => {
            msg.style.display = 'none';
            conn.on('data', data => {
                if(data.type === 'INTRO') { msg.style.display = 'flex'; msg.innerHTML = "FAMILIADA<br>EDYCJA SZKOLNA"; setTimeout(() => msg.style.display = 'none', 4000); }
                if(data.type === 'ROUND_START') { document.getElementById('snd-runda').play(); msg.style.display = 'flex'; msg.innerText = "RUNDA " + data.num; setTimeout(() => msg.style.display = 'none', 3000); }
                if(data.type === 'TIMER') {
                    const disp = document.getElementById('timer-display');
                    if(data.action === 'start') { disp.style.display = 'block'; disp.innerText = data.val; document.getElementById('snd-timer').play(); }
                    else if(data.action === 'tick') { disp.innerText = data.val; }
                    else { disp.style.display = 'none'; document.getElementById('snd-timer').pause(); }
                }
                if(data.type === 'SETUP') { current = data.ans.map(a => ({...a, rev: false})); render(current, data.isFinal); document.getElementById('total').innerText = "0"; }
                if(data.type === 'REV') { document.getElementById('snd-ok').play(); if(current[data.idx]) { current[data.idx].rev = true; render(current, data.isFinal); } }
                if(data.type === 'FINAL_REV') { document.getElementById('snd-ok').play(); current[data.idx] = { t: data.t, p: data.p, rev: true }; render(current, true); }
                if(data.type === 'SCORE') document.getElementById('total').innerText = data.val;
                if(data.type === 'X') {
                    document.getElementById('snd-bad').play();
                    for(let i=1; i<=3; i++) document.getElementById(data.side+i).classList.toggle('active', i<=data.n);
                }
                if(data.type === 'CLEAR_X') { ['L1','L2','L3','R1','R2','R3'].forEach(id => document.getElementById(id).classList.remove('active')); }
            });
        });
    </script>
</body>
</html>
