<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>FAMILIADA - PANEL STEROWANIA</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #121212; color: #fff; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        .top-bar { background: #000; padding: 10px; display: flex; gap: 10px; align-items: center; border-bottom: 2px solid #333; }
        .main { display: grid; grid-template-columns: 300px 1fr; flex-grow: 1; overflow: hidden; }
        .sidebar { background: #1e1e1e; padding: 15px; border-right: 1px solid #333; overflow-y: auto; }
        .content { padding: 20px; overflow-y: auto; }
        .card { background: #2a2a2a; border-radius: 8px; padding: 15px; margin-bottom: 20px; }
        button { padding: 10px; cursor: pointer; border: none; border-radius: 4px; font-weight: bold; transition: 0.2s; }
        .btn-blue { background: #007bff; color: white; }
        .btn-green { background: #28a745; color: white; }
        .btn-red { background: #dc3545; color: white; }
        .btn-yellow { background: #ffc107; color: black; }
        .btn-sound { background: #6f42c1; color: white; margin-bottom: 5px; width: 100%; }
        input, textarea { background: #000; color: #fff; border: 1px solid #444; padding: 8px; width: 100%; box-sizing: border-box; }
        .row-tool { display: flex; gap: 10px; align-items: center; margin-bottom: 10px; background: #333; padding: 5px; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="top-bar">
        <span>ID TABLICY:</span>
        <input id="target-id" style="width:150px">
        <button onclick="connect()" class="btn-green">PO≈ÅƒÑCZ</button>
        <button onclick="send({type:'SOUND', id:'snd-intro'})" class="btn-blue">üéµ CZO≈Å√ìWKA</button>
        <button onclick="location.reload()">RESET PANELU</button>
    </div>

    <div class="main">
        <div class="sidebar">
            <h3>MULTIMEDIA</h3>
            <button class="btn-sound" onclick="send({type:'SOUND', id:'snd-ok'})">‚úÖ DOBRA ODPOWIED≈π</button>
            <button class="btn-sound" onclick="send({type:'SOUND', id:'snd-bad'})">‚ùå B≈ÅƒÑD / KONIEC CZASU</button>
            <button class="btn-sound" onclick="send({type:'SOUND', id:'snd-repeat'})" style="background:orange">‚ö†Ô∏è POWT√ìRKA (FINA≈Å)</button>
            <hr>
            <h3>B≈ÅƒòDY X</h3>
            <div style="display:flex; gap:5px">
                <button class="btn-red" onclick="send({type:'X', count:1})">X</button>
                <button class="btn-red" onclick="send({type:'X', count:2})">XX</button>
                <button class="btn-red" onclick="send({type:'X', count:3})">XXX</button>
            </div>
            <hr>
            <h3>SUMA PUNKT√ìW</h3>
            <div id="local-score" style="font-size:40px; text-align:center; color:#eaff00">0</div>
            <input type="number" id="score-input" value="0" onchange="updateScore()">
        </div>

        <div class="content">
            <div class="card">
                <h2>RUNDY 1 - 4</h2>
                <textarea id="normal-data" rows="4" placeholder="Odpowied≈∫, Punkty (ka≈ºda w nowej linii)">PIES, 35
KOT, 25
CHOMIK, 15</textarea>
                <button onclick="setupNormal()" class="btn-blue" style="margin-top:10px">USTAW TABLICƒò RUNDY</button>
                <div id="normal-controls" style="margin-top:15px"></div>
            </div>

            <div class="card" style="border-top: 4px solid #ffc107">
                <h2>FINA≈Å</h2>
                <button onclick="setupFinal()" class="btn-yellow">PRZE≈ÅƒÑCZ TABLICƒò NA FINA≈Å</button>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                    <div>
                        <h4>GRACZ 1 (15s)</h4>
                        <button onclick="send({type:'TIMER', sec:15})" class="btn-red">START ZEGARA 15s</button>
                        <div id="p1-inputs"></div>
                        <button onclick="send({type:'HIDE_P1'})" style="margin-top:10px">UKRYJ G1 (DLA G2)</button>
                    </div>
                    <div>
                        <h4>GRACZ 2 (20s)</h4>
                        <button onclick="send({type:'TIMER', sec:20})" class="btn-red">START ZEGARA 20s</button>
                        <div id="p2-inputs"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const peer = new Peer();
        let conn;
        let score = 0;

        function connect() {
            conn = peer.connect(document.getElementById('target-id').value.toUpperCase());
            conn.on('open', () => alert("PO≈ÅƒÑCZONO Z TABLICƒÑ!"));
        }

        function send(d) { if(conn) conn.send(d); }

        function setupNormal() {
            const lines = document.getElementById('normal-data').value.split('\n');
            const ans = lines.map(l => ({ t: l.split(',')[0].trim(), p: parseInt(l.split(',')[1]) || 0 }));
            send({type: 'SETUP_NORMAL', ans: ans});
            
            let html = '';
            ans.forEach((a, i) => {
                html += `<div class="row-tool"><span>${i+1}. ${a.t} (${a.p})</span> 
                    <button onclick="revealNormal(${i}, '${a.t}', ${a.p})" class="btn-green">ODKRYJ</button></div>`;
            });
            document.getElementById('normal-controls').innerHTML = html;
        }

        function revealNormal(idx, t, p) {
            send({type: 'REV', mode: 'normal', idx: idx, t: t, p: p});
            score += p; updateScoreUI();
        }

        function setupFinal() {
            send({type: 'SETUP_FINAL'});
            score = 0; updateScoreUI();
            const gen = (pid) => {
                let h = '';
                for(let i=0; i<5; i++) {
                    h += `<div style="margin-bottom:5px">
                        <input id="p${pid}t${i}" placeholder="Has≈Ço" style="width:100px">
                        <input id="p${pid}p${i}" placeholder="Pkt" style="width:40px">
                        <button onclick="revealFinal(${pid}, ${i})" class="btn-green">OK</button>
                    </div>`;
                }
                document.getElementById(`p${pid}-inputs`).innerHTML = h;
            };
            gen(1); gen(2);
        }

        function revealFinal(pid, idx) {
            const t = document.getElementById(`p${pid}t${idx}`).value;
            const p = parseInt(document.getElementById(`p${pid}p${idx}`).value) || 0;
            send({type: 'REV', mode: 'final', player: pid, idx: idx, t: t, p: p});
            score += p; updateScoreUI();
        }

        function updateScore() {
            score = parseInt(document.getElementById('score-input').value);
            updateScoreUI();
        }

        function updateScoreUI() {
            document.getElementById('local-score').innerText = score;
            document.getElementById('score-input').value = score;
            send({type: 'SCORE', val: score});
        }
    </script>
</body>
</html>
