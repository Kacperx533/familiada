<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>PANEL STEROWANIA - FAMILIADA PRO</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root { --bg: #0a0a0a; --card: #1a1a1a; --accent: #f5b041; --danger: #ff0000; --text: #fff; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); padding: 20px; margin: 0; display: flex; flex-direction: column; align-items: center; }
        .container { max-width: 800px; width: 100%; }
        .card { background: var(--card); border-radius: 15px; padding: 20px; margin-bottom: 15px; border: 1px solid #333; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        h3 { color: var(--accent); margin-top: 0; border-bottom: 1px solid #333; padding-bottom: 10px; text-transform: uppercase; font-size: 14px; }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn { border: none; border-radius: 8px; padding: 15px; font-weight: bold; cursor: pointer; color: white; transition: 0.2s; text-transform: uppercase; }
        .btn:active { transform: scale(0.95); }
        .btn-dark { background: #333; }
        .btn-s { background: #27ae60; }
        .btn-d { background: var(--danger); }
        .btn-gold { background: var(--accent); color: #000; }
        
        input, select { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #333; background: #000; color: white; margin-bottom: 10px; box-sizing: border-box; font-size: 16px; }
        
        .ans-row { display: flex; justify-content: space-between; align-items: center; background: #222; padding: 10px; border-radius: 8px; margin-top: 5px; border-left: 4px solid var(--accent); }
        .active-team { outline: 4px solid var(--accent); box-shadow: 0 0 20px rgba(245, 176, 65, 0.4); }
        
        .final-input-group { display: grid; grid-template-columns: 3fr 1fr 1fr; gap: 5px; margin-bottom: 5px; }
        .status-dot { width: 12px; height: 12px; background: red; border-radius: 50%; display: inline-block; margin-right: 5px; }
    </style>
</head>
<body>

<div class="container">
    <div id="setup-card" class="card">
        <h3>1. Po≈ÇƒÖczenie z Ekranem TV</h3>
        <input type="text" id="tv-id" placeholder="Wpisz KOD TV widoczny na ekranie">
        <button onclick="connectToTV()" class="btn btn-gold" style="width:100%">PO≈ÅƒÑCZ SYSTEM</button>
    </div>

    <div id="controls" style="display:none">
        <div class="card">
            <h3>2. Multimedia i Tryb Gry</h3>
            <div class="grid">
                <button onclick="send({type:'PLAY_VIDEO', file:'czolowka.mp4'})" class="btn btn-dark">üé¨ CZO≈Å√ìWKA</button>
                <button onclick="send({type:'PLAY_VIDEO', file:'napisy.mp4'})" class="btn btn-dark">üé¨ NAPISY</button>
            </div>
            <div class="grid" style="margin-top:10px">
                <button onclick="setR(1)" class="btn btn-dark">RUNDA x1</button>
                <button onclick="setR(2)" class="btn btn-dark">RUNDA x2</button>
                <button onclick="setR(3)" class="btn btn-dark">RUNDA x3</button>
                <button onclick="initFinal(15)" class="btn btn-gold">üî• FINA≈Å</button>
            </div>
        </div>

        <div id="normal-section" class="card">
            <h3>3. Pytania i Tablica</h3>
            <select id="q-sel" onchange="prepQ()"></select>
            <button onclick="sendQ()" class="btn btn-s" style="width:100%; margin-bottom:15px">WY≈öLIJ PYTANIE NA TABLICƒò</button>
            <div id="ans-list"></div>
        </div>

        <div id="final-section" class="card" style="display:none; border: 2px solid var(--accent);">
            <h3>üî• PANEL FINA≈ÅOWY</h3>
            <div class="grid">
                <button onclick="send({type:'FINAL_MODE', time:15})" class="btn btn-dark">G1 (15 sek)</button>
                <button onclick="send({type:'FINAL_MODE', time:20})" class="btn btn-dark">G2 (20 sek)</button>
            </div>
            <button onclick="send({type:'START_TIMER'})" class="btn btn-d" style="width:100%; margin: 10px 0;">‚è± START STOPERA</button>
            <button onclick="send({type:'BUZZER'})" class="btn btn-dark" style="width:100%; margin-bottom:15px; color: #ff0000">üîî D≈πWIƒòK POWT√ìRZENIA</button>
            
            <div id="final-inputs">
                </div>
            <button onclick="closeFinal()" class="btn btn-dark" style="width:100%; margin-top:10px">POWR√ìT DO RUND</button>
        </div>

        <div class="card">
            <h3>4. Sterowanie i Wyniki</h3>
            <div class="grid">
                <button id="btnA" onclick="setTeam('A')" class="btn btn-dark">DRU≈ªYNA A (Lewe X)</button>
                <button id="btnB" onclick="setTeam('B')" class="btn btn-dark">DRU≈ªYNA B (Prawe X)</button>
            </div>
            <button onclick="doStrike()" class="btn btn-d" style="font-size:50px; margin-top:10px; height:100px; width:100%">‚úñ</button>
            <div class="grid" style="margin-top:15px">
                <div>
                    <small>PUNKTY A</small>
                    <input type="number" id="scA" value="0" onchange="sync()">
                </div>
                <div>
                    <small>PUNKTY B</small>
                    <input type="number" id="scB" value="0" onchange="sync()">
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // BAZA PYTA≈É
    const db = [
        { q: "Wiƒôcej ni≈º jedno zwierzƒô?", a: [["Owce", 40], ["Lama", 25], ["Stado", 15], ["Wataha", 10], ["Para", 5]] },
        { q: "Przedmiot szkolny?", a: [["Matematyka", 45], ["Polski", 30], ["WF", 15], ["Historia", 10]] },
        { q: "Co mo≈ºna robiƒá w lesie?", a: [["Spacerowaƒá", 50], ["Zbieraƒá grzyby", 30], ["Biegaƒá", 10], ["Odpoczywaƒá", 10]] },
        { q: "Rodzaj pieczywa?", a: [["Chleb", 55], ["Bu≈Çka", 30], ["Rogal", 10], ["Bagietka", 5]] },
        { q: "Zimowy sport?", a: [["Narciarstwo", 45], ["Skoki", 30], ["≈Åy≈ºwiarstwo", 20], ["Sanki", 5]] },
        { q: "Co pijemy na gorƒÖco?", a: [["Herbata", 50], ["Kawa", 35], ["Kakao", 15]] },
        { q: "Co kojarzy siƒô z PolskƒÖ?", a: [["Pierogi", 40], ["Bocian", 30], ["Ba≈Çtyk", 20], ["Tatry", 10]] },
        { q: "Czym podr√≥≈ºujemy?", a: [["Samoch√≥d", 40], ["PociƒÖg", 30], ["Samolot", 20], ["Rower", 10]] },
        { q: "Zwierzƒô domowe?", a: [["Pies", 50], ["Kot", 35], ["Chomik", 10], ["Rybka", 5]] },
        { q: "Co jest czerwone?", a: [["Pomidor", 40], ["Krew", 30], ["Serce", 20], ["R√≥≈ºa", 10]] }
    ];

    let peer = new Peer(), conn, activeTeam = 'A', multiplier = 1, currentA = [], finalTotal = 0;

    function connectToTV() {
        const id = document.getElementById('tv-id').value;
        conn = peer.connect(id);
        conn.on('open', () => {
            document.getElementById('setup-card').style.background = "#1a3a1a";
            document.getElementById('controls').style.display = 'block';
            initApp();
        });
    }

    function initApp() {
        const s = document.getElementById('q-sel');
        db.forEach((d, i) => s.innerHTML += `<option value="${i}">${d.q}</option>`);
        
        // Generuj pola fina≈Çowe
        const fDiv = document.getElementById('final-inputs');
        for(let i=0; i<5; i++) {
            fDiv.innerHTML += `
                <div class="final-input-group">
                    <input type="text" id="fa${i}" placeholder="Odpowied≈∫ ${i+1}">
                    <input type="number" id="fp${i}" placeholder="Pkt">
                    <button onclick="revF(${i})" class="btn btn-s" style="padding:5px">OK</button>
                </div>`;
        }
        prepQ();
    }

    function send(m) { if(conn) conn.send(m); }

    function setR(r) { 
        multiplier = (typeof r === 'number') ? r : 1; 
        send({type: 'NEXT_ROUND'}); 
        alert("Zmieniono mno≈ºnik na x" + multiplier + ". Tablica wyczyszczona.");
    }

    function prepQ() {
        const d = db[document.getElementById('q-sel').value]; currentA = d.a;
        const l = document.getElementById('ans-list'); l.innerHTML = "";
        d.a.forEach((a, i) => {
            l.innerHTML += `<div class="ans-row">
                <span>${a[0]} (${a[1]})</span>
                <button onclick="reveal(${i})" class="btn btn-s" style="padding: 5px 15px">ODKRYJ</button>
            </div>`;
        });
    }

    function sendQ() { send({type:'SETUP', a: currentA.map(x=>({t:x[0], p:x[1]}))}); }

    function reveal(i) {
        let pts = currentA[i][1] * multiplier;
        const scField = document.getElementById('sc' + activeTeam);
        scField.value = parseInt(scField.value) + pts;
        let total = parseInt(document.getElementById('scA').value) + parseInt(document.getElementById('scB').value);
        send({type:'REVEAL', index:i, total:total});
    }

    function doStrike() { send({type:'STRIKE', team: activeTeam}); }
    
    function setTeam(t) { 
        activeTeam = t; 
        document.getElementById('btnA').className = 'btn btn-dark' + (t==='A' ? ' active-team' : '');
        document.getElementById('btnB').className = 'btn btn-dark' + (t==='B' ? ' active-team' : '');
    }

    function sync() { 
        let s = parseInt(document.getElementById('scA').value) + parseInt(document.getElementById('scB').value);
        send({type:'UPDATE', sc: s}); 
    }

    // FUNKCJE FINA≈ÅU
    function initFinal(time) {
        document.getElementById('normal-section').style.display = 'none';
        document.getElementById('final-section').style.display = 'block';
        finalTotal = 0;
        send({type:'FINAL_MODE', time: time});
    }

    function closeFinal() {
        document.getElementById('normal-section').style.display = 'block';
        document.getElementById('final-section').style.display = 'none';
    }

    function revF(i) {
        const ans = document.getElementById('fa'+i).value;
        const pts = parseInt(document.getElementById('fp'+i).value) || 0;
        finalTotal += pts;
        send({ type: 'FINAL_REVEAL', index: i, ans: ans, pts: pts, total: finalTotal });
    }
</script>

</body>
</html>
