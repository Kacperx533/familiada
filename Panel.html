<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>ADMIN - MULTIMEDIA</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #222; color: white; padding: 20px; }
        .card { background: #333; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #444; }
        button { padding: 10px 15px; cursor: pointer; margin: 3px; border: none; border-radius: 4px; font-weight: bold; }
        .btn-main { background: #eaff00; color: #000; }
        .btn-audio { background: #007bff; color: white; }
        .btn-final { background: #f0ad4e; color: black; }
        .btn-x { background: #d9534f; color: white; }
    </style>
</head>
<body>
    <div class="card">
        ID Tablicy: <input id="peer-id" placeholder="ID z TV">
        <button onclick="connect()" class="btn-main">PO≈ÅƒÑCZ üü¢</button>
    </div>

    <div class="card">
        <h3>MULTIMEDIA</h3>
        <button onclick="send({type:'PLAY_INTRO'})" class="btn-audio">MUZYKA CZO≈Å√ìWKA üéµ</button>
        <button onclick="sendReset()" class="btn-main">START NOWA RUNDA</button>
    </div>

    <div class="card">
        <h3>RUNDA FINA≈ÅOWA</h3>
        Czas: <input type="number" id="fin-time" value="15" style="width:50px"> sek.
        <button onclick="startFinale()" class="btn-final">START ZEGAR ‚è±Ô∏è</button>
    </div>

    <div id="game-controls" class="card" style="display:none">
        <textarea id="data-input" style="width:100%; height:50px;">HAS≈ÅO 1, 30, HAS≈ÅO 2, 20</textarea>
        <div id="ans-btns"></div>
        <hr>
        <h4>B≈Çƒôdy</h4>
        Lewa: <button onclick="sendX('L',1)" class="btn-x">X</button> <button onclick="sendX('L',2)" class="btn-x">XX</button> <button onclick="sendX('L',3)" class="btn-x">XXX</button> |
        Prawa: <button onclick="sendX('R',1)" class="btn-x">X</button> <button onclick="sendX('R',2)" class="btn-x">XX</button> <button onclick="sendX('R',3)" class="btn-x">XXX</button>
        <hr>
        Suma: <input type="number" id="manual-score" value="0" onchange="sendScore()">
    </div>

    <script>
        const peer = new Peer();
        let conn;
        let answers = [];

        function connect() {
            conn = peer.connect(document.getElementById('peer-id').value);
            conn.on('open', () => { document.getElementById('game-controls').style.display='block'; });
        }

        function send(data) { if(conn) conn.send(data); }

        function sendReset() {
            let raw = document.getElementById('data-input').value.split(',');
            answers = [];
            for(let i=0; i<raw.length; i+=2) if(raw[i+1]) answers.push({t: raw[i].trim(), p: raw[i+1].trim()});
            send({type: 'RESET_BOARD', ans: answers});
            let html = '';
            answers.forEach((a, i) => html += `<button onclick="reveal(${i})">ODKRYJ ${i+1}</button>`);
            document.getElementById('ans-btns').innerHTML = html;
        }

        function reveal(i) {
            send({type: 'REV', idx: i, t: answers[i].t, p: answers[i].p});
            let s = document.getElementById('manual-score');
            s.value = parseInt(s.value) + parseInt(answers[i].p);
            sendScore();
        }

        function startFinale() {
            send({type: 'START_FINALE', time: document.getElementById('fin-time').value});
        }

        function sendX(side, n) { send({type:'X', side:side, n:n}); }
        function sendScore() { send({type:'SCORE', val: document.getElementById('manual-score').value}); }
    </script>
</body>
</html>
