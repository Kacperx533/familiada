<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>FAMILIADA - CENTRUM DOWODZENIA</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root {
            --primary: #ffc107;
            --secondary: #28a745;
            --danger: #dc3545;
            --dark: #121212;
            --card: #1e1e1e;
            --text: #f0f0f0;
        }

        body {
            font-family: 'Segoe UI', Roboto, sans-serif;
            background-color: var(--dark);
            color: var(--text);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            max-width: 1000px;
            width: 100%;
        }

        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #333;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        h2, h3 { color: var(--primary); margin-top: 0; text-transform: uppercase; letter-spacing: 1px; }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background: #000;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        input, select, textarea {
            background: #111;
            border: 1px solid #444;
            color: white;
            padding: 12px;
            border-radius: 6px;
            font-size: 16px;
            width: 100%;
            box-sizing: border-box;
        }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }

        button {
            padding: 12px 20px;
            font-weight: bold;
            text-transform: uppercase;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            transition: 0.2s;
        }

        button:active { transform: scale(0.95); }

        .btn-main { background: var(--primary); color: #000; width: 100%; font-size: 18px; }
        .btn-action { background: #333; color: white; border: 1px solid #555; }
        .btn-action:hover { background: #444; }
        .btn-reveal { background: #007bff; color: white; width: 100px; }
        .btn-x { background: var(--danger); color: white; flex: 1; font-size: 20px; }
        .btn-audio { background: #6f42c1; color: white; }

        .ans-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #2a2a2a;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            border-left: 5px solid var(--primary);
        }

        .score-display {
            font-size: 48px;
            color: var(--primary);
            font-family: monospace;
            text-align: center;
            background: #000;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .audio-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
    </style>
</head>
<body>

<div class="container">
    <div class="status-bar">
        <div>STATUS: <span id="conn-status" style="color: var(--danger)">üî¥ ROZ≈ÅƒÑCZONY</span></div>
        <div style="display:flex; gap:10px;">
            <input id="target-id" placeholder="KOD Z TV" style="width: 120px; padding: 5px;">
            <button onclick="connect()" class="btn-action" style="padding: 5px 15px;">PO≈ÅƒÑCZ</button>
        </div>
    </div>

    <div class="grid">
        <div>
            <div class="card">
                <h3>1. Przygotowanie Rundy</h3>
                <label>Wybierz gotowy zestaw:</label>
                <select id="preset-select" onchange="loadPreset()" style="margin-bottom: 15px;">
                    <option value="">-- W≈Çasne pytania --</option>
                    <option value="0">Runda 1: Co robimy rano?</option>
                    <option value="1">Runda 2: Zwierzƒô domowe</option>
                    <option value="2">Runda 3: Miasto w Polsce</option>
                    <option value="3">FINA≈Å</option>
                </select>
                
                <label>Edytuj dane (Format: Has≈Ço, Punkty):</label>
                <textarea id="data-input" rows="6" placeholder="Has≈Ço, 30&#10;Kolejne, 20"></textarea>
                <button onclick="sendSetup()" class="btn-main" style="margin-top: 15px;">WY≈öLIJ NA TABLICƒò</button>
            </div>

            <div class="card">
                <h3>2. Multimedia</h3>
                <div class="audio-grid">
                    <button onclick="sendMsg({type:'PLAY_INTRO'})" class="btn-audio">üéµ CZO≈Å√ìWKA</button>
                    <button onclick="sendMsg({type:'PLAY_FINAL'})" class="btn-audio">‚≠ê FINA≈Å MUZA</button>
                    <button onclick="sendMsg({type:'STOP_AUDIO'})" class="btn-action">üõë STOP</button>
                </div>
                <div style="margin-top: 15px;">
                    <label>Timer Fina≈Çowy (sekundy):</label>
                    <div style="display:flex; gap:10px;">
                        <input type="number" id="timer-val" value="15" style="width: 80px;">
                        <button onclick="startTimer()" class="btn-action" style="flex:1">START ZEGAR ‚è±Ô∏è</button>
                    </div>
                </div>
            </div>
        </div>

        <div>
            <div class="card" id="control-panel" style="opacity: 0.5; pointer-events: none;">
                <h3>3. Przebieg Gry</h3>
                <div id="answers-list">
                    <p style="text-align:center; color:#666;">Za≈Çaduj rundƒô, aby zobaczyƒá przyciski</p>
                </div>

                <hr style="border: 0; border-top: 1px solid #444; margin: 20px 0;">
                
                <h4>B≈ÅƒòDY (X)</h4>
                <div style="display:flex; gap:10px; margin-bottom: 10px;">
                    <div style="flex:1; text-align:center;">
                        <small>DRU≈ªYNA LEWA</small>
                        <div style="display:flex; gap:5px; margin-top:5px;">
                            <button onclick="sendX('L', 1)" class="btn-x">X</button>
                            <button onclick="sendX('L', 2)" class="btn-x">XX</button>
                            <button onclick="sendX('L', 3)" class="btn-x">XXX</button>
                        </div>
                    </div>
                </div>
                <div style="display:flex; gap:10px;">
                    <div style="flex:1; text-align:center;">
                        <small>DRU≈ªYNA PRAWA</small>
                        <div style="display:flex; gap:5px; margin-top:5px;">
                            <button onclick="sendX('R', 1)" class="btn-x">X</button>
                            <button onclick="sendX('R', 2)" class="btn-x">XX</button>
                            <button onclick="sendX('R', 3)" class="btn-x">XXX</button>
                        </div>
                    </div>
                </div>
                <button onclick="sendX('L', 0); sendX('R', 0);" class="btn-action" style="width:100%; margin-top:10px;">WYCZY≈öƒÜ WSZYSTKIE X</button>

                <hr style="border: 0; border-top: 1px solid #444; margin: 20px 0;">

                <h4>SUMA PUNKT√ìW</h4>
                <div class="score-display" id="local-score">0</div>
                <div style="display:flex; gap:10px;">
                    <button onclick="adjustScore(-5)" class="btn-action">-5</button>
                    <button onclick="adjustScore(5)" class="btn-action">+5</button>
                    <button onclick="manualScore()" class="btn-main">KOREKTA</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const peer = new Peer();
    let conn;
    let currentAnswers = [];
    let totalScore = 0;

    const presets = [
        "MYJEMY ZƒòBY, 35\nPIJEMY KAWƒò, 25\nUBIERAMY SIƒò, 15\n≈öCIELIMY ≈Å√ì≈ªKO, 10",
        "PIES, 45\nKOT, 30\nCHOMIK, 12\nRYBKI, 8",
        "WARSZAWA, 40\nKRAK√ìW, 30\nGDA≈ÉSK, 15\nWROC≈ÅAW, 10",
        "FINA≈Å ODPOWIED≈π 1, 40\nFINA≈Å ODPOWIED≈π 2, 20"
    ];

    function loadPreset() {
        const idx = document.getElementById('preset-select').value;
        if(idx !== "") document.getElementById('data-input').value = presets[idx];
    }

    function connect() {
        const id = document.getElementById('target-id').value.toUpperCase();
        conn = peer.connect(id);
        conn.on('open', () => {
            document.getElementById('conn-status').innerText = "üü¢ PO≈ÅƒÑCZONO";
            document.getElementById('conn-status').style.color = "#28a745";
            document.getElementById('control-panel').style.opacity = "1";
            document.getElementById('control-panel').style.pointerEvents = "auto";
        });
    }

    function sendMsg(data) { if(conn && conn.open) conn.send(data); }

    function sendSetup() {
        const lines = document.getElementById('data-input').value.split('\n');
        currentAnswers = lines.map(l => {
            const parts = l.split(',');
            return { t: parts[0]?.trim() || "", p: parseInt(parts[1]) || 0 };
        }).filter(a => a.t !== "");

        totalScore = 0;
        updateScoreDisplay();
        sendMsg({ type: 'RESET_BOARD', ans: currentAnswers });
        
        const list = document.getElementById('answers-list');
        list.innerHTML = currentAnswers.map((a, i) => `
            <div class="ans-row">
                <span>${i+1}. <strong>${a.t}</strong> (${a.p})</span>
                <button onclick="reveal(${i})" class="btn-reveal">ODKRYJ</button>
            </div>
        `).join('');
    }

    function reveal(idx) {
        const ans = currentAnswers[idx];
        sendMsg({ type: 'REV', idx: idx, t: ans.t, p: ans.p });
        totalScore += ans.p;
        updateScoreDisplay();
    }

    function sendX(side, n) { sendMsg({ type: 'X', side: side, n: n }); }

    function updateScoreDisplay() {
        document.getElementById('local-score').innerText = totalScore;
        sendMsg({ type: 'SCORE', val: totalScore });
    }

    function adjustScore(v) { totalScore += v; updateScoreDisplay(); }
    function manualScore() { 
        const v = prompt("Wpisz nowƒÖ sumƒô punkt√≥w:", totalScore);
        if(v !== null) { totalScore = parseInt(v); updateScoreDisplay(); }
    }

    function startTimer() {
        const t = document.getElementById('timer-val').value;
        sendMsg({ type: 'START_FINALE', time: t });
    }
</script>
</body>
</html>
