<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PANEL STUDIO PRO - PE≈ÅNA BAZA</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --accent: #8b5cf6; --success: #10b981; --danger: #ef4444; --gold: #f59e0b; --text: #f8fafc; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px; }
        .card { background: var(--card); border-radius: 20px; padding: 15px; margin-bottom: 12px; border: 1px solid rgba(255,255,255,0.05); }
        h4 { font-size: 0.75rem; color: #94a3b8; text-transform: uppercase; margin: 0 0 10px 0; letter-spacing: 1px; }
        input, select { width: 100%; padding: 12px; background: #0f172a; border: 2px solid #334155; color: white; border-radius: 12px; margin-bottom: 8px; box-sizing: border-box; font-size: 16px; }
        .btn { border: none; border-radius: 12px; padding: 14px; font-weight: bold; cursor: pointer; transition: 0.2s; width: 100%; color: white; display: flex; align-items: center; justify-content: center; }
        .btn:active { transform: scale(0.95); }
        .btn-violet { background: var(--accent); }
        .btn-green { background: var(--success); }
        .btn-red { background: var(--danger); }
        .btn-outline { background: transparent; border: 2px solid #334155; color: white; }
        .btn-gold { background: var(--gold); color: black; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .ans-row { display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.2); padding: 10px; margin: 5px 0; border-radius: 10px; border: 1px solid #334155; }
        .strike-zone { background: linear-gradient(135deg, #ef4444, #991b1b); height: 80px; font-size: 40px; margin: 15px 0; }
        .active-team { border: 3px solid var(--gold) !important; box-shadow: 0 0 15px var(--gold); }
        #timer-box { text-align: center; font-size: 30px; color: var(--danger); font-weight: bold; padding: 10px; }
    </style>
</head>
<body>
    <div id="setup" class="card">
        <h2 style="text-align:center; color:var(--accent)">KONFIGURACJA</h2>
        <input type="text" id="tv-id" placeholder="Wpisz ID z TV">
        <button onclick="connectToTV()" class="btn btn-violet">PO≈ÅƒÑCZ STUDIO</button>
        <p id="my-id" style="text-align:center; font-size: 10px; margin-top:10px;"></p>
    </div>

    <div id="controls" style="display:none">
        <div class="card">
            <h4>Nazwy Dru≈ºyn</h4>
            <div class="grid-2">
                <input type="text" id="nameA" value="DRU≈ªYNA A" onchange="updateNames()">
                <input type="text" id="nameB" value="DRU≈ªYNA B" onchange="updateNames()">
            </div>
        </div>

        <div class="card">
            <h4>Soundboard</h4>
            <div class="grid-3">
                <button onclick="playSound('Brawa')" class="btn btn-outline" style="font-size:10px;">üëè BRAWA</button>
                <button onclick="playSound('Smiech')" class="btn btn-outline" style="font-size:10px;">üòÇ ≈öMIECH</button>
                <button onclick="toggleNapiecie()" id="napBtn" class="btn btn-outline" style="font-size:10px;">üéµ NAPIƒòCIE</button>
            </div>
        </div>

        <div class="card">
            <h4>Stoper Fina≈Çowy</h4>
            <div id="timer-box">00</div>
            <div class="grid-2">
                <button onclick="startTimer(20)" class="btn btn-red">START 20s</button>
                <button onclick="startTimer(25)" class="btn btn-red">START 25s</button>
            </div>
            <button onclick="stopTimer()" class="btn btn-outline" style="margin-top:8px;">STOP / RESET</button>
        </div>

        <div class="card">
            <div class="grid-3">
                <button onclick="setR(1)" class="btn btn-outline">x1</button>
                <button onclick="setR(2)" class="btn btn-outline">x2</button>
                <button onclick="setR('final')" class="btn btn-gold">FINA≈Å</button>
            </div>
            <button onclick="controlBuzzers('UNLOCK')" class="btn btn-green" style="margin-top:10px;">üîì ODBLOKUJ GRZYBKI</button>
        </div>

        <div id="normal-game" class="card">
            <h4>Pytania Normalne</h4>
            <select id="q-select" onchange="loadQ()"></select>
            <button onclick="sendQ()" class="btn btn-violet" style="margin-bottom:10px;">WY≈öLIJ PYTANIE NA TV</button>
            <div id="ans-list"></div>
        </div>

        <div id="final-game" class="card" style="display:none">
            <h4>Pytania Fina≈Çowe</h4>
            <select id="f-select" onchange="loadFinal()"></select>
            <div id="f-inputs"></div>
        </div>

        <div class="card">
            <div class="grid-2">
                <button onclick="setTeam('A')" id="btnA" class="btn btn-outline">DRU≈ªYNA A</button>
                <button onclick="setTeam('B')" id="btnB" class="btn btn-outline">DRU≈ªYNA B</button>
            </div>
            <button onclick="sendStrike()" class="btn btn-red strike-zone">‚úñ</button>
            <div class="grid-2">
                <input type="number" id="scA" value="0" onchange="sync()">
                <input type="number" id="scB" value="0" onchange="sync()">
            </div>
            <button onclick="strikes={A:0,B:0}; sync();" class="btn btn-outline" style="margin-top:10px; font-size:10px;">RESET B≈ÅƒòD√ìW</button>
        </div>
    </div>

    <script>
        let peer = new Peer(), tvConn, buzzerConns = [], activeTeam = null, strikes = {A:0, B:0}, multiplier = 1, timerInterval, napiecieOn = false, currentAnswers = [];

        // --- OGROMNA BAZA PYTA≈É ---
        const db = [
            { q: "Wiƒôcej ni≈º jedno zwierzƒô?", a: [["Owce", 32], ["Lama", 21], ["Stado", 15], ["Wataha", 10], ["Para", 5]] },
            { q: "Polska potrawa wigilijna?", a: [["Barszcz", 45], ["Karp", 30], ["Pierogi", 15], ["Uszka", 8], ["Kutia", 2]] },
            { q: "Przedmiot szkolny?", a: [["Matematyka", 40], ["Polski", 25], ["WF", 15], ["Historia", 10], ["Biologia", 5]] },
            { q: "Co≈õ, co pije siƒô rano?", a: [["Kawa", 50], ["Herbata", 25], ["Woda", 10], ["Sok", 8], ["Mleko", 7]] },
            { q: "Zwierzƒô na literƒô K?", a: [["Kot", 48], ["Ko≈Ñ", 22], ["Krowa", 15], ["Kura", 10], ["Kangur", 5]] },
            { q: "Co mo≈ºna robiƒá w lesie?", a: [["Spacerowaƒá", 45], ["Zbieraƒá grzyby", 35], ["Biegaƒá", 10], ["Odpoczywaƒá", 7], ["Krzyczeƒá", 3]] },
            { q: "Co≈õ, co ma k√≥≈Çka?", a: [["Samoch√≥d", 45], ["Rower", 25], ["W√≥zek", 15], ["Hulajnoga", 10], ["Traktor", 5]] },
            { q: "Owoc cytrusowy?", a: [["Cytryna", 40], ["Pomara≈Ñcza", 35], ["Mandarynka", 15], ["Grejpfrut", 8], ["Limonka", 2]] },
            { q: "Co≈õ, co kojarzy siƒô z zimƒÖ?", a: [["≈önieg", 40], ["Mr√≥z", 25], ["Sanki", 15], ["Narty", 10], ["Choinka", 10]] },
            { q: "Sprzƒôt w kuchni?", a: [["Lod√≥wka", 40], ["Kuchenka", 30], ["Mikser", 15], ["Zmywarka", 10], ["Czajnik", 5]] },
            { q: "Element pogody?", a: [["Deszcz", 40], ["S≈Ço≈Ñce", 35], ["Wiatr", 15], ["≈önieg", 10]] },
            { q: "Czym podr√≥≈ºujemy?", a: [["Samoch√≥d", 40], ["PociƒÖg", 25], ["Autobus", 15], ["Samolot", 15], ["Statek", 5]] },
            { q: "Zajƒôcie na wakacjach?", a: [["P≈Çywanie", 35], ["Opalanie", 30], ["Zwiedzanie", 20], ["G√≥ry", 10], ["Spanie", 5]] },
            { q: "Kwiat na randkƒô?", a: [["R√≥≈ºa", 60], ["Tulipan", 20], ["Go≈∫dzik", 10], ["Lilie", 5], ["Fio≈Çek", 5]] },
            { q: "Co≈õ s≈Çodkiego?", a: [["Czekolada", 35], ["Lody", 30], ["Ciasto", 20], ["Cukierki", 10], ["PƒÖczek", 5]] },
            { q: "Dyscyplina sportowa?", a: [["Pi≈Çka no≈ºna", 45], ["Siatk√≥wka", 20], ["Bieganie", 15], ["P≈Çywanie", 10], ["Tenis", 10]] },
            { q: "Zwierzƒô hodowlane?", a: [["Krowa", 35], ["≈öwinia", 30], ["Kura", 20], ["Owca", 10], ["Ko≈Ñ", 5]] },
            { q: "Co k≈Çadziemy na kanapkƒô?", a: [["Szynka", 40], ["Ser", 35], ["Pomidor", 15], ["Mas≈Ço", 5], ["Og√≥rek", 5]] },
            { q: "Co≈õ, co lata?", a: [["Ptak", 45], ["Samolot", 35], ["Mucha", 10], ["Balon", 5], ["Helikopter", 5]] },
            { q: "Czƒô≈õƒá garderoby?", a: [["Spodnie", 35], ["Koszulka", 30], ["Buty", 20], ["Kurtka", 10], ["Czapka", 5]] },
            { q: "Miasto w Polsce?", a: [["Warszawa", 40], ["Krak√≥w", 30], ["Gda≈Ñsk", 15], ["Wroc≈Çaw", 10], ["Pozna≈Ñ", 5]] },
            { q: "Co≈õ czerwonego?", a: [["Pomidor", 40], ["Serce", 25], ["Krew", 15], ["R√≥≈ºa", 10], ["Stra≈º", 10]] },
            { q: "Instrument muzyczny?", a: [["Gitara", 40], ["Pianino", 30], ["Perkusja", 15], ["Skrzypce", 10], ["Flet", 5]] },
            { q: "Zaw√≥d medyczny?", a: [["Lekarz", 50], ["Pielƒôgniarka", 30], ["Ratownik", 10], ["Dentysta", 10]] },
            { q: "Drzewo li≈õciaste?", a: [["DƒÖb", 40], ["Brzoza", 30], ["Klon", 15], ["Lipka", 10], ["Buk", 5]] },
            { q: "Gdzie trzymamy pieniƒÖdze?", a: [["Portfel", 45], ["Bank", 35], ["Skarbonka", 10], ["Skarpeta", 10]] },
            { q: "Co≈õ, co ≈õwieci?", a: [["S≈Ço≈Ñce", 45], ["≈ªar√≥wka", 30], ["Ksiƒô≈ºyc", 15], ["Latarka", 10]] },
            { q: "Co≈õ do pisania?", a: [["D≈Çugopis", 45], ["O≈Ç√≥wek", 30], ["Marker", 15], ["Kreda", 10]] },
            { q: "Ssak wodny?", a: [["Delfin", 45], ["Wieloryb", 35], ["Foka", 15], ["Mors", 5]] },
            { q: "Przyprawa kuchenna?", a: [["S√≥l", 40], ["Pieprz", 35], ["Papryka", 15], ["Oregano", 10]] }
        ];

        const finalDb = [
            { n: "Fina≈Ç 1: Wakacje", qs: ["Gdzie?", "W walizce?", "Nap√≥j?", "Pojazd?", "Atrakcja?"], q: ["Morze", "Ubrania", "Woda", "Samolot", "Pla≈ºa"], p: [40, 30, 15, 10, 5] },
            { n: "Fina≈Ç 2: Dom", qs: ["Pok√≥j?", "Mebel?", "Kuchnia?", "≈öciana?", "Zwierzƒô?"], q: ["Salon", "Kanapa", "Lod√≥wka", "Obraz", "Pies"], p: [45, 25, 15, 10, 5] },
            { n: "Fina≈Ç 3: Szko≈Ça", qs: ["Przedmiot?", "Przybory?", "Przerwa?", "Ocena?", "Nauczyciel?"], q: ["Matematyka", "D≈Çugopis", "Jedzenie", "PiƒÖtka", "Polski"], p: [40, 30, 15, 10, 5] },
            { n: "Fina≈Ç 4: Sport", qs: ["Dyscyplina?", "Sprzƒôt?", "Miejsce?", "Wynik?", "Gwiazda?"], q: ["Pi≈Çka No≈ºna", "Pi≈Çka", "Stadion", "Gol", "Lewandowski"], p: [50, 20, 15, 10, 5] },
            { n: "Fina≈Ç 5: Natura", qs: ["Zwierzƒô?", "Drzewo?", "Kwiat?", "Pogoda?", "G√≥ra?"], q: ["Lew", "DƒÖb", "R√≥≈ºa", "S≈Ço≈Ñce", "Rysy"], p: [40, 30, 15, 10, 5] },
            { n: "Fina≈Ç 6: Jedzenie", qs: ["Zupa?", "Owoc?", "Warzywo?", "Nap√≥j?", "Deser?"], q: ["Ros√≥≈Ç", "Jab≈Çko", "Marchew", "Woda", "Lody"], p: [45, 25, 15, 10, 5] }
        ];

        // --- LOGIKA DZIA≈ÅANIA ---
        peer.on('open', id => document.getElementById('my-id').innerText = "ID TWOJEGO PANELU: " + id);
        
        peer.on('connection', conn => {
            if(!buzzerConns.find(c => c.peer === conn.peer)) buzzerConns.push(conn);
            conn.on('data', m => { 
                if(m.type === 'BUZZ') {
                    m.teamName = document.getElementById('name' + m.team).value;
                    sendToTV(m); 
                    controlBuzzers('LOCK');
                }
            });
        });

        function connectToTV() {
            const tid = document.getElementById('tv-id').value;
            tvConn = peer.connect(tid);
            tvConn.on('open', () => {
                document.getElementById('setup').style.display='none';
                document.getElementById('controls').style.display='block';
                updateNames();
                
                // Za≈Çadowanie listy pyta≈Ñ normalnych
                const qs = document.getElementById('q-select');
                qs.innerHTML = '<option value="">-- WYBIERZ PYTANIE --</option>';
                db.forEach((d, i) => qs.innerHTML += `<option value="${i}">${d.q}</option>`);
                
                // Za≈Çadowanie listy fina≈Ç√≥w
                const fs = document.getElementById('f-select');
                fs.innerHTML = '<option value="">-- WYBIERZ FINA≈Å --</option>';
                finalDb.forEach((f, i) => fs.innerHTML += `<option value="${i}">${f.n}</option>`);
            });
        }

        function sendToTV(m) { if(tvConn && tvConn.open) tvConn.send(m); }
        function broadcast(m) { buzzerConns = buzzerConns.filter(c => c.open); buzzerConns.forEach(c => c.send(m)); }
        function controlBuzzers(state) { broadcast({type: state}); }
        function updateNames() { sendToTV({type:'UPDATE_NAMES', a: document.getElementById('nameA').value, b: document.getElementById('nameB').value}); }
        function playSound(f) { sendToTV({type:'SOUND', file:f, action:'play'}); }
        
        function toggleNapiecie() { 
            napiecieOn = !napiecieOn; 
            sendToTV({type:'SOUND', file:'Napiecie', action: napiecieOn?'play':'stop'}); 
            document.getElementById('napBtn').className = napiecieOn ? "btn btn-green" : "btn btn-outline"; 
        }
        
        function startTimer(s) {
            stopTimer(); let tl = s;
            sendToTV({type:'TIMER', val:tl, visible:true});
            document.getElementById('timer-box').innerText = tl;
            timerInterval = setInterval(() => {
                tl--; document.getElementById('timer-box').innerText = tl;
                sendToTV({type:'TIMER', val:tl, visible:true});
                if(tl <= 0) { stopTimer(); playSound('No'); }
            }, 1000);
        }
        
        function stopTimer() { clearInterval(timerInterval); sendToTV({type:'TIMER', val:0, visible:false}); document.getElementById('timer-box').innerText = "00"; }
        
        function setR(r) { 
            multiplier = (typeof r === 'number') ? r : 1; 
            document.getElementById('normal-game').style.display = (r==='final'?'none':'block');
            document.getElementById('final-game').style.display = (r==='final'?'block':'none');
            sendToTV({type:'NEXT_ROUND', round:r}); 
            strikes={A:0,B:0}; 
            sync(); 
            controlBuzzers('LOCK');
        }

        function loadQ() {
            const v = document.getElementById('q-select').value; if(v==="") return;
            currentAnswers = db[v].a;
            let list = document.getElementById('ans-list'); list.innerHTML = "";
            currentAnswers.forEach((a, i) => {
                list.innerHTML += `<div class="ans-row"><span>${a[0]} (${a[1]})</span><button onclick="reveal(${i})" class="btn btn-gold" style="width:70px; padding:5px; font-size:10px;">ODKRYJ</button></div>`;
            });
        }

        function sendQ() { const v = document.getElementById('q-select').value; if(v==="") return; sendToTV({type:'SETUP', q: db[v].q, a: currentAnswers.map(x=>({t:x[0], p:x[1]}))}); }
        
        function reveal(i) { 
            let pts = currentAnswers[i][1] * multiplier; 
            sendToTV({type:'REVEAL', index:i, text:currentAnswers[i][0], pts:pts}); 
            if(activeTeam) { 
                let s = document.getElementById('sc'+activeTeam); 
                s.value = parseInt(s.value) + pts; 
                sync(); 
            } 
        }
        
        function loadFinal() {
            const v = document.getElementById('f-select').value; if(v==="") return;
            const f = finalDb[v]; const div = document.getElementById('f-inputs'); div.innerHTML = "";
            for(let p=1; p<=2; p++) {
                div.innerHTML += `<div class="card" style="background:rgba(0,0,0,0.3)"><h4>Gracz ${p}</h4>`;
                for(let i=0; i<5; i++) {
                    div.innerHTML += `<div style="display:grid; grid-template-columns: 1fr 50px 45px 45px; gap:5px; margin-top:5px;">
                        <input id="f-t-${p}-${i}" value="${p==1?f.q[i]:''}" placeholder="${f.qs[i]}">
                        <input id="f-p-${p}-${i}" value="${p==1?f.p[i]:''}" style="width:45px" placeholder="Pkt">
                        <button onclick="rf(${p},${i},'t')" class="btn btn-outline" style="padding:5px">T</button>
                        <button onclick="rf(${p},${i},'p')" class="btn btn-green" style="padding:5px">P</button>
                    </div>`;
                }
                div.innerHTML += `</div>`;
            }
        }

        function rf(p,r,k) { const v = document.getElementById(`f-${k}-${p}-${r}`).value; sendToTV({type:'FINAL_REVEAL', p:p, r:r, k:k, v:v}); }
        function sendStrike() { sendToTV({type:'STRIKE'}); if(activeTeam) { strikes[activeTeam]++; sync(); } }
        function setTeam(t) { activeTeam = t; document.getElementById('btnA').className = t==='A' ? "btn btn-outline active-team" : "btn btn-outline"; document.getElementById('btnB').className = t==='B' ? "btn btn-outline active-team" : "btn btn-outline"; }
        function sync() { sendToTV({type:'UPDATE', scA:document.getElementById('scA').value, scB:document.getElementById('scB').value, strikes:strikes}); }
    </script>
</body>
</html>
