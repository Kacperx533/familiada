<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>PANEL STEROWANIA</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #121212; color: white; display: grid; grid-template-columns: 350px 1fr 350px; gap: 20px; padding: 20px; }
        .card { background: #1e1e1e; padding: 15px; border-radius: 10px; border-top: 4px solid #e2ff00; margin-bottom: 15px; }
        button { width: 100%; padding: 12px; margin: 5px 0; cursor: pointer; font-weight: bold; border-radius: 5px; border: none; background: #333; color: white; }
        .btn-gold { background: #e2ff00; color: black; }
        .btn-red { background: #ff3333; }
        .score-box { font-size: 30px; text-align: center; background: #000; color: #e2ff00; padding: 10px; margin: 10px 0; }
        input, select { width: 100%; padding: 10px; background: #000; color: white; border: 1px solid #444; margin-bottom: 10px; box-sizing: border-box; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; }
        h3 { color: #e2ff00; text-transform: uppercase; font-size: 14px; margin-top: 0; }
    </style>
</head>
<body>
    <div>
        <div class="card">
            <h3>SYSTEM</h3>
            <input id="tv-id" placeholder="Wpisz ID z ekranu TV">
            <button class="btn-gold" onclick="connect()">PO≈ÅƒÑCZ</button>
        </div>
        <div class="card">
            <h3>MULTIMEDIA</h3>
            <button class="btn-gold" onclick="send({type:'PLAY_MEDIA', video:'czolowka.mp4', audio:'intro'})">üé¨ CZO≈Å√ìWKA (VID+AUD)</button>
            <button style="background: #555;" onclick="send({type:'PLAY_MEDIA', audio:'intro'})">üéµ SAMA MUZYKA INTRO</button>
            <button onclick="send({type:'PLAY_MEDIA', video:'runda.mp4', audio:'runda'})">RUNDA START</button>
            <button onclick="send({type:'PLAY_MEDIA', video:'final.mp4'})">üèÜ FINA≈Å WIDEO</button>
            <button onclick="send({type:'PLAY_MEDIA', video:'powtorka.mp4', audio:'powtorzenie'})">üîÑ POWT√ìRZENIE</button>
            <button class="btn-red" onclick="send({type:'STOP_VIDEO'})">STOP WIDEO</button>
        </div>
    </div>

    <div>
        <div class="card">
            <h3>TABLICA RUNDY</h3>
            <select id="q-select" onchange="previewQ()"></select>
            <button class="btn-gold" onclick="sendQ()">WY≈öLIJ NA TV</button>
            <div id="ans-preview" style="margin: 10px 0;"></div>
            <div class="score-box">SUMA: <span id="current-sum">0</span></div>
            <div class="grid">
                <button class="btn-red" onclick="sendX(1)">X</button>
                <button class="btn-red" onclick="sendX(3)">XXX</button>
                <button onclick="send({type:'X', side:'L', n:0}); send({type:'X', side:'R', n:0});">CZY≈öƒÜ X</button>
                <button id="side-btn" onclick="activeSide=(activeSide=='L'?'R':'L'); this.innerText='STRONA: '+(activeSide=='L'?'L':'P')">STRONA: L</button>
            </div>
            <button onclick="sum=0; updateS(); send({type:'SCORE', val:0});" style="margin-top:10px">RESET SUMY</button>
        </div>
    </div>

    <div>
        <div class="card">
            <h3>FINA≈Å</h3>
            <button class="btn-gold" onclick="send({type:'SETUP_FINAL'})">POKA≈ª TABELƒò FINA≈ÅU</button>
            <div class="grid">
                <button onclick="runTimer(15)">TIMER 15s</button>
                <button onclick="runTimer(20)">TIMER 20s</button>
            </div>
            <select id="f-set-select" onchange="showFHints()" style="margin-top:10px">
                <option value="0">ZESTAW 1</option>
                <option value="1">ZESTAW 2</option>
            </select>
            <div id="f-hints" style="font-size:11px; color:#888; margin-bottom:10px"></div>
            <div id="f-inputs"></div>
        </div>
    </div>

    <script>
        const DB = [
            {q:"Wiƒôcej ni≈º jedno zwierzƒô", a:[["STADO",52],["KLUCZ",18],["WATAHA",12],["SFORA",7]]},
            {q:"Co robimy rano?", a:[["MYJEMY SIƒò",35],["PIJEMY KAWƒò",25],["≈öNIADANIE",20],["UBIERANIE",12]]},
            {q:"Przedmiot w kuchni na T", a:[["TALERZ",48],["TARKA",22],["TOSTER",10]]}
        ];
        const F_SETS = [
            ["1.Ro≈õlina k≈ÇujƒÖca", "2.Marka auta", "3.Czƒô≈õƒá roweru", "4.Miasto w PL", "5.Imiƒô na A"],
            ["1.Co≈õ s≈Çodkiego", "2.Instrument", "3.Drzewo", "4.Pa≈Ñstwo", "5.Kolor"]
        ];

        let peer = new Peer(), conn, sum=0, activeSide='L';

        function connect() { conn = peer.connect(document.getElementById('tv-id').value); }

        window.onload = () => {
            const s = document.getElementById('q-select');
            DB.forEach((x,i) => s.innerHTML += `<option value="${i}">${x.q}</option>`);
            showFHints();
            const fi = document.getElementById('f-inputs');
            ['p1','p2'].forEach(p => {
                fi.innerHTML += `<div style="color:#e2ff00; font-size:12px; margin-top:5px">${p.toUpperCase()}</div>`;
                for(let i=0; i<5; i++) {
                    fi.innerHTML += `<div style="display:flex;gap:2px"><input id="f-${p}-t-${i}" placeholder="Odp" style="font-size:10px"><input id="f-${p}-p-${i}" type="number" style="width:35px"><button onclick="revF('${p}',${i})" style="width:30px; background:#e2ff00; color:black">OK</button></div>`;
                }
            });
        };

        function showFHints() { document.getElementById('f-hints').innerHTML = F_SETS[document.getElementById('f-set-select').value].join("<br>"); }
        function sendQ() { sum=0; updateS(); const q=DB[document.getElementById('q-select').value]; send({type:'SETUP_NORMAL', ans: q.a.map(x=>({t:x[0], p:x[1]}))}); previewQ(); }
        function previewQ() { const q=DB[document.getElementById('q-select').value]; document.getElementById('ans-preview').innerHTML = q.a.map((x,i) => `<button onclick="revN(${i},${x[1]})" style="font-size:12px; margin-bottom:2px">${x[0]} (${x[1]})</button>`).join(''); }
        function revN(i,p) { sum+=p; updateS(); send({type:'REV_NORMAL', idx:i}); send({type:'SCORE', val:sum}); }
        function revF(p,i) { const t=document.getElementById(`f-${p}-t-${i}`).value.toUpperCase(), pts=parseInt(document.getElementById(`f-${p}-p-${i}`).value)||0; sum+=pts; updateS(); send({type:'REV_FINAL', player:p, idx:i, t:t, p:pts}); send({type:'SCORE', val:sum}); }
        function updateS() { document.getElementById('current-sum').innerText = sum; }
        function sendX(n) { send({type:'X', side:activeSide, n:n}); }
        function runTimer(s) { let c=s; send({type:'TIMER', action:'start', val:c}); let itv=setInterval(()=>{ c--; send({type:'TIMER', action:'tick', val:c}); if(c<=0){ clearInterval(itv); send({type:'TIMER', action:'stop'}); } }, 1000); }
        function send(d) { if(conn) conn.send(d); }
    </script>
</body>
</html>
