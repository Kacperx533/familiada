<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>PANEL STEROWANIA</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #222; color: white; display: grid; grid-template-columns: 300px 1fr 300px; gap: 10px; padding: 10px; height: 95vh; }
        .col { display: flex; flex-direction: column; gap: 10px; overflow-y: auto; }
        .card { background: #333; padding: 15px; border-radius: 8px; border-left: 5px solid gold; }
        h3 { margin: 0 0 10px 0; color: gold; font-size: 14px; text-transform: uppercase; }
        button { width: 100%; padding: 10px; cursor: pointer; border: none; border-radius: 4px; font-weight: bold; margin-bottom: 5px; transition: 0.2s; }
        button:hover { opacity: 0.8; }
        .btn-green { background: #28a745; color: white; }
        .btn-red { background: #dc3545; color: white; }
        .btn-blue { background: #007bff; color: white; }
        .btn-yellow { background: gold; color: black; }
        .btn-grey { background: #555; color: white; }
        input, select { width: 100%; padding: 8px; background: #111; border: 1px solid #555; color: white; margin-bottom: 5px; box-sizing: border-box; }
        #preview-area button { text-align: left; padding-left: 15px; }
    </style>
</head>
<body>
    <div class="col">
        <div class="card">
            <h3>1. Po≈ÇƒÖczenie</h3>
            <input type="text" id="tv-id" placeholder="Wpisz ID z TV">
            <button class="btn-green" onclick="connect()">PO≈ÅƒÑCZ</button>
            <div id="conn-status" style="color:gray; font-size:12px">Roz≈ÇƒÖczono</div>
        </div>
        <div class="card">
            <h3>2. Dru≈ºyny</h3>
            <input type="text" id="t-a" value="Dru≈ºyna A">
            <input type="text" id="t-b" value="Dru≈ºyna B">
            <button class="btn-blue" onclick="sendNames()">ZMIE≈É NAZWY</button>
        </div>
        <div class="card">
            <h3>3. Punkty</h3>
            <span>RUNDA: <b id="r-sum">0</b></span>
            <button class="btn-yellow" onclick="addPtsTo('A')">DODAJ DO LEWEJ</button>
            <button class="btn-yellow" onclick="addPtsTo('B')">DODAJ DO PRAWEJ</button>
            <hr style="border-color:#555">
            <div>LEWA: <b id="s-a">0</b> | PRAWA: <b id="s-b">0</b></div>
            <button class="btn-grey" onclick="resetAll()">RESET GRY</button>
        </div>
        <div class="card">
            <h3>4. Efekty</h3>
            <button class="btn-blue" onclick="send({type:'VIDEO_INTRO'})">üé¨ CZO≈Å√ìWKA</button>
            <button class="btn-grey" onclick="send({type:'MUSIC_STOP'})">üîá STOP MUZYKI</button>
            <button class="btn-red" onclick="send({type:'STRIKE', count:1})">‚ùå Z≈ÅA (X)</button>
            <button class="btn-red" onclick="send({type:'STRIKE', count:2})">‚ùå‚ùå Z≈ÅA (XX)</button>
            <button class="btn-red" onclick="send({type:'STRIKE', count:3})">‚ùå‚ùå‚ùå Z≈ÅA (XXX)</button>
            <button class="btn-green" onclick="send({type:'TIMER'})">‚è±Ô∏è CZAS (3s)</button>
        </div>
    </div>

    <div class="col">
        <div class="card">
            <h3>Pytania</h3>
            <select id="round-multi"><option value="1">Mno≈ºnik x1</option><option value="2">Mno≈ºnik x2</option><option value="3">Mno≈ºnik x3</option></select>
            <select id="q-select" onchange="previewQ()" size="10" style="height: 150px;"></select>
            <button class="btn-green" style="height: 50px" onclick="sendRound()">WY≈öLIJ PYTANIE NA TV</button>
        </div>
        <div class="card" style="flex-grow: 1;">
            <h3>Odpowiedzi (Kliknij = OK)</h3>
            <div id="preview-area">Wybierz pytanie...</div>
        </div>
    </div>

    <div class="col">
        <div class="card">
            <h3>Fina≈Ç</h3>
            <button class="btn-red" onclick="send({type:'FINAL_SETUP'})">AKTYWUJ FINA≈Å</button>
            <input type="text" id="f-txt" placeholder="Has≈Ço">
            <input type="number" id="f-pts" placeholder="Pkt">
            <select id="f-row"><option value="0">Wiersz 1</option><option value="1">Wiersz 2</option><option value="2">Wiersz 3</option><option value="3">Wiersz 4</option><option value="4">Wiersz 5</option></select>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px; margin-top:10px">
                <button class="btn-blue" onclick="sendFinal(1)">GRACZ 1 (OK)</button>
                <button class="btn-yellow" onclick="sendFinal(2)">GRACZ 2 (OK)</button>
            </div>
        </div>
    </div>

    <script>
        const DB = [
            {q: "Przedmiot w szkole?", a: [["MATEMATYKA", 40], ["WF", 30], ["POLSKI", 15], ["HISTORIA", 10], ["MUZYKA", 5]]},
            {q: "Co pijemy rano?", a: [["KAWƒò", 50], ["HERBATƒò", 30], ["WODƒò", 10], ["SOK", 5], ["MLEKO", 5]]},
            {q: "Zwierzƒô domowe?", a: [["PIES", 45], ["KOT", 35], ["CHOMIK", 10], ["RYBKI", 5], ["PAPUGA", 5]]},
            {q: "Co zabieramy na pla≈ºƒô?", a: [["RƒòCZNIK", 40], ["KREM", 25], ["PARASOL", 15], ["PI≈ÅKƒò", 10], ["WODƒò", 10]]},
            {q: "Co robi krowa?", a: [["DAJE MLEKO", 50], ["MUCZY", 30], ["JE TRAWƒò", 20]]},
            {q: "Co jest w lod√≥wce?", a: [["≈öWIAT≈ÅO", 50], ["MLEKO", 20], ["SER", 15], ["JAJKA", 10], ["WƒòDLINA", 5]]},
            {q: "Kolor flagi Polski?", a: [["BIA≈ÅY", 50], ["CZERWONY", 50]]},
            {q: "Zaw√≥d w mundurze?", a: [["POLICJANT", 40], ["STRA≈ªAK", 30], ["≈ªO≈ÅNIERZ", 20], ["LEKARZ", 10]]},
            {q: "MiesiƒÖc wakacyjny?", a: [["LIPIEC", 50], ["SIERPIE≈É", 40], ["CZERWIEC", 10]]},
            {q: "Co ma ko≈Ça?", a: [["SAMOCH√ìD", 40], ["ROWER", 30], ["AUTOBUS", 15], ["WOZ", 10], ["DESKOROLKA", 5]]}
        ];
        for(let i=11; i<=50; i++) DB.push({q: `Pytanie zapasowe nr ${i}`, a:[["ODP A", 50], ["ODP B", 30], ["ODP C", 20]]});

        let conn, peer = new Peer(), currentRoundScore = 0, scoreA = 0, scoreB = 0;

        window.onload = () => {
            const sel = document.getElementById('q-select');
            DB.forEach((item, idx) => { const opt = document.createElement('option'); opt.value = idx; opt.text = (idx+1) + ". " + item.q; sel.add(opt); });
            previewQ();
        };

        function connect() {
            conn = peer.connect(document.getElementById('tv-id').value);
            conn.on('open', () => { document.getElementById('conn-status').innerText = "PO≈ÅƒÑCZONO!"; document.getElementById('conn-status').style.color = "lime"; });
        }
        function send(data) { if(conn) conn.send(data); }
        function sendNames() { send({ type: 'NAMES', a: document.getElementById('t-a').value, b: document.getElementById('t-b').value }); }
        
        function previewQ() {
            const idx = document.getElementById('q-select').value; const q = DB[idx]; const div = document.getElementById('preview-area'); div.innerHTML = '';
            q.a.forEach((ans, i) => {
                const btn = document.createElement('button'); btn.className = 'btn-grey'; btn.innerText = `${ans[0]} (${ans[1]})`;
                btn.onclick = () => reveal(i, ans[1], btn); div.appendChild(btn);
            });
        }
        function sendRound() {
            currentRoundScore = 0; updateStats();
            const idx = document.getElementById('q-select').value; const multi = document.getElementById('round-multi').value;
            const q = DB[idx]; const answersToSend = q.a.map(item => ({ text: item[0], pts: item[1] * multi }));
            send({type: 'SETUP_BOARD', answers: answersToSend});
        }
        function reveal(idx, rawPts, btnElement) {
            btnElement.className = 'btn-green'; const multi = document.getElementById('round-multi').value;
            currentRoundScore += (rawPts * multi); updateStats(); send({type: 'REVEAL', idx: idx});
        }
        function addPtsTo(team) {
            if(team === 'A') scoreA += currentRoundScore; if(team === 'B') scoreB += currentRoundScore;
            currentRoundScore = 0; updateStats();
        }
        function updateStats() {
            document.getElementById('r-sum').innerText = currentRoundScore; document.getElementById('s-a').innerText = scoreA; document.getElementById('s-b').innerText = scoreB;
            send({ type: 'SCORE_UPDATE', a: scoreA, b: scoreB, sum: currentRoundScore });
        }
        function resetAll() { scoreA = 0; scoreB = 0; currentRoundScore = 0; updateStats(); }
        function sendFinal(player) {
            send({ type: 'FINAL_SHOW', player: player, idx: document.getElementById('f-row').value, txt: document.getElementById('f-txt').value.toUpperCase(), pts: document.getElementById('f-pts').value });
        }
    </script>
</body>
</html>
