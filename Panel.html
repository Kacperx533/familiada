<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>PANEL STEROWANIA - FAMILIADA</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #121212; color: white; display: grid; grid-template-columns: 320px 1fr 320px; gap: 15px; padding: 15px; }
        .card { background: #1e1e1e; padding: 12px; border-radius: 8px; border-top: 4px solid #e2ff00; margin-bottom: 10px; }
        button { width: 100%; padding: 10px; margin: 3px 0; cursor: pointer; font-weight: bold; border-radius: 4px; border: none; background: #333; color: white; transition: 0.3s; }
        button:disabled { opacity: 0.2; cursor: not-allowed; }
        .btn-gold { background: #e2ff00; color: black; }
        .btn-red { background: #ff3333; }
        .btn-blue { background: #2196F3; }
        .btn-active-team { background: #4CAF50 !important; color: white; box-shadow: 0 0 15px #4CAF50; }
        .score-box { font-size: 24px; text-align: center; background: #000; color: #e2ff00; padding: 8px; margin: 5px 0; border: 1px solid #333; }
        input, select { width: 100%; padding: 8px; background: #000; color: white; border: 1px solid #444; margin-bottom: 8px; box-sizing: border-box; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 4px; }
        .scroll { height: 280px; overflow-y: auto; border: 1px solid #333; padding: 5px; background: #000; }
        h3 { color: #e2ff00; text-transform: uppercase; font-size: 13px; margin: 0 0 10px 0; }
        .team-indicator { font-size: 12px; text-align: center; margin-bottom: 10px; padding: 5px; background: #000; border-radius: 4px; }
    </style>
</head>
<body>
    <div>
        <div class="card">
            <h3>SYSTEM</h3>
            <input id="tv-id" placeholder="ID z ekranu TV">
            <button class="btn-gold" onclick="connect()">PO≈ÅƒÑCZ Z TV</button>
        </div>
        <div class="card">
            <h3>WYB√ìR AKTYWNEJ DRU≈ªYNY</h3>
            <div class="team-indicator" id="status-team">NAJPIERW WYBIERZ DRU≈ªYNƒò!</div>
            <div class="grid">
                <button id="team1-btn" onclick="selectTeam(1, 'L')">DRU≈ªYNA 1 (LEWA)</button>
                <button id="team2-btn" onclick="selectTeam(2, 'R')">DRU≈ªYNA 2 (PRAWA)</button>
            </div>
            <hr style="border:0; border-top:1px solid #333; margin:10px 0">
            <div id="t1-pts" style="font-size:18px">D1: 0 pkt</div>
            <button class="btn-blue control" onclick="addPts(1)" disabled>PRZYPISZ SUMƒò DO D1</button>
            <div id="t2-pts" style="font-size:18px; margin-top:10px">D2: 0 pkt</div>
            <button class="btn-blue control" onclick="addPts(2)" disabled>PRZYPISZ SUMƒò DO D2</button>
        </div>
        <div class="card">
            <h3>MEDIA</h3>
            <button class="btn-gold" onclick="send({type:'PLAY_MEDIA', video:'czolowka.mp4'})">üé¨ CZO≈Å√ìWKA</button>
            <button onclick="send({type:'PLAY_MEDIA', audio:'intro'})">üéµ INTRO MUZYKA</button>
            <button class="btn-red" onclick="send({type:'STOP_VIDEO'})">STOP WIDEO</button>
        </div>
    </div>

    <div>
        <div class="card">
            <h3>KONTROLA RUNDY</h3>
            <div class="grid">
                <button onclick="startR(1)">RUNDA 1</button>
                <button onclick="startR(2)">RUNDA 2</button>
                <button onclick="startR(3)">RUNDA 3</button>
                <button onclick="startR(4)">RUNDA 4</button>
            </div>
        </div>
        <div class="card">
            <h3>PYTANIA</h3>
            <select id="q-sel" onchange="preQ()"></select>
            <button class="btn-gold" onclick="sendQ()">ZA≈ÅADUJ PYTANIE</button>
            <div id="ans-pre" class="scroll"></div>
            <div class="score-box">SUMA RUNDY: <span id="cur-sum">0</span></div>
            <div class="grid">
                <button class="btn-red control" onclick="sendX(1)" disabled>X</button>
                <button class="btn-red control" onclick="sendX(3)" disabled>XXX</button>
                <button onclick="send({type:'X',side:'L',n:0});send({type:'X',side:'R',n:0})">CZY≈öƒÜ X</button>
                <button id="side-display" style="background:#555">AKTYWNA: BRAK</button>
            </div>
        </div>
    </div>

    <div>
        <div class="card">
            <h3>FINA≈Å</h3>
            <button class="btn-gold" onclick="send({type:'SETUP_FINAL'});send({type:'PLAY_MEDIA',video:'final.mp4'})">üèÜ START FINA≈ÅU</button>
            <div class="grid"><button onclick="runT(15)">15s</button><button onclick="runT(20)">20s</button></div>
            <select id="f-sel" onchange="showFH()"></select>
            <div id="f-h" style="font-size:11px; color:#888; margin:10px 0"></div>
            <div id="f-ins" class="scroll"></div>
        </div>
    </div>

    <script>
        const DB = [
            {q:"Wiƒôcej ni≈º jedno zwierzƒô", a:[["STADO",52],["KLUCZ",17],["WATAHA",11],["≈ÅAWICA",8],["SFORA",5]]},
            {q:"Co≈õ co parzy", a:[["POKRZYWA",38],["OGIE≈É",31],["WRZƒÑTEK",19],["S≈ÅO≈ÉCE",7]]},
            {q:"Zwierzƒô na P", a:[["PIES",45],["PTAK",18],["PANDA",12],["PCH≈ÅA",6]]}
            // ... dopisz resztƒô tutaj
        ];

        let peer=new Peer(), conn, sum=0, activeTeam=null, side='L', t1=0, t2=0;

        function connect() { conn=peer.connect(document.getElementById('tv-id').value); }

        function selectTeam(num, s) {
            activeTeam = num;
            side = s;
            
            // UI Update
            document.querySelectorAll('.control').forEach(b => b.disabled = false);
            document.getElementById('team1-btn').className = (num===1 ? 'btn-active-team' : '');
            document.getElementById('team2-btn').className = (num===2 ? 'btn-active-team' : '');
            document.getElementById('status-team').innerText = "AKTYWNA: DRU≈ªYNA " + num;
            document.getElementById('side-display').innerText = "STRONA: " + (s==='L'?'LEWA':'PRAWA');
        }

        function addPts(n) {
            if(n===1) t1+=sum; else t2+=sum;
            sum=0; updS(); updTeams();
            send({type:'SCORE', val:0});
            resetSelection();
        }

        function resetSelection() {
            activeTeam = null;
            document.querySelectorAll('.control').forEach(b => b.disabled = true);
            document.getElementById('team1-btn').className = '';
            document.getElementById('team2-btn').className = '';
            document.getElementById('status-team').innerText = "WYBIERZ DRU≈ªYNƒò DO PUNKT√ìW/B≈ÅƒòD√ìW";
            document.getElementById('side-display').innerText = "AKTYWNA: BRAK";
        }

        function startR(n) {
            sum=0; updS(); resetSelection();
            send({type:'RESET_BOARD'});
            send({type:'PLAY_MEDIA', audio:'runda'});
        }

        function updTeams() {
            document.getElementById('t1-pts').innerText="D1: "+t1+" pkt";
            document.getElementById('t2-pts').innerText="D2: "+t2+" pkt";
        }

        window.onload=()=>{
            const s=document.getElementById('q-sel'); DB.forEach((x,i)=>s.innerHTML+=`<option value="${i}">${i+1}. ${x.q}</option>`);
            const fi=document.getElementById('f-ins'); ['p1','p2'].forEach(p=>{
                fi.innerHTML+=`<div style="color:#e2ff00;margin-top:10px">${p.toUpperCase()}</div>`;
                for(let i=0;i<5;i++) fi.innerHTML+=`<div style="display:flex;gap:2px"><input id="f-${p}-t-${i}" style="width:100px"><input id="f-${p}-p-${i}" type="number" style="width:40px"><button onclick="revF('${p}',${i})" style="width:30px;background:#e2ff00;color:black">OK</button></div>`;
            });
            preQ();
        };

        function sendQ() { sum=0; updS(); const q=DB[document.getElementById('q-sel').value]; send({type:'SETUP_NORMAL', ans:q.a}); preQ(); }
        function preQ() { 
            const q=DB[document.getElementById('q-sel').value]; 
            document.getElementById('ans-pre').innerHTML=q.a.map((x,i)=>`<button class="control" onclick="revN(${i},'${x[0]}',${x[1]})" disabled style="text-align:left">${x[0]} (${x[1]})</button>`).join(''); 
        }

        function revN(i,t,p) { 
            sum+=p; updS(); 
            send({type:'REV_NORMAL', idx:i, t:t, p:p}); 
            send({type:'SCORE', val:sum}); 
        }

        function sendX(n) { send({type:'X', side:side, n:n}); }
        function updS() { document.getElementById('cur-sum').innerText=sum; }
        function send(d) { if(conn) conn.send(d); }
    </script>
</body>
</html>
