<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>PANEL STEROWANIA</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #121212; color: white; display: grid; grid-template-columns: 400px 1fr 350px; gap: 15px; padding: 15px; margin: 0; }
        .card { background: #1e1e1e; padding: 15px; border-radius: 10px; border-bottom: 4px solid #dfff00; }
        h3 { color: #dfff00; margin-top: 0; text-transform: uppercase; font-size: 14px; border-bottom: 1px solid #333; padding-bottom: 5px; }
        button { background: #333; color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; font-weight: bold; width: 100%; transition: 0.2s; }
        button:hover { background: #444; }
        .btn-gold { background: #dfff00; color: black; }
        .btn-gold:hover { background: #f0ff40; }
        .btn-red { background: #aa0000; }
        .btn-blue { background: #0055ff; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        input, select { width: 100%; padding: 10px; background: #000; color: #fff; border: 1px solid #444; border-radius: 5px; }
        .score-box { font-size: 30px; color: #dfff00; text-align: center; margin: 10px 0; background: #000; padding: 10px; border-radius: 5px; }
        .cheat-sheet { height: 600px; overflow-y: auto; background: #0a0a0a; padding: 10px; font-size: 13px; color: #ccc; }
        .q-item { border-bottom: 1px solid #222; padding: 8px 0; }
    </style>
</head>
<body>

    <div>
        <div class="card">
            <h3>1. Po≈ÇƒÖczenie</h3>
            <input id="tv-id" placeholder="Wpisz ID z ekranu TV">
            <button class="btn-gold" onclick="connect()" style="margin-top:5px">PO≈ÅƒÑCZ Z EKRANEM</button>
            <div id="status" style="color:red; font-size:12px; margin-top:5px">Status: Roz≈ÇƒÖczony</div>
        </div>

        <div class="card" style="margin-top:15px">
            <h3>2. Multimedia</h3>
            <div class="grid">
                <button onclick="sendSound('runda')">üéµ D≈πWIƒòK RUNDY</button>
                <button onclick="sendSound('final')">üé¨ MUZYKA FINA≈Å</button>
                <button onclick="send({type:'X', side:'L', n:1})">‚ùå Z≈ÅA ODP</button>
                <button onclick="send({type:'X', side:'L', n:0})">üîÑ CZY≈öƒÜ X</button>
            </div>
            <div class="grid" style="margin-top:10px">
                <button class="btn-blue" onclick="activeSide='L'">GRA LEWA</button>
                <button class="btn-red" onclick="activeSide='R'">GRA PRAWA</button>
            </div>
        </div>

        <div class="card" style="margin-top:15px">
            <h3>3. Punkty Dru≈ºyn</h3>
            <div class="grid">
                <div>NIEBIESCY<div class="score-box" id="pts-L">0</div><button onclick="addGlobal('L')">DODAJ</button></div>
                <div>CZERWONI<div class="score-box" id="pts-R">0</div><button onclick="addGlobal('R')">DODAJ</button></div>
            </div>
        </div>
    </div>

    <div>
        <div class="card">
            <h3>4. ZarzƒÖdzanie RundƒÖ</h3>
            <select id="q-select" onchange="previewQ()"></select>
            <button class="btn-gold" onclick="sendQ()" style="margin-top:10px; height:50px">WY≈öLIJ PYTANIE NA TV</button>
            <div id="ans-preview" style="margin-top:15px"></div>
            <div class="score-box" style="font-size:40px">SUMA: <span id="current-sum">0</span></div>
        </div>

        <div class="card" style="margin-top:15px">
            <h3>5. Fina≈Ç - Akcje</h3>
            <div class="grid">
                <button class="btn-gold" onclick="runTimer(15)">TIMER 15s (G1)</button>
                <button class="btn-gold" onclick="runTimer(20)">TIMER 20s (G2)</button>
                <button onclick="send({type:'SETUP_FINAL'})">CZYSTA TABLICA FINA≈Å</button>
            </div>
            <div class="grid" style="margin-top:15px">
                <div id="f-p1"><b>GRACZ 1</b></div>
                <div id="f-p2"><b>GRACZ 2</b></div>
            </div>
        </div>
    </div>

    <div class="card">
        <h3>≈öciƒÖgawka Fina≈Çowa (Pytania)</h3>
        <div class="cheat-sheet" id="cheat"></div>
    </div>

    <script>
        const DB = [
            {q:"Zwierzƒô na literƒô P", a:[["PIES",45],["PTAK",25],["PANDA",15],["PANTERA",10],["PCH≈ÅA",5]]},
            {q:"Przedmiot w pi√≥rniku", a:[["D≈ÅUGOPIS",40],["O≈Å√ìWEK",30],["GUMKA",20],["LINIJKA",10]]},
            {q:"Co≈õ do picia na gorƒÖco", a:[["HERBATA",50],["KAWA",30],["KAKAO",15],["MLEKO",5]]},
            {q:"Dyscyplina olimpijska", a:[["BIEGANIE",40],["P≈ÅYWANIE",30],["SIATK√ìWKA",20],["TENIS",10]]},
            {q:"Marka samochodu", a:[["TOYOTA",35],["BMW",25],["AUDI",20],["MERCEDES",15],["FIAT",5]]},
            {q:"Owoc egzotyczny", a:[["BANAN",45],["ANANAS",25],["MANGO",15],["KIWI",10],["KOKOS",5]]},
            {q:"Czƒô≈õƒá garderoby", a:[["SPODNIE",40],["KOSZULA",30],["BUTY",20],["CZAPKA",10]]},
            {q:"Instrument muzyczny", a:[["PIANINO",35],["GITARA",30],["SKRZYPCE",20],["PERKUSJA",15]]},
            {q:"Co≈õ co lata", a:[["SAMOLOT",50],["PTAK",30],["MUCHA",15],["DRON",5]]},
            {q:"Stolica w Europie", a:[["WARSZAWA",40],["PARY≈ª",30],["LONDYN",20],["RZYM",10]]}
        ];

        const FINAL_SETS = [
            "ZESTAW 1: 1. Co≈õ co siƒô klei? | 2. Czƒô≈õƒá roweru? | 3. Ryba s≈Çodkowodna? | 4. Krajobraz Polski? | 5. Rodzaj kawy?",
            "ZESTAW 2: 1. Co≈õ s≈Çonego? | 2. Marka telefonu? | 3. Drzewo li≈õciaste? | 4. Sport zimowy? | 5. MiesiƒÖc letni?",
            "ZESTAW 3: 1. Co≈õ na baterie? | 2. Kwiat ogrodowy? | 3. Rodzaj spodni? | 4. Planeta? | 5. Rzeka w Polsce?",
            "ZESTAW 4: 1. Co≈õ okrƒÖg≈Çego? | 2. Miasto nad morzem? | 3. Grzyb jadalny? | 4. Metal szlachetny? | 5. Ptak domowy?",
            "ZESTAW 5: 1. Co≈õ co parzy? | 2. ≈örodek transportu? | 3. Owad po≈ºyteczny? | 4. Kraj sƒÖsiadujƒÖcy z PolskƒÖ? | 5. Imiƒô mƒôskie na A?"
        ];

        let peer = new Peer(), conn, activeSide = 'L', sum = 0;
        let globals = {L:0, R:0};

        function connect() { 
            conn = peer.connect(document.getElementById('tv-id').value);
            conn.on('open', () => { 
                document.getElementById('status').innerText = "Status: PO≈ÅƒÑCZONO"; 
                document.getElementById('status').style.color = "lime";
            });
        }

        window.onload = () => {
            const sel = document.getElementById('q-select');
            DB.forEach((x,i) => sel.innerHTML += `<option value="${i}">${x.q}</option>`);
            const cheat = document.getElementById('cheat');
            FINAL_SETS.forEach(s => cheat.innerHTML += `<div class="q-item">${s}</div>`);
            
            ['p1','p2'].forEach(p => {
                const div = document.getElementById('f-'+p);
                for(let i=0; i<5; i++) {
                    div.innerHTML += `<div style="margin:5px 0"><input id="f-${p}-t-${i}" placeholder="Odp" style="width:60%"> <input id="f-${p}-p-${i}" type="number" placeholder="Pkt" style="width:30%"> <button onclick="revealFinal('${p}',${i})" style="padding:2px">OK</button></div>`;
                }
            });
            previewQ();
        };

        function sendSound(f){ send({type:'SOUND', file:f}); }
        function sendX(n){ send({type:'X', side:activeSide, n:n}); }
        function addGlobal(s){ globals[s]+=sum; document.getElementById('pts-'+s).innerText=globals[s]; sum=0; updateSum(); send({type:'SCORE', val:0}); }
        function updateSum(){ document.getElementById('current-sum').innerText = sum; }

        function sendQ() {
            sum = 0; updateSum();
            const q = DB[document.getElementById('q-select').value];
            send({type:'SETUP_NORMAL', ans: q.a.map(x=>({t:x[0], p:x[1]}))});
            previewQ();
        }

        function previewQ() {
            const q = DB[document.getElementById('q-select').value];
            const box = document.getElementById('ans-preview');
            box.innerHTML = q.a.map((x,i) => `<button onclick="revNormal(${i},${x[1]})" style="margin:2px 0; text-align:left">${x[0]} (${x[1]})</button>`).join('');
        }

        function revNormal(i,p){ sum+=p; updateSum(); send({type:'REV_NORMAL', idx:i}); send({type:'SCORE', val:sum}); }
        
        function revealFinal(p,i){
            const t = document.getElementById(`f-${p}-t-${i}`).value.toUpperCase();
            const pts = parseInt(document.getElementById(`f-${p}-p-${i}`).value) || 0;
            sum += pts; updateSum();
            send({type:'REV_FINAL', player:p, idx:i, t:t, p:pts});
            send({type:'SCORE', val:sum});
        }

        function runTimer(s){
            let c = s; send({type:'TIMER', action:'start', val:c});
            let itv = setInterval(() => { c--; if(c<=0){ clearInterval(itv); send({type:'TIMER', action:'stop'}); } send({type:'TIMER', action:'tick', val:c}); }, 1000);
        }

        function send(d){ if(conn) conn.send(d); }
    </script>
</body>
</html>
