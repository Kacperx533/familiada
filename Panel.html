<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>PANEL STEROWANIA</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #111; color: white; padding: 15px; display: grid; grid-template-columns: 380px 1fr 300px; gap: 15px; }
        .card { background: #222; padding: 12px; border-radius: 8px; border-top: 3px solid #dfff00; margin-bottom: 10px; }
        button { width: 100%; padding: 8px; margin: 2px 0; cursor: pointer; font-weight: bold; border: none; border-radius: 4px; }
        .btn-gold { background: #dfff00; color: #000; }
        .btn-blue { background: #0055ff; color: #fff; }
        .btn-red { background: #aa0000; color: #fff; }
        .btn-gray { background: #444; color: #fff; }
        input, select { width: 100%; padding: 8px; background: #000; color: #fff; border: 1px solid #444; box-sizing: border-box; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; }
        .score-box { font-size: 24px; text-align: center; padding: 10px; background: #000; border-radius: 5px; margin: 5px 0; }
        .cheat-sheet { font-size: 12px; color: #aaa; height: 400px; overflow-y: auto; }
        h3 { margin-top: 0; color: #dfff00; font-size: 13px; text-transform: uppercase; }
    </style>
</head>
<body>

    <div>
        <div class="card">
            <h3>Konta Punktowe</h3>
            <div class="grid">
                <div><div class="score-box" style="color:#0055ff" id="p-blue">0</div><button class="btn-blue" onclick="addPoints('blue')">DODAJ SUMƒò</button></div>
                <div><div class="score-box" style="color:#aa0000" id="p-red">0</div><button class="btn-red" onclick="addPoints('red')">DODAJ SUMƒò</button></div>
            </div>
            <button class="btn-gray" onclick="resetAllScores()" style="margin-top:5px">RESETUJ KONTA</button>
        </div>

        <div class="card">
            <h3>Multimedia i B≈Çƒôdy</h3>
            <button class="btn-gold" onclick="send({type:'INTRO'})">START: NAPIS FAMILIADA</button>
            <button onclick="send({type:'VIDEO'})">üé¨ CZO≈Å√ìWKA WIDEO</button>
            <div class="grid" style="margin-top:10px">
                <button class="btn-blue" onclick="send({type:'X', side:'L', n:1})">X</button>
                <button class="btn-red" onclick="send({type:'X', side:'R', n:1})">X</button>
                <button class="btn-blue" onclick="send({type:'X', side:'L', n:3})">XXX</button>
                <button class="btn-red" onclick="send({type:'X', side:'R', n:3})">XXX</button>
            </div>
            <button class="btn-gray" onclick="send({type:'CLEAR_X'})">CZY≈öƒÜ IKSY</button>
        </div>

        <div class="card">
            <h3>Stoper Fina≈Çowy</h3>
            <div class="grid">
                <button class="btn-gold" onclick="runTimer(15)">START 15s</button>
                <button class="btn-gold" onclick="runTimer(20)">START 20s</button>
            </div>
            <button class="btn-red" onclick="stopTimer()">ZATRZYMAJ</button>
        </div>
    </div>

    <div>
        <div class="card">
            <h3>Rundy Zwyk≈Çe</h3>
            <div class="grid">
                <button onclick="startR(1)">R1</button><button onclick="startR(2)">R2</button>
                <button onclick="startR(3)">R3</button><button onclick="startR('FINA≈Å')">FINA≈Å</button>
            </div>
            <select id="q-sel" onchange="preview()" style="margin:10px 0"></select>
            <button class="btn-gold" onclick="loadQ()">WY≈öLIJ PYTANIE</button>
            <div id="ans-box" style="margin-top:10px"></div>
            <div style="text-align:right; font-size:30px; color:gold">SUMA RUNDY: <span id="s-sum">0</span></div>
        </div>

        <div class="card">
            <h3>Fina≈Ç - Tablica</h3>
            <button class="btn-blue" onclick="prepFinal()">PRZYGOTUJ PUSTY FINA≈Å</button>
            <div id="f-rows" style="margin-top:10px"></div>
        </div>
    </div>

    <div class="card">
        <h3>≈öciƒÖgawka Pyta≈Ñ</h3>
        <div class="cheat-sheet" id="cheat-box"></div>
    </div>

    <script>
        const DB = [
            {q:"Zwierzƒô na literƒô P", a:[["PIES",45],["PTAK",25],["PANTERA",15],["PANDA",10],["PCH≈ÅA",5]]},
            {q:"Przedmiot w pi√≥rniku", a:[["D≈ÅUGOPIS",40],["O≈Å√ìWEK",30],["GUMKA",20],["LINIJKA",10]]},
            {q:"Co≈õ zimnego", a:[["L√ìD",50],["≈öNIEG",30],["WODA",15],["COLA",5]]}
        ];
        
        const FINAL_SETS = [
            {q:"1. Wiƒôcej ni≈º jedno zwierzƒô?", a:"STADO, PARA, OWCE"},
            {q:"2. Co≈õ co siƒô klei?", a:"KLEJ, TA≈öMA, MI√ìD"},
            {q:"3. Stolica europejska?", a:"WARSZAWA, PARY≈ª, RZYM"},
            {q:"4. Czƒô≈õƒá roweru?", a:"KO≈ÅO, RAMA, KIEROWNICA"},
            {q:"5. Rodzaj spodni?", a:"JEANSY, DRESY, RURKI"}
        ];

        let peer = new Peer(), conn, sum = 0;
        let scores = { blue: 0, red: 0 };
        let timerInt;

        function connect() { 
            const id = document.getElementById('tv-id').value;
            conn = peer.connect(id); 
        }
        
        window.onload = () => {
            const sel = document.getElementById('q-sel');
            DB.forEach((x,i) => sel.innerHTML += `<option value="${i}">${x.q}</option>`);
            
            // Generuj fina≈Çowe pola
            let fr = document.getElementById('f-rows');
            for(let i=0; i<5; i++) {
                fr.innerHTML += `<div class="grid" style="margin-bottom:5px"><input id="ft${i}" placeholder="Odp"><input id="fp${i}" type="number" placeholder="Pkt" style="width:50px"><button onclick="revF(${i})" class="btn-gray">OK</button></div>`;
            }

            // ≈öciƒÖgawka
            const cb = document.getElementById('cheat-box');
            cb.innerHTML = "<b>PYTANIA ZWYK≈ÅE:</b><br>";
            DB.forEach(x => cb.innerHTML += `‚Ä¢ ${x.q} (${x.a.map(y=>y[0]).join(', ')})<br><br>`);
            cb.innerHTML += "<br><b>ZESTAW FINA≈ÅOWY:</b><br>";
            FINAL_SETS.forEach(x => cb.innerHTML += `‚Ä¢ ${x.q}<br><i>${x.a}</i><br><br>`);
            
            preview();
        };

        function addPoints(team) {
            scores[team] += sum;
            document.getElementById('p-'+team).innerText = scores[team];
            sum = 0;
            document.getElementById('s-sum').innerText = 0;
            send({type:'SCORE', val:0});
        }

        function resetAllScores() {
            scores = {blue:0, red:0};
            document.getElementById('p-blue').innerText = 0;
            document.getElementById('p-red').innerText = 0;
        }

        function runTimer(sec) {
            clearInterval(timerInt);
            let c = sec;
            send({type:'TIMER', action:'start', val:c});
            timerInt = setInterval(() => {
                c--;
                if(c <= 0) { clearInterval(timerInt); }
                send({type:'TIMER', action:'tick', val:c});
            }, 1000);
        }
        function stopTimer() { clearInterval(timerInt); send({type:'TIMER', action:'stop'}); }

        function startR(n) { send({type:'ROUND_START', num: n}); }

        function preview() {
            const q = DB[document.getElementById('q-sel').value];
            const box = document.getElementById('ans-box'); box.innerHTML = '';
            q.a.forEach((x, i) => {
                const b = document.createElement('button');
                b.style.textAlign = 'left';
                b.innerHTML = `<span>${i+1}. ${x[0]}</span> <span style="float:right">${x[1]}</span>`;
                b.onclick = () => {
                    if(b.disabled) return;
                    sum += x[1];
                    document.getElementById('s-sum').innerText = sum;
                    send({type:'REV', idx:i});
                    send({type:'SCORE', val:sum});
                    b.style.background = 'green'; b.disabled = true;
                };
                box.appendChild(b);
            });
        }

        function loadQ() {
            sum = 0; document.getElementById('s-sum').innerText = 0;
            const q = DB[document.getElementById('q-sel').value];
            send({type:'SETUP', ans: q.a.map(x=>({t:x[0], p:x[1]})), isFinal:false});
            preview();
        }

        function prepFinal() {
            sum = 0; document.getElementById('s-sum').innerText = 0;
            send({type:'SETUP', ans:[], isFinal:true});
        }

        function revF(i) {
            const t = document.getElementById('ft'+i).value.toUpperCase();
            const p = parseInt(document.getElementById('fp'+i).value) || 0;
            sum += p;
            document.getElementById('s-sum').innerText = sum;
            send({type:'FINAL_REV', idx:i, t:t, p:p});
            send({type:'SCORE', val:sum});
        }

        function send(d) { if(conn) conn.send(d); }
    </script>
</body>
</html>
