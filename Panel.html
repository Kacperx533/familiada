<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PRO PANEL STEROWANIA - FAMILIADA</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --accent: #8b5cf6; --success: #10b981; --danger: #ef4444; --gold: #f59e0b; --text: #f8fafc; --blue: #3b82f6; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 15px; }
        .card { background: var(--card); border-radius: 15px; padding: 15px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.05); }
        h4 { font-size: 0.8rem; color: #94a3b8; text-transform: uppercase; margin: 0 0 10px 0; letter-spacing: 1px; }
        
        input, select { width: 100%; padding: 12px; background: #0f172a; border: 2px solid #334155; color: white; border-radius: 10px; font-size: 16px; box-sizing: border-box; margin-bottom: 10px; }
        
        .btn { border: none; border-radius: 10px; padding: 14px; font-weight: bold; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; width: 100%; }
        .btn:active { transform: scale(0.96); }
        .btn-primary { background: var(--accent); color: white; }
        .btn-green { background: var(--success); color: white; }
        .btn-red { background: var(--danger); color: white; }
        .btn-gold { background: var(--gold); color: black; }
        .btn-dark { background: #334155; color: white; }

        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; margin-bottom: 10px; }
        
        .ans-row { display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.2); padding: 10px; margin: 5px 0; border-radius: 10px; border: 1px solid rgba(255,255,255,0.05); }
        .strike-btn { background: var(--danger); font-size: 40px; height: 100px; margin-top: 10px; box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3); }
        .active-team { border: 3px solid var(--gold) !important; box-shadow: 0 0 15px var(--gold); }
        
        #panel-id-display { color: var(--gold); text-align: center; font-size: 0.9rem; font-weight: bold; margin-top: 10px; }
        .final-item { background: rgba(0,0,0,0.2); padding: 10px; border-radius: 12px; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div id="setup" class="card">
        <h2 style="text-align:center; margin-top:0;">FAMILIADA PRO</h2>
        <input type="text" id="tv-id" placeholder="WPISZ ID Z EKRANU TV">
        <button onclick="connectToTV()" class="btn btn-primary">PO≈ÅƒÑCZ Z TELEWIZOREM</button>
        <div id="panel-id-display">Generowanie ID Panelu...</div>
    </div>

    <div id="controls" style="display:none">
        
        <div class="card">
            <h4>Multimedia</h4>
            <div class="grid-2">
                <button onclick="sendToTV({type:'START_INTRO'})" class="btn btn-dark">üé¨ CZO≈Å√ìWKA</button>
                <button onclick="sendToTV({type:'START_OUTRO'})" class="btn btn-dark">üé¨ NAPISY</button>
            </div>
        </div>

        <div class="card">
            <h4>Sterowanie RundƒÖ</h4>
            <div class="grid-4">
                <button onclick="setR(1)" class="btn btn-dark">x1</button>
                <button onclick="setR(2)" class="btn btn-dark">x2</button>
                <button onclick="setR(3)" class="btn btn-dark">x3</button>
                <button onclick="setR('final')" class="btn btn-gold">FIN</button>
            </div>
            <div class="grid-2">
                <button onclick="controlBuzzers('UNLOCK')" class="btn btn-green">üîì ODBLOKUJ</button>
                <button onclick="controlBuzzers('LOCK')" class="btn btn-red">üîí ZABLOKUJ</button>
            </div>
        </div>

        <div id="normal-game-ui" class="card">
            <h4>Baza Pyta≈Ñ</h4>
            <select id="q-select" onchange="loadQ()"></select>
            <button onclick="sendQ()" class="btn btn-primary" style="margin-bottom:10px;">WY≈öLIJ PYTANIE NA TV</button>
            <div id="ans-list"></div>
        </div>

        <div id="final-game-ui" class="card" style="display:none">
            <h4>Panel Fina≈Çowy</h4>
            <select id="f-select" onchange="loadFinal()"></select>
            <div id="f-inputs"></div>
        </div>

        <div class="card">
            <h4>Dru≈ºyny i Wynik</h4>
            <div class="grid-2">
                <button onclick="setTeam('A')" id="btnA" class="btn btn-red">TEAM A</button>
                <button onclick="setTeam('B')" id="btnB" class="btn btn-primary" style="background:var(--blue)">TEAM B</button>
            </div>
            <button onclick="triggerStrike()" class="btn btn-red strike-btn">‚úñ</button>
            <div class="grid-2" style="margin-top:10px;">
                <div><label style="font-size:10px">PUNKTY A</label><input type="number" id="scA" value="0" onchange="sync()"></div>
                <div><label style="font-size:10px">PUNKTY B</label><input type="number" id="scB" value="0" onchange="sync()"></div>
            </div>
            <button onclick="resetStrikes()" class="btn btn-dark" style="font-size:10px; margin-top:5px;">RESET B≈ÅƒòD√ìW (X)</button>
        </div>
    </div>

    <script>
        let peer = new Peer();
        let tvConn, buzzerConns = [], activeTeam = null, strikes = {A:0, B:0}, multiplier = 1, currentAnswers = [];

        const db = [
            { q: "Wiƒôcej ni≈º jedno zwierzƒô?", a: [["Stado", 45], ["Para", 25], ["Owce", 15], ["Lama", 10], ["Wataha", 5]] },
            { q: "Zwierzƒô na literƒô K?", a: [["Kot", 48], ["Ko≈Ñ", 22], ["Krowa", 15], ["Kura", 10], ["Kangur", 5]] },
            { q: "Przedmiot w szkole?", a: [["Matematyka", 40], ["Polski", 25], ["WF", 15], ["Historia", 10], ["Biologia", 5]] },
            { q: "Co pijemy rano?", a: [["Kawa", 50], ["Herbata", 30], ["Woda", 15], ["Sok", 5]] },
            { q: "Co≈õ na kanapkƒô?", a: [["Ser", 40], ["Szynka", 35], ["Pomidor", 15], ["Mas≈Ço", 10]] },
            { q: "Owoc cytrusowy?", a: [["Cytryna", 45], ["Pomara≈Ñcza", 35], ["Mandarynka", 15], ["Grejpfrut", 5]] },
            { q: "Co ro≈õnie w lesie?", a: [["Grzyby", 50], ["Jagody", 25], ["Drzewa", 15], ["Mech", 10]] },
            { q: "Dyscyplina z pi≈ÇkƒÖ?", a: [["No≈ºna", 60], ["Siatk√≥wka", 20], ["Koszyk√≥wka", 15], ["Rƒôczna", 5]] },
            { q: "Co≈õ czerwonego?", a: [["Pomidor", 40], ["R√≥≈ºa", 30], ["Serce", 20], ["Krew", 10]] },
            { q: "Polskie miasto na K?", a: [["Krak√≥w", 60], ["Katowice", 20], ["Kielce", 10], ["Koszalin", 5]] }
        ];

        const finalDb = [
            { n: "Fina≈Ç: Wakacje", qs: ["Miejsce?", "W walizce?", "Nap√≥j?", "Pojazd?", "Na pla≈ºƒô?"], q: ["Morze", "Ubrania", "Woda", "Samolot", "Rƒôcznik"], p: [45, 30, 20, 15, 10] },
            { n: "Fina≈Ç: Dom", qs: ["Pok√≥j?", "Mebel?", "Kuchnia?", "≈öciana?", "Zwierzƒô?"], q: ["Salon", "Kanapa", "Lod√≥wka", "Obraz", "Pies"], p: [40, 35, 25, 10, 5] }
        ];

        peer.on('open', id => document.getElementById('panel-id-display').innerText = "TW√ìJ ID PANELU: " + id);
        
        peer.on('connection', conn => {
            if(!buzzerConns.find(c => c.peer === conn.peer)) buzzerConns.push(conn);
            conn.on('data', m => { 
                if(m.type === 'BUZZ') { sendToTV(m); controlBuzzers('LOCK'); }
            });
        });

        function connectToTV() {
            const id = document.getElementById('tv-id').value;
            if(!id) return alert("Wpisz ID TV!");
            tvConn = peer.connect(id);
            tvConn.on('open', () => {
                document.getElementById('setup').style.display='none';
                document.getElementById('controls').style.display='block';
                
                const qs = document.getElementById('q-select');
                qs.innerHTML = '<option value="">-- WYBIERZ PYTANIE --</option>';
                db.forEach((d, i) => qs.innerHTML += `<option value="${i}">${d.q}</option>`);
                
                const fs = document.getElementById('f-select');
                fs.innerHTML = '<option value="">-- WYBIERZ FINA≈Å --</option>';
                finalDb.forEach((f, i) => fs.innerHTML += `<option value="${i}">${f.n}</option>`);
            });
        }

        function broadcast(m) { buzzerConns.forEach(c => { if(c.open) c.send(m); }); }
        function controlBuzzers(state) { broadcast({type: state}); }
        function sendToTV(m) { if(tvConn && tvConn.open) tvConn.send(m); }

        function setR(r) { 
            multiplier = (typeof r === 'number') ? r : 1; 
            document.getElementById('normal-game-ui').style.display = (r === 'final') ? 'none' : 'block'; 
            document.getElementById('final-game-ui').style.display = (r === 'final') ? 'block' : 'none'; 
            sendToTV({type: 'NEXT_ROUND', round: r}); 
            strikes = {A:0, B:0}; 
            sync(); 
            controlBuzzers('LOCK'); 
        }

        function loadQ() {
            const val = document.getElementById('q-select').value;
            if(val==="") return;
            currentAnswers = db[val].a;
            const list = document.getElementById('ans-list');
            list.innerHTML = "";
            currentAnswers.forEach((a, i) => {
                list.innerHTML += `<div class="ans-row"><span>${a[0]} (${a[1]})</span><button onclick="reveal(${i})" class="btn btn-gold" style="width:80px; padding:5px; font-size:10px;">ODKRYJ</button></div>`;
            });
        }

        function sendQ() { 
            const val = document.getElementById('q-select').value; 
            if(val==="") return;
            sendToTV({type:'SETUP', q: db[val].q, a: currentAnswers.map(x=>({t:x[0], p:x[1]}))}); 
        }

        function reveal(i) {
            let pts = currentAnswers[i][1] * multiplier;
            sendToTV({type:'REVEAL', index:i, text:currentAnswers[i][0], pts: pts});
            if(activeTeam) {
                let s = document.getElementById('sc'+activeTeam);
                s.value = parseInt(s.value) + pts;
                sync();
            }
        }

        function triggerStrike() {
            sendToTV({type:'STRIKE'});
            if(activeTeam) {
                strikes[activeTeam]++;
                sync();
            }
        }

        function resetStrikes() {
            strikes = {A:0, B:0};
            sync();
        }

        function setTeam(t) { 
            activeTeam = t; 
            document.getElementById('btnA').className = t==='A' ? 'btn btn-red active-team' : 'btn btn-red'; 
            document.getElementById('btnB').className = t==='B' ? 'btn btn-primary active-team' : 'btn btn-primary'; 
        }

        function sync() { 
            sendToTV({
                type:'UPDATE', 
                scA: document.getElementById('scA').value, 
                scB: document.getElementById('scB').value, 
                strikes: strikes
            }); 
        }

        function loadFinal() {
            const val = document.getElementById('f-select').value;
            if(val==="") return;
            const f = finalDb[val];
            const div = document.getElementById('f-inputs');
            div.innerHTML = "";
            for(let p=1; p<=2; p++) {
                div.innerHTML += `<div class="final-item"><h4>Gracz ${p}</h4>`;
                for(let i=0; i<5; i++) {
                    div.innerHTML += `<div style="display:grid; grid-template-columns: 1fr 60px 45px 45px; gap:5px; margin-top:5px;">
                        <input id="f-t-${p}-${i}" placeholder="${f.qs[i]}">
                        <input id="f-p-${p}-${i}" type="number" placeholder="Pts">
                        <button onclick="rf(${p},${i},'t')" class="btn btn-dark" style="padding:2px">T</button>
                        <button onclick="rf(${p},${i},'p')" class="btn btn-green" style="padding:2px">P</button>
                    </div>`;
                }
                div.innerHTML += `</div>`;
            }
        }

        function rf(p, r, k) { 
            const val = document.getElementById(`f-${k}-${p}-${r}`).value; 
            sendToTV({type:'FINAL_REVEAL', p:p, r:r, k:k, v:val}); 
        }
    </script>
</body>
</html>
