<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>PANEL STEROWANIA</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #1a1a1a; color: white; display: grid; grid-template-columns: 320px 1fr 320px; gap: 15px; padding: 15px; }
        .card { background: #2a2a2a; padding: 15px; border-radius: 10px; border-top: 4px solid gold; margin-bottom: 10px; }
        h3 { margin: 0 0 10px; font-size: 13px; color: gold; text-transform: uppercase; letter-spacing: 1px; }
        button { width: 100%; padding: 12px; margin: 4px 0; cursor: pointer; border: none; font-weight: bold; border-radius: 5px; transition: 0.2s; }
        button:hover { opacity: 0.8; }
        .b-ok { background: #28a745; color: white; }
        .b-zla { background: #dc3545; color: white; }
        .b-blue { background: #007bff; color: white; }
        .b-gold { background: gold; color: #000; }
        input, select { width: 100%; padding: 10px; box-sizing: border-box; background: #000; color: #fff; border: 1px solid #444; margin-bottom: 8px; }
        .preview-btn { text-align: left; background: #333; color: #fff; border-left: 4px solid #555; }
    </style>
</head>
<body>

    <div class="col">
        <div class="card">
            <h3>1. Po≈ÇƒÖczenie</h3>
            <input type="text" id="peer-id" placeholder="Wpisz ID z ekranu TV">
            <button class="b-ok" onclick="connect()">PO≈ÅƒÑCZ Z TV</button>
        </div>
        <div class="card">
            <h3>2. Dru≈ºyny</h3>
            <input type="text" id="n1" value="Klasa 4A">
            <input type="text" id="n2" value="Nauczyciele">
            <button class="b-blue" onclick="updateNames()">ZASTOSUJ NAZWY</button>
        </div>
        <div class="card">
            <h3>3. Multimedia i X</h3>
            <button class="b-blue" onclick="send({type:'INTRO'})">üé¨ CZO≈Å√ìWKA</button>
            <button class="b-zla" style="font-size:20px" onclick="send({type:'STRIKE', num:1})">‚ùå Z≈ÅA (X)</button>
            <button class="b-zla" style="font-size:20px" onclick="send({type:'STRIKE', num:2})">‚ùå‚ùå Z≈ÅA (XX)</button>
            <button class="b-zla" style="font-size:20px" onclick="send({type:'STRIKE', num:3})">‚ùå‚ùå‚ùå Z≈ÅA (XXX)</button>
        </div>
    </div>

    <div class="col">
        <div class="card">
            <h3>4. Pytania</h3>
            <select id="m-select">
                <option value="1">Runda 1 (x1)</option>
                <option value="2">Runda 2 (x2)</option>
                <option value="3">Runda 3 (x3)</option>
            </select>
            <select id="q-select" onchange="loadQ()" size="15"></select>
            <button class="b-ok" style="height:60px" onclick="sendQ()">WY≈öLIJ PYTANIE NA TV</button>
        </div>
        <div class="card" id="ans-list">
            <h3>Odpowiedzi</h3>
        </div>
    </div>

    <div class="col">
        <div class="card">
            <h3>5. Fina≈Ç</h3>
            <button class="b-zla" onclick="send({type:'FINAL_MODE'})">TRYB FINA≈ÅOWY</button>
            <hr>
            <input type="text" id="ft" placeholder="S≈Çowo">
            <input type="number" id="fp" placeholder="Punkty">
            <select id="fi">
                <option value="0">Has≈Ço 1</option>
                <option value="1">Has≈Ço 2</option>
                <option value="2">Has≈Ço 3</option>
                <option value="3">Has≈Ço 4</option>
                <option value="4">Has≈Ço 5</option>
            </select>
            <button class="b-blue" onclick="sendF(1)">GRACZ 1 - ODS≈ÅO≈É</button>
            <button class="b-gold" onclick="sendF(2)">GRACZ 2 - ODS≈ÅO≈É</button>
        </div>
        <div class="card">
            <h3>Punkty</h3>
            <button onclick="resetScore()">ZERUJ SUMƒò</button>
        </div>
    </div>

    <script>
        // BAZA PYTA≈É (MO≈ªESZ DOPISAƒÜ WIƒòCEJ)
        const DB = [
            {q:"Wiƒôcej ni≈º jeden?", a:[["DU≈ªO",40],["KILKA",30],["PARA",20],["T≈ÅUM",10]]},
            {q:"Zwierzƒô z trƒÖbƒÖ?", a:[["S≈ÅO≈É",60],["KOMAR",25],["TAPIR",15]]},
            {q:"Co robimy w ferie?", a:[["JE≈πDZIMY NA NARTACH",40],["≈öPIMY",25],["GRAMY",20],["LEPIMY BA≈ÅWANA",15]]},
            {q:"Przedmiot szkolny?", a:[["MATEMATYKA",35],["WF",25],["POLSKI",20],["HISTORIA",10],["BIOLOGIA",10]]}
        ];
        // Automatyczne wype≈Çnienie do 50 zestaw√≥w
        for(let i=5; i<=50; i++) DB.push({q:"Zestaw pyta≈Ñ nr "+i, a:[["ODPOWIED≈π A",50],["ODPOWIED≈π B",30],["ODPOWIED≈π C",20]]});

        let conn, peer = new Peer(), currentSum = 0;

        window.onload = () => {
            const sel = document.getElementById('q-select');
            DB.forEach((x, i) => sel.innerHTML += `<option value="${i}">${i+1}. ${x.q}</option>`);
        };

        function connect() {
            conn = peer.connect(document.getElementById('peer-id').value);
            conn.on('open', () => alert("PO≈ÅƒÑCZONO Z TABLICƒÑ TV!"));
        }

        function send(d) { if(conn) conn.send(d); }

        function loadQ() {
            const q = DB[document.getElementById('q-select').value];
            const list = document.getElementById('ans-list');
            list.innerHTML = '<h3>Odpowiedzi</h3>';
            q.a.forEach((x, i) => {
                list.innerHTML += `<button class="preview-btn" onclick="reveal(${i}, ${x[1]})">${x[0]} (${x[1]})</button>`;
            });
        }

        function sendQ() {
            currentSum = 0; updateScore();
            const q = DB[document.getElementById('q-select').value];
            const m = document.getElementById('m-select').value;
            send({type:'SETUP', ans: q.a.map(x=>({t:x[0], p:x[1]*m}))});
            loadQ();
        }

        function reveal(idx, pts) {
            const m = document.getElementById('m-select').value;
            currentSum += (pts * m);
            updateScore();
            send({type:'REV', idx: idx});
        }

        function updateNames() {
            send({type:'NAMES', n1: document.getElementById('n1').value, n2: document.getElementById('n2').value});
        }

        function updateScore() { send({type:'SCORE', sum: currentSum}); }
        function resetScore() { currentSum = 0; updateScore(); }

        function sendF(p) {
            send({type:'FINAL_REV', p:p, i:document.getElementById('fi').value, txt:document.getElementById('ft').value.toUpperCase(), pts:document.getElementById('fp').value});
        }
    </script>
</body>
</html>
