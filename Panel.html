<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>FAMILIADA - PANEL PRO</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #121212; color: #e0e0e0; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .app-container { max-width: 500px; width: 100%; }
        .card { background: #1e1e1e; border-radius: 12px; padding: 20px; margin-bottom: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); border: 1px solid #333; }
        h3 { margin-top: 0; color: #FFD700; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        
        input, select { width: 100%; padding: 12px; background: #2c2c2c; border: 1px solid #444; color: white; border-radius: 6px; margin-bottom: 10px; font-size: 16px; }
        
        button { width: 100%; padding: 15px; margin: 5px 0; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; font-size: 15px; transition: transform 0.1s; }
        button:active { transform: scale(0.98); }
        
        .btn-main { background: #FFD700; color: black; }
        .btn-blue { background: #2196F3; color: white; }
        .btn-red { background: #f44336; color: white; }
        .btn-green { background: #4CAF50; color: white; }
        
        .round-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 5px; }
        .score-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        
        .ans-item { display: flex; justify-content: space-between; align-items: center; background: #262626; padding: 10px; border-radius: 6px; margin-top: 5px; border-left: 4px solid #FFD700; }
        .ans-item button { width: 60px; padding: 8px; margin: 0; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="card">
        <h3>1. Połączenie</h3>
        <input type="text" id="target-id" placeholder="Wpisz KOD z ekranu TV">
        <button onclick="initConn()" class="btn-main">POŁĄCZ Z TELEWIZOREM</button>
    </div>

    <div id="ui" style="display:none">
        <div class="card">
            <h3>2. Rundy i Tryby</h3>
            <div class="round-grid">
                <button onclick="setR(1)" class="btn-blue">x1</button>
                <button onclick="setR(2)" class="btn-blue">x2</button>
                <button onclick="setR(3)" class="btn-blue">x3</button>
            </div>
            <button onclick="setR('FIN')" class="btn-main" style="margin-top:10px">TRYB FINAŁOWY</button>
        </div>

        <div class="card">
            <h3>3. Pytania</h3>
            <select id="q-select" onchange="loadQ()"></select>
            <button onclick="sendBoard()" class="btn-green">WYŚLIJ TABLICĘ (........)</button>
            <div id="ans-list"></div>
        </div>

        <div class="card">
            <h3>4. Sterowanie Grą</h3>
            <button onclick="strike()" class="btn-red" style="height: 70px; font-size: 24px;">X (BŁĄD!)</button>
            
            <div class="score-grid">
                <div>
                    <small>DRUŻYNA A</small>
                    <input type="number" id="scA" value="0" onchange="sync()">
                </div>
                <div>
                    <small>DRUŻYNA B</small>
                    <input type="number" id="scB" value="0" onchange="sync()">
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const db = [
        { q: "Szkolny przedmiot?", a: [["MATEMATYKA", 35], ["POLSKI", 25], ["WF", 20], ["HISTORIA", 12], ["CHEMIA", 8]] },
        { q: "Zwierzę domowe?", a: [["PIES", 48], ["KOT", 32], ["CHOMIK", 12], ["RYBKI", 8]] },
        { q: "Pora roku?", a: [["LATO", 40], ["WIOSNA", 30], ["ZIMA", 20], ["JESIEŃ", 10]] },
        { q: "FINAŁ 1: Kolor?", a: [["CZERWONY", 45], ["NIEBIESKI", 25], ["ZIELONY", 15], ["ŻÓŁTY", 10]] }
    ];

    let peer = new Peer(), conn, mult = 1, currentAnswers = [];

    function initConn() {
        const id = document.getElementById('target-id').value;
        conn = peer.connect(id);
        conn.on('open', () => {
            document.getElementById('ui').style.display = 'block';
            const s = document.getElementById('q-select');
            s.innerHTML = '<option value="">-- Wybierz pytanie --</option>';
            db.forEach((d, i) => s.innerHTML += `<option value="${i}">${d.q}</option>`);
        });
    }

    function setR(v) {
        mult = (typeof v === 'number') ? v : 1;
        if(conn) conn.send({type: 'ROUND', val: v});
    }

    function loadQ() {
        const i = document.getElementById('q-select').value;
        if(i==="") return;
        currentAnswers = db[i].a;
        const list = document.getElementById('ans-list');
        list.innerHTML = "";
        currentAnswers.forEach((a, idx) => {
            list.innerHTML += `<div class="ans-item"><span>${a[0]} (${a[1]})</span><button onclick="reveal(${idx})" class="btn-green">OK</button></div>`;
        });
    }

    function sendBoard() {
        if(conn) conn.send({type: 'SETUP', a: currentAnswers.map(x => ({text: x[0], pts: x[1]}))});
    }

    function reveal(idx) {
        if(conn) conn.send({type: 'REVEAL', index: idx, text: currentAnswers[idx][0], pts: currentAnswers[idx][1] * mult});
    }

    function strike() { if(conn) conn.send({type: 'STRIKE'}); }

    function sync() {
        if(conn) conn.send({
            type: 'UPDATE', 
            scA: document.getElementById('scA').value, 
            scB: document.getElementById('scB').value
        });
    }
</script>
</body>
</html>
