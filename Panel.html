<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>PANEL STEROWANIA PRO</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #121212; color: white; display: grid; grid-template-columns: 350px 1fr 300px; gap: 15px; padding: 15px; margin: 0; }
        .card { background: #1e1e1e; padding: 15px; border-radius: 8px; border-top: 4px solid #dfff00; }
        h3 { color: #dfff00; margin-top: 0; font-size: 14px; text-transform: uppercase; border-bottom: 1px solid #333; padding-bottom: 5px; }
        button { background: #333; color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; font-weight: bold; width: 100%; margin-bottom: 5px; }
        button:hover { background: #444; }
        .btn-gold { background: #dfff00; color: black; }
        .btn-red { background: #aa0000; }
        .btn-blue { background: #0055ff; }
        input, select { width: 100%; padding: 10px; background: #000; color: #fff; border: 1px solid #444; border-radius: 5px; margin-bottom: 10px; box-sizing: border-box; }
        .score-box { font-size: 32px; text-align: center; color: #dfff00; background: #000; padding: 10px; border-radius: 5px; margin: 10px 0; }
        .cheat-sheet { height: 550px; overflow-y: auto; font-size: 13px; color: #ccc; background: #0a0a0a; padding: 10px; line-height: 1.6; }
    </style>
</head>
<body>

    <div>
        <div class="card">
            <h3>CZO≈Å√ìWKA I POWT√ìRKI</h3>
            <button class="btn-gold" onclick="sendVideo('intro.mp4')">üé¨ P≈ÅY≈É CZO≈Å√ìWKA (INTRO)</button>
            <button class="btn-gold" onclick="sendVideo('powtorka.mp4')">üîÑ POWT√ìRKA (REPLAY)</button>
            <button class="btn-red" onclick="send({type:'STOP_VIDEO'})">STOP WIDEO</button>
            <hr style="border:0; border-top:1px solid #333">
            <button onclick="sendSound('runda')">üéµ D≈πWIƒòK RUNDY</button>
            <button onclick="sendSound('final')">üèÅ MUZYKA FINA≈ÅU</button>
        </div>

        <div class="card" style="margin-top:15px">
            <h3>DRU≈ªYNY I B≈ÅƒòDY</h3>
            <div style="display:flex; gap:5px">
                <button class="btn-blue" onclick="activeSide='L'">DRU≈ªYNA L</button>
                <button class="btn-red" onclick="activeSide='R'">DRU≈ªYNA R</button>
            </div>
            <div style="display:flex; gap:5px">
                <button onclick="sendX(1)">X</button><button onclick="sendX(2)">XX</button><button onclick="sendX(3)">XXX</button>
            </div>
            <button onclick="send({type:'X', side:'L', n:0})">WYCZY≈öƒÜ IKSY</button>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px">
                <div>L: <div id="pts-L" class="score-box">0</div><button onclick="addGlobal('L')">DODAJ</button></div>
                <div>R: <div id="pts-R" class="score-box">0</div><button onclick="addGlobal('R')">DODAJ</button></div>
            </div>
        </div>
    </div>

    <div>
        <div class="card">
            <h3>PYTANIA RUNDY</h3>
            <select id="q-select" onchange="previewQ()"></select>
            <button class="btn-gold" onclick="sendQ()" style="height:50px">WY≈öLIJ PYTANIE NA TV</button>
            <div id="ans-preview" style="margin-top:10px"></div>
            <div class="score-box">SUMA TABLICY: <span id="current-sum">0</span></div>
        </div>

        <div class="card" style="margin-top:15px">
            <h3>FINA≈Å (DWAJ GRACZE)</h3>
            <div style="display:flex; gap:5px">
                <button onclick="runTimer(15)">TIMER 15s (G1)</button>
                <button onclick="runTimer(20)">TIMER 20s (G2)</button>
            </div>
            <button class="btn-gold" onclick="send({type:'SETUP_FINAL'})">W≈ÅƒÑCZ TABLICƒò FINA≈ÅOWƒÑ</button>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px">
                <div id="f-p1"><b>GRACZ 1</b></div>
                <div id="f-p2"><b>GRACZ 2</b></div>
            </div>
        </div>
    </div>

    <div class="card">
        <h3>PYTANIA DO FINA≈ÅU</h3>
        <div class="cheat-sheet" id="cheat"></div>
    </div>

    <script>
        const DB = [
            {q:"Co≈õ do picia na gorƒÖco", a:[["HERBATA",45],["KAWA",30],["KAKAO",15],["MLEKO",7],["NAPAR",3]]},
            {q:"Zwierzƒô na literƒô K", a:[["KOT",40],["KO≈É",25],["KROWA",15],["KANGUR",12],["KROKODYL",8]]},
            {q:"Wiƒôcej ni≈º jedno zwierzƒô", a:[["STADO",50],["KLUCZ",25],["WATAHA",15],["CHMARA",10]]},
            {q:"Przedmiot szkolny", a:[["MATEMATYKA",40],["POLSKI",30],["WF",20],["HISTORIA",10]]},
            {q:"Co≈õ s≈Çodkiego", a:[["CZEKOLADA",40],["CIASTKO",30],["CUKIERKI",20],["BATON",10]]},
            {q:"Marka samochodu", a:[["TOYOTA",30],["AUDI",25],["BMW",20],["FIAT",15],["OPEL",10]]},
            {q:"Czƒô≈õƒá garderoby", a:[["SPODNIE",40],["KOSZULA",30],["BUTY",20],["CZAPKA",10]]},
            {q:"Owoc egzotyczny", a:[["BANAN",45],["ANANAS",30],["MANGO",15],["KIWI",10]]},
            {q:"Instrument muzyczny", a:[["GITARA",40],["PIANINO",30],["SKRZYPCE",20],["TRƒÑBKA",10]]},
            {q:"Co≈õ co lata", a:[["SAMOLOT",50],["PTAK",30],["MUCHA",15],["DRON",5]]}
        ];

        const FINAL_PYTANIA = [
            "ZESTAW 1:<br>1. Co≈õ co siƒô klei?<br>2. Czƒô≈õƒá roweru?<br>3. Rodzaj kawy?<br>4. Zimny deser?<br>5. Ryba s≈Çodkowodna?",
            "ZESTAW 2:<br>1. Co≈õ na baterie?<br>2. Kwiat ogrodowy?<br>3. Miasto nad Wis≈ÇƒÖ?<br>4. Sport zimowy?<br>5. Owad po≈ºyteczny?",
            "ZESTAW 3:<br>1. Co≈õ okrƒÖg≈Çego?<br>2. Rodzaj spodni?<br>3. Metal szlachetny?<br>4. Stolica europejska?<br>5. Krajobraz g√≥rski?"
        ];

        let peer = new Peer(), conn, activeSide = 'L', sum = 0, globals = {L:0, R:0};

        function connect() { 
            conn = peer.connect(document.getElementById('tv-id').value);
            conn.on('open', () => {
                document.getElementById('status').innerText = "Status: PO≈ÅƒÑCZONO";
                document.getElementById('status').style.color = "lime";
            });
        }

        window.onload = () => {
            const sel = document.getElementById('q-select');
            DB.forEach((x,i) => sel.innerHTML += `<option value="${i}">${x.q}</option>`);
            
            const cheat = document.getElementById('cheat');
            FINAL_PYTANIA.forEach(q => cheat.innerHTML += `<div style="border-bottom:1px solid #333; margin-bottom:10px">${q}</div>`);

            ['p1','p2'].forEach(p => {
                const div = document.getElementById('f-'+p);
                for(let i=0; i<5; i++) {
                    div.innerHTML += `<div style="margin-bottom:5px">
                        <input id="f-${p}-t-${i}" placeholder="Odp" style="width:60%">
                        <input id="f-${p}-p-${i}" type="number" placeholder="Pkt" style="width:25%">
                        <button onclick="revealFinal('${p}',${i})" style="width:100%">OK</button>
                    </div>`;
                }
            });
            previewQ();
        };

        function sendVideo(f) { send({type:'PLAY_VIDEO', file: f}); }
        function sendSound(f) { send({type:'SOUND', file: f}); }
        function sendX(n) { send({type:'X', side: activeSide, n: n}); }
        
        function sendQ() {
            sum = 0; updateSum();
            const q = DB[document.getElementById('q-select').value];
            send({type:'SETUP_NORMAL', ans: q.a.map(x=>({t:x[0], p:x[1]}))});
            previewQ();
        }

        function previewQ() {
            const q = DB[document.getElementById('q-select').value];
            document.getElementById('ans-preview').innerHTML = q.a.map((x,i) => `
                <button onclick="revNormal(${i},${x[1]})" style="text-align:left">${i+1}. ${x[0]} (${x[1]})</button>
            `).join('');
        }

        function revNormal(i,p) { sum+=p; updateSum(); send({type:'REV_NORMAL', idx:i}); send({type:'SCORE', val:sum}); }
        function updateSum() { document.getElementById('current-sum').innerText = sum; }

        function addGlobal(s) { globals[s]+=sum; document.getElementById('pts-'+s).innerText=globals[s]; sum=0; updateSum(); send({type:'SCORE', val:0}); }

        function revealFinal(p,i) {
            const t = document.getElementById(`f-${p}-t-${i}`).value.toUpperCase();
            const pts = parseInt
