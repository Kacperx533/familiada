<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>FAMILIADA - PANEL</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #1a1a1a; color: #fff; margin: 0; display: grid; grid-template-columns: 320px 1fr; height: 100vh; }
        .sidebar { background: #222; padding: 20px; border-right: 2px solid #fbc02d; overflow-y: auto; }
        .main { padding: 20px; overflow-y: auto; }
        .card { background: #333; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        button { padding: 10px; margin-bottom: 5px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; width: 100%; text-transform: uppercase; }
        .btn-y { background: #fbc02d; color: #000; }
        .btn-b { background: #1976d2; color: #fff; }
        .btn-r { background: #d32f2f; color: #fff; }
        .team-sel { display: flex; gap: 5px; margin-bottom: 10px; }
        .team-sel input { display: none; }
        .team-sel label { flex: 1; padding: 10px; background: #444; text-align: center; cursor: pointer; border-radius: 4px; }
        .team-sel input:checked + label { background: #fbc02d; color: #000; }
        input, select, textarea { width: 100%; padding: 8px; margin: 5px 0; background: #000; color: #fff; border: 1px solid #555; box-sizing: border-box; }
        .score-row { display: flex; justify-content: space-between; font-size: 20px; margin-bottom: 10px; color: #fbc02d; }
    </style>
</head>
<body>
    <div class="sidebar">
        <input id="target-id" placeholder="KOD Z TV" maxlength="3" style="text-align:center; font-size:20px;">
        <button onclick="connect()" class="btn-b">PO≈ÅƒÑCZ</button>
        
        <h3 style="color:#fbc02d">KOMU NALICZAƒÜ?</h3>
        <div class="team-sel">
            <input type="radio" name="active-team" id="tL" value="L" checked><label for="tL">LEWA</label>
            <input type="radio" name="active-team" id="tC" value="C"><label for="tC">≈öRODEK</label>
            <input type="radio" name="active-team" id="tR" value="R"><label for="tR">PRAWA</label>
        </div>

        <div class="score-row">
            <span>L: <b id="lScore">0</b></span>
            <span>≈öR: <b id="cScore">0</b></span>
            <span>P: <b id="rScore">0</b></span>
        </div>

        <h3>B≈ÅƒòDY (X)</h3>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px">
            <div>
                <small>LEWA</small>
                <button class="btn-r" onclick="send({type:'X', count:1})">X</button>
                <button class="btn-r" onclick="send({type:'X', count:2})">XX</button>
                <button class="btn-r" onclick="send({type:'X', count:3})">XXX</button>
            </div>
            <div>
                <small>PRAWA</small>
                <button class="btn-r" onclick="send({type:'X', count:1})">X</button>
                <button class="btn-r" onclick="send({type:'X', count:2})">XX</button>
                <button class="btn-r" onclick="send({type:'X', count:3})">XXX</button>
            </div>
        </div>

        <h3 style="margin-top:20px">D≈πWIƒòKI</h3>
        <button class="btn-y" onclick="send({type:'PLAY_VID'})">üé¨ CZO≈Å√ìWKA</button>
        <button class="btn-y" onclick="send({type:'PLAY_SND', id:'snd-runda'})">üéµ START RUNDY</button>
        <button class="btn-y" onclick="send({type:'PLAY_SND', id:'snd-final'})">üéµ FINAL MUZYKA</button>
        <button class="btn-b" onclick="send({type:'PLAY_SND', id:'snd-powt'})">‚ö†Ô∏è POWT√ìRKA</button>
    </div>

    <div class="main">
        <div class="card">
            <h3>RUNDY 1-4</h3>
            <textarea id="raw-data" rows="3" placeholder="Has≈Ço, Punkty"></textarea>
            <button onclick="setupNormal()" class="btn-y">USTAW TABLICƒò</button>
            <div id="normal-btns" style="margin-top:10px"></div>
        </div>

        <div class="card">
            <h3>FINA≈Å</h3>
            <button onclick="setupFinal()" class="btn-b">TABLICA FINA≈ÅOWA</button>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-top:10px">
                <div>
                    <button class="btn-r" onclick="send({type:'TIMER', sec:15})">ZEGAR 15S</button>
                    <div id="p1-ui"></div>
                    <button onclick="send({type:'HIDE_P1'})" style="background:#555; color:#fff">UKRYJ G1</button>
                </div>
                <div>
                    <button class="btn-r" onclick="send({type:'TIMER', sec:20})">ZEGAR 20S</button>
                    <div id="p2-ui"></div>
                </div>
            </div>
        </div>
        <button onclick="scoreL=0; scoreR=0; scoreC=0; sync()" class="btn-r">ZRESETUJ WSZYSTKIE PUNKTY</button>
    </div>

    <script>
        const peer = new Peer();
        let conn, scoreL = 0, scoreR = 0, scoreC = 0;

        function connect() { conn = peer.connect(document.getElementById('target-id').value.toUpperCase()); conn.on('open', () => alert("PO≈ÅƒÑCZONO")); }
        function send(d) { if(conn) conn.send(d); }

        function sync() {
            document.getElementById('lScore').innerText = scoreL;
            document.getElementById('rScore').innerText = scoreR;
            document.getElementById('cScore').innerText = scoreC;
            send({type:'SCORE_SYNC', l: scoreL, r: scoreR, c: scoreC});
        }

        function setupNormal() {
            const lines = document.getElementById('raw-data').value.split('\n');
            const ans = lines.map(l => ({ t: l.split(',')[0], p: parseInt(l.split(',')[1]) || 0 }));
            send({type:'SETUP_NORMAL', ans: ans});
            document.getElementById('normal-btns').innerHTML = ans.map((a, i) => `
                <div style="display:flex; gap:5px; margin-bottom:2px">
                    <span style="flex:1">${a.t} (${a.p})</span>
                    <button onclick="rev(${i},'${a.t}',${a.p})" class="btn-b" style="width:100px">OK</button>
                </div>`).join('');
        }

        function rev(idx, t, p) {
            send({type:'REV', mode:'normal', idx:idx, t:t, p:p});
            let team = document.querySelector('input[name="active-team"]:checked').value;
            if(team === 'L') scoreL += p; else if(team === 'R') scoreR += p; else scoreC += p;
            sync();
        }

        function setupFinal() {
            send({type:'SETUP_FINAL'});
            const gen = (pid) => {
                let h = '';
                for(let i=0; i<5; i++) h += `<div style="display:flex; gap:2px; margin-bottom:2px">
                    <input id="p${pid}t${i}" placeholder="H" style="width:70px">
                    <input id="p${pid}p${i}" placeholder="P" style="width:30px">
                    <button onclick="revF(${pid},${i})" class="btn-b" style="width:40px">OK</button></div>`;
                document.getElementById(`p${pid}-ui`).innerHTML = h;
            };
            gen(1); gen(2);
        }

        function revF(pid, idx) {
            const t = document.getElementById(`p${pid}t${idx}`).value;
            const p = parseInt(document.getElementById(`p${pid}p${idx}`).value) || 0;
            send({type:'REV', mode:'final', player:pid, idx:idx, t:t, p:p});
            let team = document.querySelector('input[name="active-team"]:checked').value;
            if(team === 'L') scoreL += p; else if(team === 'R') scoreR += p; else scoreC += p;
            sync();
        }
    </script>
</body>
</html>
