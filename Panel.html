<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PILOT</title>
    <script src="https://cdn.jsdelivr.net/npm/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <style>
        body { background: #111; color: white; font-family: sans-serif; padding: 10px; text-align: center; }
        button { padding: 15px; margin: 5px; width: 90%; border-radius: 10px; border: none; font-weight: bold; }
        input { padding: 15px; width: 80%; font-size: 20px; margin-bottom: 10px; border-radius: 10px; }
        .status-on { color: #00ff00; margin-bottom: 10px; }
        .btn-x { background: red; color: white; width: 30%; }
        .btn-ok { background: #fbc02d; }
    </style>
</head>
<body>

    <h2>PILOT FAMILIADY</h2>
    <div id="conn-status" style="color: red;">BRAK POŁĄCZENIA</div>
    <input id="target-id" placeholder="WPISZ KOD Z TV">
    <button onclick="connect()" style="background: #1976d2; color: white;">POŁĄCZ Z TELEWIZOREM</button>

    <hr>

    <div style="display: flex; justify-content: space-around;">
        <div>D1: <h3 id="lS">0</h3></div>
        <div>D2: <h3 id="rS">0</h3></div>
    </div>

    <button class="btn-ok" onclick="sendSnd('snd-intro')">MUZYKA INTRO</button>
    <button class="btn-ok" onclick="sendSnd('snd-runda')">DŹWIĘK RUNDY</button>
    <button class="btn-ok" onclick="sendSnd('snd-final')">MUZYKA FINAŁU</button>

    <div style="margin-top: 20px;">
        <button class="btn-x" onclick="sendX(1)">X</button>
        <button class="btn-x" onclick="sendX(2)">XX</button>
        <button class="btn-x" onclick="sendX(3)">XXX</button>
    </div>

    <hr>
    <h3>SZYBKI TEST (RUNDA 1)</h3>
    <button onclick="testRunda()">ZAŁADUJ TESTOWĄ RUNDĘ</button>
    <div id="btns"></div>

    <script>
        let peer = new Peer();
        let conn;
        let sL = 0, sR = 0;

        function connect() {
            const code = document.getElementById('target-id').value.toUpperCase();
            conn = peer.connect(code);
            conn.on('open', () => {
                document.getElementById('conn-status').innerText = "POŁĄCZONO!";
                document.getElementById('conn-status').className = "status-on";
            });
        }

        function sendSnd(id) { if(conn) conn.send({type: 'PLAY_SND', id: id}); }
        function sendX(c) { if(conn) conn.send({type: 'X', count: c}); }

        function testRunda() {
            const data = [ {t: "PIES", p: 40}, {t: "KOT", p: 30}, {t: "CHOMIK", p: 10} ];
            if(conn) conn.send({type: 'SETUP_NORMAL', ans: data});
            
            let html = "";
            data.forEach((a, i) => {
                html += `<button style="background: #444; color: white" onclick="reveal(${i}, '${a.t}', ${a.p})">${a.t}</button>`;
            });
            document.getElementById('btns').innerHTML = html;
        }

        function reveal(idx, t, p) {
            if(conn) {
                conn.send({type: 'REV', idx: idx, t: t, p: p});
                sL += p; // Automatycznie do Lewej dla testu
                document.getElementById('lS').innerText = sL;
                conn.send({type: 'SCORE_SYNC', l: sL, r: sR});
            }
        }
    </script>
</body>
</html>
