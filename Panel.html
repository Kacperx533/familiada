<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>FAMILIADA - PANEL STEROWANIA</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #121212; color: white; display: grid; grid-template-columns: 350px 1fr 350px; gap: 20px; padding: 20px; }
        .card { background: #1e1e1e; padding: 15px; border-radius: 10px; border-top: 4px solid #e2ff00; }
        button { width: 100%; padding: 10px; margin: 5px 0; cursor: pointer; font-weight: bold; border-radius: 5px; border: none; }
        .btn-gold { background: #e2ff00; color: black; }
        .btn-red { background: #ff3333; color: white; }
        .btn-blue { background: #007bff; color: white; }
        .score-box { font-size: 30px; text-align: center; background: #000; padding: 10px; color: #e2ff00; margin: 10px 0; }
        input, select { width: 100%; padding: 10px; background: #000; color: white; border: 1px solid #444; margin-bottom: 10px; }
        .ans-btn { background: #333; color: white; text-align: left; }
    </style>
</head>
<body>
    <div>
        <div class="card">
            <h3>PO≈ÅƒÑCZENIE</h3>
            <input id="tv-id" placeholder="Wpisz ID z ekranu TV">
            <button class="btn-gold" onclick="connect()">PO≈ÅƒÑCZ</button>
            <div id="status">STATUS: ROZ≈ÅƒÑCZONY</div>
        </div>
        <div class="card" style="margin-top:20px">
            <h3>MULTIMEDIA</h3>
            <button onclick="send({type:'PLAY_MEDIA', video:'intro.mp4'})">üé¨ CZO≈Å√ìWKA</button>
            <button onclick="send({type:'PLAY_MEDIA', video:'runda.mp4', audio:'runda'})">RUNDA START</button>
            <button onclick="send({type:'PLAY_MEDIA', video:'final.mp4'})">üèÜ FINA≈Å WIDEO</button>
            <button onclick="send({type:'PLAY_MEDIA', video:'powtorka.mp4'})">üîÑ POWT√ìRKA</button>
            <button class="btn-red" onclick="send({type:'STOP_VIDEO'})">STOP WIDEO</button>
        </div>
    </div>

    <div>
        <div class="card">
            <h3>GRA</h3>
            <select id="q-select" onchange="previewQ()"></select>
            <button class="btn-gold" onclick="sendQ()">ZA≈ÅADUJ PYTANIE</button>
            <div id="ans-preview"></div>
            <div class="score-box">SUMA: <span id="current-sum">0</span></div>
            <button class="btn-red" onclick="sendX(1)">X</button>
            <button class="btn-red" onclick="sendX(3)">XXX</button>
            <button onclick="activeSide='L'">LEWA</button><button onclick="activeSide='R'">PRAWA</button>
        </div>
    </div>

    <div>
        <div class="card">
            <h3>FINA≈Å</h3>
            <button onclick="send({type:'SETUP_FINAL'})">TABELA FINA≈ÅOWA</button>
            <button onclick="runTimer(15)">TIMER 15s</button>
            <button onclick="runTimer(20)">TIMER 20s</button>
            <div id="final-inputs"></div>
        </div>
    </div>

    <script>
        const DB = [
            {q:"Zwierzƒô na P", a:[["PIES",45],["PTAK",25],["PANDA",15],["PCH≈ÅA",5]]},
            {q:"Wiƒôcej ni≈º jedno zwierzƒô", a:[["STADO",50],["KLUCZ",20],["WATAHA",15],["SFORA",5]]},
            {q:"Przedmiot w kuchni", a:[["N√ì≈ª",40],["GARNEK",30],["TALERZ",20],["≈ÅY≈ªKA",10]]}
        ];
        let peer = new Peer(), conn, sum=0, activeSide='L';

        function connect() { 
            conn = peer.connect(document.getElementById('tv-id').value);
            conn.on('open', () => document.getElementById('status').innerText = "PO≈ÅƒÑCZONO");
        }

        window.onload = () => {
            const s = document.getElementById('q-select');
            DB.forEach((x,i) => s.innerHTML += `<option value="${i}">${x.q}</option>`);
            const f = document.getElementById('final-inputs');
            ['p1','p2'].forEach(p => {
                for(let i=0; i<5; i++) f.innerHTML += `<input id="f-${p}-t-${i}" placeholder="Odp"><input id="f-${p}-p-${i}" type="number" style="width:50px"><button onclick="revF('${p}',${i})">OK</button>`;
            });
        };

        function sendQ() { sum=0; updateS(); const q=DB[document.getElementById('q-select').value]; send({type:'SETUP_NORMAL', ans: q.a.map(x=>({t:x[0], p:x[1]}))}); previewQ(); }
        function previewQ() { const q=DB[document.getElementById('q-select').value]; document.getElementById('ans-preview').innerHTML = q.a.map((x,i) => `<button class="ans-btn" onclick="revN(${i},${x[1]})">${x[0]} (${x[1]})</button>`).join(''); }
        function revN(i,p) { sum+=p; updateS(); send({type:'REV_NORMAL', idx:i}); send({type:'SCORE', val:sum}); }
        function revF(p,i) { const t=document.getElementById(`f-${p}-t-${i}`).value.toUpperCase(), pts=parseInt(document.getElementById(`f-${p}-p-${i}`).value)||0; sum+=pts; updateS(); send({type:'REV_FINAL', player:p, idx:i, t:t, p:pts}); send({type:'SCORE', val:sum}); }
        function updateS() { document.getElementById('current-sum').innerText = sum; }
        function sendX(n) { send({type:'X', side:activeSide, n:n}); }
        function runTimer(s) { let c=s; send({type:'TIMER', action:'start', val:c}); let itv=setInterval(()=>{ c--; send({type:'TIMER', action:'tick', val:c}); if(c<=0){ clearInterval(itv); send({type:'TIMER', action:'stop'}); } }, 1000); }
        function send(d) { if(conn) conn.send(d); }
    </script>
</body>
</html>
