<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>FAMILIADA - PANEL STEROWANIA</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #121212; color: #fff; margin: 0; display: grid; grid-template-columns: 320px 1fr; height: 100vh; overflow: hidden; }
        .sidebar { background: #1e1e1e; padding: 15px; border-right: 2px solid #fbc02d; overflow-y: auto; }
        .main { padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .card { background: #2a2a2a; padding: 12px; border-radius: 8px; border: 1px solid #444; }
        h3 { color: #fbc02d; margin: 0 0 10px 0; font-size: 14px; text-transform: uppercase; border-bottom: 1px solid #444; padding-bottom: 5px; }
        button { padding: 8px; margin-bottom: 4px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; width: 100%; text-transform: uppercase; font-size: 11px; }
        .btn-y { background: #fbc02d; color: #000; }
        .btn-b { background: #1976d2; color: #fff; }
        .btn-r { background: #d32f2f; color: #fff; }
        .team-sel { display: flex; gap: 4px; margin-bottom: 10px; }
        .team-sel input { display: none; }
        .team-sel label { flex: 1; padding: 10px; background: #333; text-align: center; cursor: pointer; border-radius: 4px; font-size: 12px; }
        .team-sel input:checked + label { background: #fbc02d; color: #000; }
        input, select, textarea { width: 100%; padding: 8px; margin: 4px 0; background: #000; color: #fff; border: 1px solid #555; box-sizing: border-box; }
        .cheat-sheet { background: #000; padding: 12px; border-top: 3px solid #fbc02d; }
        .cheat-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; font-size: 11px; color: #ccc; }
        .cheat-item { border-bottom: 1px solid #222; padding-bottom: 5px; }
        .top-ans { color: #fbc02d; font-weight: bold; }
        .score-row { display: flex; justify-content: space-around; font-size: 22px; color: #fbc02d; font-weight: bold; background: #000; padding: 10px; border-radius: 5px; margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="sidebar">
        <input id="target-id" placeholder="KOD Z TV" maxlength="3" style="text-align:center; font-size:20px; border: 2px solid #fbc02d;">
        <button onclick="connect()" class="btn-b" style="margin-bottom:15px">PO≈ÅƒÑCZ Z EKRANEM</button>
        
        <h3>MULTIMEDIA</h3>
        <button class="btn-y" onclick="send({type:'PLAY_VID'})">üé¨ CZO≈Å√ìWKA (WIDEO)</button>
        <button class="btn-y" onclick="send({type:'PLAY_SND', id:'snd-intro'})">üéµ INTRO (MUZYKA)</button>
        <button class="btn-b" onclick="playFinal()">üéπ MUZYKA FINA≈ÅU</button>
        <button class="btn-b" onclick="send({type:'PLAY_SND', id:'snd-powt'})">‚ö†Ô∏è POWT√ìRKA</button>

        <h3 style="margin-top:15px">KONTROLA PUNKT√ìW</h3>
        <div class="team-sel">
            <input type="radio" name="active-team" id="tL" value="L" checked><label for="tL">LEWA (D1)</label>
            <input type="radio" name="active-team" id="tR" value="R"><label for="tR">PRAWA (D2)</label>
        </div>
        <div class="score-row">
            <span>D1: <b id="lScore">0</b></span>
            <span>D2: <b id="rScore">0</b></span>
        </div>

        <h3>B≈ÅƒòDY (X)</h3>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px">
            <div><center><small>D1</small></center>
                <button class="btn-r" onclick="send({type:'X', count:1})">X</button>
                <button class="btn-r" onclick="send({type:'X', count:2})">XX</button>
                <button class="btn-r" onclick="send({type:'X', count:3})">XXX</button>
            </div>
            <div><center><small>D2</small></center>
                <button class="btn-r" onclick="send({type:'X', count:1})">X</button>
                <button class="btn-r" onclick="send({type:'X', count:2})">XX</button>
                <button class="btn-r" onclick="send({type:'X', count:3})">XXX</button>
            </div>
        </div>

        <h3>RUNDY (D≈πWIƒòK)</h3>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px">
            <button class="btn-y" onclick="playRunda(1)">R1</button>
            <button class="btn-y" onclick="playRunda(2)">R2</button>
            <button class="btn-y" onclick="playRunda(3)">R3</button>
            <button class="btn-y" onclick="playRunda(4)">R4</button>
        </div>
    </div>

    <div class="main">
        <div class="card">
            <h3>BAZA PYTA≈É (WYBIERZ ZESTAW)</h3>
            <select id="preset-sel" onchange="loadPreset()"></select>
            <textarea id="raw-data" rows="3"></textarea>
            <button onclick="setupNormal()" class="btn-y">WY≈öLIJ NA TABLICƒò</button>
            <div id="normal-btns" style="margin-top:10px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px;"></div>
        </div>

        <div class="card">
            <h3>TRYB FINA≈ÅOWY</h3>
            <button onclick="setupFinal()" class="btn-b">URUCHOM FINA≈Å NA TV</button>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-top:10px">
                <div>
                    <button class="btn-r" onclick="send({type:'TIMER', sec:15})">ZEGAR 15S</button>
                    <div id="p1-ui"></div>
                    <button onclick="send({type:'HIDE_P1'})" style="background:#555; color:#fff">UKRYJ HAS≈ÅA G1</button>
                </div>
                <div>
                    <button class="btn-r" onclick="send({type:'TIMER', sec:20})">ZEGAR 20S</button>
                    <div id="p2-ui"></div>
                </div>
            </div>
        </div>

        <div class="cheat-sheet">
            <h3>üìú ≈öCIƒÑGA DLA PROWADZƒÑCEGO (TOP ODPOWIEDZI)</h3>
            <div class="cheat-grid" id="cheat-grid"></div>
        </div>
        <button onclick="scoreL=0; scoreR=0; sync()" class="btn-r" style="width:200px; margin: 0 auto;">ZRESETUJ PUNKTY</button>
    </div>

    <script>
        const peer = new Peer();
        let conn, scoreL = 0, scoreR = 0;

        const roundPresets = [
            ["PIES,40\nKOT,30\nCHOMIK,15\nRYBKI,10\nKANAREK,5", "Zwierzƒô domowe"],
            ["OWOCE,45\nWARZYWA,25\nS≈ÅODYCZE,15\nMIƒòSO,10\nNABIA≈Å,5", "Co kupujemy w spo≈ºywczym?"],
            ["LATO,50\nZIMA,20\nWIOSNA,15\nJESIE≈É,15", "Ulubiona pora roku"],
            ["KAWA,50\nHERBATA,30\nWODA,15\nSOK,5", "Co pijemy rano?"],
            ["ROWER,40\nBIEGANIE,30\nP≈ÅYWANIE,20\nPI≈ÅKA NO≈ªNA,10", "Popularny sport"],
            ["POMIDOROWA,40\nROS√ì≈Å,35\nOG√ìRKOWA,15\n≈ªUREK,10", "Ulubiona zupa"],
            ["TELEFON,45\nKLUCZE,30\nPORTFEL,20\nCHUSTECZKI,5", "Co mamy w kieszeni?"],
            ["STYCZE≈É,40\nGRUDZIE≈É,30\nLIPIEC,20\nMAJ,10", "MiesiƒÖc"],
            ["KOMEDIA,40\nHORROR,30\nDRAMAT,20\nAKCJA,10", "Gatunek filmu"],
            ["WARSZAWA,50\nKRAK√ìW,25\nWROC≈ÅAW,15\nGDA≈ÉSK,10", "Polskie miasto"]
            // Tutaj mo≈ºesz dopisaƒá kolejne zestawy...
        ];

        const finalCheat = [
            {q: "OWOC", a: "JAB≈ÅKO (35), BANAN (22), GRUSZKA (18)"},
            {q: "ZAW√ìD NA L", a: "LEKARZ (42), LISTONOSZ (25), LAKIERNIK (12)"},
            {q: "CO≈ö DO PICIA", a: "WODA (38), SOK (24), KAWA (16)"},
            {q: "PA≈ÉSTWO NA A", a: "AUSTRIA (31), ALBANIA (18), ALGIERIA (10)"},
            {q: "DRZEWO", a: "DƒÑB (45), SOSNA (28), BRZOZA (15)"},
            {q: "CZƒò≈öƒÜ CIA≈ÅA", a: "G≈ÅOWA (40), RƒòKA (30), NOGA (20)"},
            {q: "INSTRUMENT", a: "GITARA (35), PIANINO (27), SKRZYPCE (14)"},
            {q: "RYBA", a: "KARP (48), REKIN (20), SZCZUPAK (15)"},
            {q: "KOLOR", a: "BIA≈ÅY (42), NIEBIESKI (30), CZERWONY (18)"},
            {q: "NA KANAPKƒò", a: "SER (36), SZYNKA (32), MAS≈ÅO (20)"}
        ];

        window.onload = () => {
            const sel = document.getElementById('preset-sel');
            roundPresets.forEach((p, i) => {
                let opt = document.createElement('option');
                opt.value = i; opt.innerText = p[1]; sel.appendChild(opt);
            });
            const cheat = document.getElementById('cheat-grid');
            finalCheat.forEach((item, i) => {
                cheat.innerHTML += `<div class="cheat-item"><b>${i+1}. ${item.q}:</b><br><span class="top-ans">${item.a}</span></div>`;
            });
        };

        function loadPreset() { const p = roundPresets[document.getElementById('preset-sel').value]; document.getElementById('raw-data').value = p[0]; }
        function connect() { conn = peer.connect(document.getElementById('target-id').value.toUpperCase()); conn.on('open', () => alert("PO≈ÅƒÑCZONO Z TV")); }
        function send(d) { if(conn) conn.send(d); }

        function playRunda(n) { send({type:'PLAY_SND', id:'snd-runda'}); }
        function playFinal() { send({type:'PLAY_SND', id:'snd-final'}); }

        function sync() {
            document.getElementById('lScore').innerText = scoreL;
            document.getElementById('rScore').innerText = scoreR;
            send({type:'SCORE_SYNC', l: scoreL, r: scoreR});
        }

        function setupNormal() {
            const lines = document.getElementById('raw-data').value.split('\n');
            const ans = lines.map(l => ({ t: l.split(',')[0], p: parseInt(l.split(',')[1]) || 0 }));
            send({type:'SETUP_NORMAL', ans: ans});
            document.getElementById('normal-btns').innerHTML = ans.map((a, i) => `
                <div style="background:#444; padding:5px; border-radius:4px; display:flex; justify-content:space-between; align-items:center;">
                    <span style="font-size:10px">${a.t} (${a.p})</span>
                    <button onclick="rev(${i},'${a.t}',${a.p})" class="btn-b" style="width:30px; margin:0; padding:2px">OK</button>
                </div>`).join('');
        }

        function rev(idx, t, p) {
            send({type:'REV', mode:'normal', idx:idx, t:t, p:p});
            let team = document.querySelector('input[name="active-team"]:checked').value;
            if(team === 'L') scoreL += p; else scoreR += p;
            sync();
        }

        function setupFinal() {
            send({type:'SETUP_FINAL'});
            const gen = (pid) => {
                let h = '';
                for(let i=0; i<5; i++) h += `<div style="display:flex; gap:2px; margin-bottom:2px">
                    <input id="p${pid}t${i}" placeholder="H" style="width:70px; font-size:10px">
                    <input id="p${pid}p${i}" placeholder="P" style="width:25px; font-size:10px">
                    <button onclick="revF(${pid},${i})" class="btn-b" style="width:30px; padding:2px">OK</button></div>`;
                document.getElementById(`p${pid}-ui`).innerHTML = h;
            };
            gen(1); gen(2);
        }

        function revF(pid, idx) {
            const t = document.getElementById(`p${pid}t${idx}`).value;
            const p = parseInt(document.getElementById(`p${pid}p${idx}`).value) || 0;
            send({type:'REV', mode:'final', player:pid, idx:idx, t:t, p:p});
            let team = document.querySelector('input[name="active-team"]:checked').value;
            if(team === 'L') scoreL += p; else scoreR += p;
            sync();
        }
    </script>
</body>
</html>
