<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>PANEL ADMINA</title>
    <script src="https://cdn.jsdelivr.net/npm/peerjs@1.3.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #222; color: white; padding: 20px; }
        .card { background: #333; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        input, button { padding: 10px; font-size: 16px; margin: 5px; }
        .ans-row { display: grid; grid-template-columns: 1fr 100px 100px; gap: 10px; margin-bottom: 5px; }
        button { cursor: pointer; background: #444; color: white; border: 1px solid #666; }
        button:hover { background: #555; }
        .btn-x { background: #900; }
        .btn-ok { background: #060; }
    </style>
</head>
<body>
    <div class="card">
        <input id="peer-id" placeholder="Wpisz KOD ID z tablicy">
        <button onclick="connect()">PO≈ÅƒÑCZ</button>
        <span id="conn-status">üî¥ Roz≈ÇƒÖczony</span>
    </div>

    <div class="card">
        <h3>1. Przygotuj pytania (oddzielone przecinkami)</h3>
        <textarea id="data-input" style="width:100%; height:60px;">SLASK,36, KASZUBY,27, PODHALE,17</textarea>
        <button onclick="sendReset()" class="btn-ok">WY≈öLIJ NA TABLICƒò (START)</button>
    </div>

    <div id="controls" class="card" style="display:none;">
        <h3>2. ZarzƒÖdzanie grƒÖ</h3>
        <div id="answer-btns"></div>
        <hr>
        <div style="display:flex; gap:20px;">
            <div>
                <h4>B≈Çƒôdy Lewa</h4>
                <button onclick="sendX('L',1)" class="btn-x">X</button>
                <button onclick="sendX('L',2)" class="btn-x">XX</button>
                <button onclick="sendX('L',3)" class="btn-x">XXX</button>
            </div>
            <div>
                <h4>B≈Çƒôdy Prawa</h4>
                <button onclick="sendX('R',1)" class="btn-x">X</button>
                <button onclick="sendX('R',2)" class="btn-x">XX</button>
                <button onclick="sendX('R',3)" class="btn-x">XXX</button>
            </div>
        </div>
        <hr>
        <h4>Suma punkt√≥w: <input type="number" id="manual-score" value="0" onchange="sendScore()"></h4>
    </div>

    <script>
        let peer = new Peer();
        let conn;
        let answers = [];

        function connect() {
            conn = peer.connect(document.getElementById('peer-id').value);
            conn.on('open', () => {
                document.getElementById('conn-status').innerText = "üü¢ Po≈ÇƒÖczono";
                document.getElementById('controls').style.display = 'block';
            });
        }

        function sendReset() {
            let raw = document.getElementById('data-input').value.split(',');
            answers = [];
            for(let i=0; i<raw.length; i+=2) {
                if(raw[i+1]) answers.push({t: raw[i].trim(), p: raw[i+1].trim()});
            }
            conn.send({type: 'RESET_BOARD', ans: answers});
            
            let html = '';
            answers.forEach((a, i) => {
                html += `<div class="ans-row"><span>${a.t} (${a.p})</span><button onclick="reveal(${i})">ODKRYJ</button></div>`;
            });
            document.getElementById('answer-btns').innerHTML = html;
        }

        function reveal(idx) {
            conn.send({type: 'REV', idx: idx, t: answers[idx].t, p: answers[idx].p});
            let s = document.getElementById('manual-score');
            s.value = parseInt(s.value) + parseInt(answers[idx].p);
            sendScore();
        }

        function sendX(side, n) { conn.send({type: 'X', side: side, n: n}); }
        function sendScore() { conn.send({type: 'SCORE', val: document.getElementById('manual-score').value}); }
    </script>
</body>
</html>
