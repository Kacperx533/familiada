<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>PANEL STEROWANIA - FAMILIADA PRO</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #1a1a1a; color: #ccc; padding: 20px; display: grid; grid-template-columns: 400px 1fr; gap: 20px; }
        .card { background: #2a2a2a; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-top: 3px solid #dfff00; }
        h3 { margin: 0 0 10px 0; color: #dfff00; font-size: 14px; text-transform: uppercase; border-bottom: 1px solid #444; padding-bottom: 5px; }
        
        button { width: 100%; padding: 10px; margin: 3px 0; border: none; cursor: pointer; border-radius: 4px; font-weight: bold; color:white; transition: 0.2s; }
        button:hover { opacity: 0.9; }
        
        .btn-gold { background: #dfff00; color: black; }
        .btn-blue { background: #0044cc; }
        .btn-red { background: #cc0000; }
        .btn-grey { background: #444; }
        .btn-media { background: #555; border-left: 5px solid orange; text-align: left; }

        input { background: #111; border: 1px solid #444; color: white; padding: 8px; width: 100%; box-sizing: border-box; }
        
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 5px; }

        .score-input { width: 60px; text-align: center; font-size: 16px; font-weight: bold; }
        
        #ans-box button { text-align: left; display: flex; justify-content: space-between; }
    </style>
</head>
<body>

    <div>
        <div class="card">
            <h3>1. Po≈ÇƒÖczenie</h3>
            <input id="tv-id" placeholder="Wpisz ID z ekranu TV">
            <button class="btn-gold" onclick="connect()" style="margin-top:5px;">PO≈ÅƒÑCZ</button>
        </div>

        <div class="card">
            <h3>2. Multimedia</h3>
            <button class="btn-media" onclick="sendVideo()">üé¨ WIDEO CZO≈Å√ìWKA</button>
            <div class="grid-2">
                <button class="btn-grey" onclick="sendSound('intro')">üéµ INTRO</button>
                <button class="btn-grey" onclick="sendSound('rep')">ü§î POWT√ìRZENIE</button>
                <button class="btn-grey" onclick="sendSound('ok')">‚úÖ DOBRA ODP</button>
                <button class="btn-grey" onclick="sendSound('bad')">‚ùå Z≈ÅA ODP</button>
            </div>
        </div>

        <div class="card">
            <h3>3. B≈Çƒôdy (Wska≈∫niki Boczne)</h3>
            <div class="grid-2">
                <div style="text-align:center; color:#44f; font-weight:bold;">NIEBIESCY (Lewa)</div>
                <div style="text-align:center; color:#f44; font-weight:bold;">CZERWONI (Prawa)</div>
            </div>
            <div class="grid-2">
                <div>
                    <button class="btn-blue" onclick="sideStrike('L', 1)">X</button>
                    <button class="btn-blue" onclick="sideStrike('L', 2)">XX</button>
                    <button class="btn-blue" onclick="sideStrike('L', 3)">XXX</button>
                </div>
                <div>
                    <button class="btn-red" onclick="sideStrike('R', 1)">X</button>
                    <button class="btn-red" onclick="sideStrike('R', 2)">XX</button>
                    <button class="btn-red" onclick="sideStrike('R', 3)">XXX</button>
                </div>
            </div>
            <button class="btn-grey" onclick="send({type:'CLEAR_STRIKES'})" style="margin-top:10px;">CZY≈öƒÜ WSZYSTKIE IKSY</button>
        </div>

        <div class="card">
            <h3>4. Rƒôczna Edycja Punkt√≥w</h3>
            <p style="font-size:12px; color:#888;">Zmie≈Ñ tutaj, je≈õli trzeba poprawiƒá wynik.</p>
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <span style="color:#44f">NIEBIESCY:</span>
                <input type="number" id="manual-s1" class="score-input" value="0">
            </div>
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <span style="color:#f44">CZERWONI:</span>
                <input type="number" id="manual-s2" class="score-input" value="0">
            </div>
            <button class="btn-gold" onclick="manualUpdate()">ZAPISZ I WY≈öLIJ NA TV</button>
        </div>
    </div>

    <div>
        <div class="card">
            <h3>5. Rozgrywka - Wyb√≥r Pytania</h3>
            <select id="q-sel" style="width:100%; padding:10px; background:#111; color:white; border:1px solid #444;" onchange="previewQ()"></select>
            <div class="grid-2" style="margin-top:10px;">
                <button class="btn-gold" onclick="loadRound()">ZA≈ÅADUJ RUNDƒò NA TV</button>
                <button class="btn-grey" onclick="nextRound()">CZY≈öƒÜ PLANSZƒò</button>
            </div>
        </div>

        <div class="card">
            <h3>AKTYWNA RUNDA</h3>
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <span>Suma Rundy: <b id="round-sum" style="color:gold; font-size:20px;">0</b></span>
                <div>
                    <label>Dla kogo pkt?</label>
                    <input type="radio" name="team" value="blue" checked onclick="activeTeam='blue'"> üîµ
                    <input type="radio" name="team" value="red" onclick="activeTeam='red'"> üî¥
                </div>
            </div>
            
            <div id="ans-box" class="grid-1" style="gap:5px;"></div>
        </div>
    </div>

    <script>
        // BAZA PYTA≈É
        const DB = [
            {q:"1. Co≈õ do smarowania chleba", a:[["MAS≈ÅO",35],["MARGARYNA",25],["SMALEC",15],["SEREK",10],["D≈ªEM",5]]},
            {q:"2. Zwierzƒô z rogami", a:[["BYK",40],["JELE≈É",30],["BARAN",20],["KOZA",10]]},
            {q:"3. Pojazd uprzywilejowany", a:[["KARETKA",45],["POLICJA",35],["STRA≈ª",20]]},
            {q:"4. Kolor tƒôczy", a:[["CZERWONY",30],["≈ª√ì≈ÅTY",20],["ZIELONY",15],["NIEBIESKI",10],["FIOLETOWY",5]]}
        ];

        let conn;
        const peer = new Peer();
        let s1 = 0, s2 = 0, roundSum = 0;
        let activeTeam = 'blue';

        window.onload = () => {
            const s = document.getElementById('q-sel');
            DB.forEach((x, i) => s.innerHTML += `<option value="${i}">${i+1}. ${x.q}</option>`);
            previewQ();
        };

        function connect() {
            conn = peer.connect(document.getElementById('tv-id').value);
            conn.on('open', () => alert("PO≈ÅƒÑCZONO!"));
        }

        // --- OBS≈ÅUGA GRY ---

        function previewQ() {
            // Tylko podglƒÖd w panelu, nie wysy≈Ça na TV
            const idx = document.getElementById('q-sel').value;
            const q = DB[idx];
            const box = document.getElementById('ans-box'); box.innerHTML = '';
            
            q.a.forEach((ans, i) => {
                const btn = document.createElement('button');
                btn.className = 'btn-grey';
                btn.innerHTML = `<span>${i+1}. ${ans[0]}</span> <b>${ans[1]}</b>`;
                btn.onclick = () => revealAnswer(i, ans[1], btn);
                box.appendChild(btn);
            });
        }

        function loadRound() {
            roundSum = 0; 
            updateDisplay();
            const idx = document.getElementById('q-sel').value;
            send({type: 'SETUP', ans: DB[idx].a.map(x => ({t: x[0], p: x[1]}))});
            previewQ(); // Prze≈Çadowuje przyciski, ≈ºeby by≈Çy aktywne
        }

        function nextRound() {
            roundSum = 0;
            updateDisplay();
            send({type:'SETUP', ans: []}); // Czy≈õci TV
        }

        function revealAnswer(idx, points, btn) {
            if(btn.style.background === 'green') return;
            
            roundSum += points;
            // Dodawanie punkt√≥w do globalnej puli dru≈ºyny (opcjonalne, tutaj dodajƒô tylko do rundy, a potem mo≈ºna przepisaƒá)
            // W Familiadzie punkty z rundy idƒÖ do dru≈ºyny DOPIERO na koniec. 
            // Ale dla uproszczenia dodajemy od razu do aktywnej:
            if(activeTeam === 'blue') s1 += points; else s2 += points;
            
            btn.style.background = 'green';
            send({type: 'REV', idx: idx});
            updateDisplay();
        }

        // --- OBS≈ÅUGA MULTIMEDI√ìW I B≈ÅƒòD√ìW ---

        function sideStrike(side, count) {
            // side: 'L' (Blue) lub 'R' (Red)
            // count: 1, 2, 3
            send({type: 'SIDE_STRIKE', side: side, count: count});
        }

        function sendSound(file) {
            send({type: 'SOUND', file: file});
        }

        function sendVideo() {
            send({type: 'VIDEO'});
        }

        // --- RƒòCZNA EDYCJA ---

        function updateDisplay() {
            document.getElementById('round-sum').innerText = roundSum;
            document.getElementById('manual-s1').value = s1;
            document.getElementById('manual-s2').value = s2;
            send({type: 'SCORE_UPDATE', s1: s1, s2: s2, sum: roundSum});
        }

        function manualUpdate() {
            // Pobiera warto≈õci z input√≥w i nadpisuje zmienne
            s1 = parseInt(document.getElementById('manual-s1').value);
            s2 = parseInt(document.getElementById('manual-s2').value);
            updateDisplay(); // Wysy≈Ça nowe warto≈õci na TV
        }

        function send(data) { if(conn) conn.send(data); }
    </script>
</body>
</html>
