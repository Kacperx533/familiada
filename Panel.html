<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>PANEL STEROWANIA - FAMILIADA</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #1a1a1a; color: #eee; padding: 20px; line-height: 1.6; }
        .container { max-width: 900px; margin: 0 auto; }
        .card { background: #2d2d2d; padding: 25px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #444; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        
        h3 { margin-top: 0; color: #eaff00; text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid #444; padding-bottom: 10px; }
        
        input, textarea { background: #1a1a1a; border: 1px solid #555; color: #fff; padding: 12px; border-radius: 6px; width: calc(100% - 26px); font-size: 16px; }
        button { padding: 12px 20px; font-size: 14px; font-weight: bold; text-transform: uppercase; border-radius: 6px; border: none; cursor: pointer; transition: 0.2s; margin: 5px; }
        
        .btn-connect { background: #eaff00; color: #000; width: 100%; font-size: 18px; }
        .btn-connect:hover { background: #c8d900; }
        
        .btn-reset { background: #28a745; color: white; width: 100%; margin-top: 10px; }
        .btn-reset:hover { background: #218838; }

        .ans-row { display: flex; justify-content: space-between; align-items: center; background: #3d3d3d; padding: 15px; margin-top: 10px; border-radius: 8px; border-left: 5px solid #eaff00; }
        .btn-reveal { background: #007bff; color: white; }
        .btn-reveal:hover { background: #0069d9; }

        .x-section { display: flex; justify-content: space-between; gap: 20px; margin-top: 15px; }
        .x-group { flex: 1; background: #333; padding: 15px; border-radius: 10px; text-align: center; }
        .btn-x { background: #dc3545; color: white; min-width: 50px; }
        .btn-x:hover { background: #c82333; }
        .btn-clear { background: #6c757d; color: white; }

        #conn-status { font-weight: bold; display: inline-block; margin-left: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h3>1. Po≈ÇƒÖczenie z TablicƒÖ</h3>
            <div style="display: flex; align-items: center;">
                <input id="peer-id" placeholder="Wpisz KOD ID wy≈õwietlony na tablicy">
                <button onclick="connect()" class="btn-connect" style="width: 200px; margin-left: 10px;">PO≈ÅƒÑCZ</button>
            </div>
            <p>Status: <span id="conn-status" style="color: #ff4444;">üî¥ ROZ≈ÅƒÑCZONY</span></p>
        </div>

        <div class="card">
            <h3>2. Przygotowanie Rundy</h3>
            <p style="font-size: 13px; color: #aaa;">Wpisz has≈Ça i punkty po przecinku (np. ≈öLƒÑSK, 36, KASZUBY, 27):</p>
            <textarea id="data-input">SLASK, 36, KASZUBY, 27, PODHALE, 17</textarea>
            <button onclick="sendReset()" class="btn-reset">WY≈öLIJ NA TABLICƒò I ZACZNIJ RUNDƒò</button>
        </div>

        <div id="controls" class="card" style="display:none;">
            <h3>3. Sterowanie GrƒÖ</h3>
            
            <div id="answer-btns">
                </div>

            <hr style="border: 0; border-top: 1px solid #444; margin: 25px 0;">

            <div class="x-section">
                <div class="x-group">
                    <h4>B≈ÅƒòDY LEWA</h4>
                    <button onclick="sendX('L', 1)" class="btn-x">X</button>
                    <button onclick="sendX('L', 2)" class="btn-x">XX</button>
                    <button onclick="sendX('L', 3)" class="btn-x">XXX</button>
                    <br>
                    <button onclick="sendX('L', 0)" class="btn-clear" style="margin-top:10px; width: 80%;">WYCZY≈öƒÜ</button>
                </div>
                <div class="x-group">
                    <h4>B≈ÅƒòDY PRAWA</h4>
                    <button onclick="sendX('R', 1)" class="btn-x">X</button>
                    <button onclick="sendX('R', 2)" class="btn-x">XX</button>
                    <button onclick="sendX('R', 3)" class="btn-x">XXX</button>
                    <br>
                    <button onclick="sendX('R', 0)" class="btn-clear" style="margin-top:10px; width: 80%;">WYCZY≈öƒÜ</button>
                </div>
            </div>

            <hr style="border: 0; border-top: 1px solid #444; margin: 25px 0;">
            
            <div style="text-align: center;">
                <h4>SUMA PUNKT√ìW W RUNDZIE</h4>
                <input type="number" id="manual-score" value="0" style="width: 150px; text-align: center; font-size: 24px; color: #eaff00;" onchange="sendScore()">
            </div>
        </div>
    </div>

    <script>
        const peer = new Peer();
        let conn;
        let answers = [];

        function connect() {
            const targetId = document.getElementById('peer-id').value.trim();
            if(!targetId) return alert("Wpisz ID!");
            
            conn = peer.connect(targetId);
            
            conn.on('open', () => {
                document.getElementById('conn-status').innerText = "üü¢ PO≈ÅƒÑCZONO";
                document.getElementById('conn-status').style.color = "#28a745";
                document.getElementById('controls').style.display = 'block';
            });

            conn.on('close', () => {
                document.getElementById('conn-status').innerText = "üî¥ ROZ≈ÅƒÑCZONY";
                document.getElementById('conn-status').style.color = "#ff4444";
            });
        }

        function sendReset() {
            if(!conn) return alert("Najpierw po≈ÇƒÖcz siƒô z tablicƒÖ!");
            
            let raw = document.getElementById('data-input').value.split(',');
            answers = [];
            for(let i=0; i<raw.length; i+=2) {
                if(raw[i] && raw[i+1]) {
                    answers.push({t: raw[i].trim(), p: raw[i+1].trim()});
                }
            }
            
            conn.send({type: 'RESET_BOARD', ans: answers});
            
            // Generuj przyciski sterowania has≈Çami
            let html = '';
            answers.forEach((a, i) => {
                html += `
                <div class="ans-row">
                    <span style="font-size: 18px;">${i+1}. <strong>${a.t}</strong> (${a.p} pkt)</span>
                    <button onclick="reveal(${i})" class="btn-reveal">ODKRYJ NA TABLICY</button>
                </div>`;
            });
            document.getElementById('answer-btns').innerHTML = html;
            document.getElementById('manual-score').value = 0;
            sendScore();
        }

        function reveal(idx) {
            conn.send({type: 'REV', idx: idx, t: answers[idx].t, p: answers[idx].p});
            
            // Automatyczne dodawanie punkt√≥w do sumy
            let scoreInput = document.getElementById('manual-score');
            scoreInput.value = parseInt(scoreInput.value) + parseInt(answers[idx].p);
            sendScore();
        }

        function sendX(side, n) {
            conn.send({type: 'X', side: side, n: n});
        }

        function sendScore() {
            conn.send({type: 'SCORE', val: document.getElementById('manual-score').value});
        }
    </script>
</body>
</html>
