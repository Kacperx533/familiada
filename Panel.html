<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>FAMILIADA - PANEL STEROWANIA</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #1a1a1a; color: #fff; padding: 20px; }
        .card { background: #2d2d2d; border: 1px solid #444; padding: 15px; border-radius: 12px; margin-bottom: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.3); }
        h3 { color: #f5b041; margin-top: 0; font-size: 13px; text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid #444; padding-bottom: 8px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .btn { border: none; padding: 12px; border-radius: 6px; font-weight: bold; cursor: pointer; color: #fff; background: #444; transition: 0.2s; }
        .btn:hover { background: #555; }
        .btn-gold { background: #f5b041; color: #000; }
        .btn-red { background: #e74c3c; }
        .active { outline: 3px solid #f5b041; box-shadow: 0 0 10px #f5b041; }
        input, select { width: 100%; padding: 10px; background: #000; color: #fff; border: 1px solid #444; margin: 5px 0; border-radius: 4px; box-sizing: border-box; }
        .f-row { display: grid; grid-template-columns: 3fr 1fr 1fr; gap: 5px; margin-bottom: 5px; background: #222; padding: 5px; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="card" id="conn-box">
        <h3>Po≈ÇƒÖczenie</h3>
        <input type="text" id="tv-id" placeholder="WPISZ KOD Z EKRANU TV">
        <button onclick="connect()" class="btn btn-gold" style="width:100%">PO≈ÅƒÑCZ Z TELEWIZOREM</button>
    </div>

    <div id="ui" style="display:none">
        <div class="card">
            <h3>Multimedia i Przej≈õcia</h3>
            <div class="grid">
                <button onclick="s({type:'PLAY_VIDEO', file:'czolowka.mp4'})" class="btn">üé¨ CZO≈Å√ìWKA</button>
                <button onclick="s({type:'PLAY_VIDEO', file:'napisy.mp4'})" class="btn">üé¨ NAPISY</button>
            </div>
            <div class="grid" style="margin-top:8px">
                <button onclick="setR(1)" class="btn">RUNDA x1</button>
                <button onclick="setR(2)" class="btn">RUNDA x2</button>
                <button onclick="setR(3)" class="btn">RUNDA x3</button>
                <button onclick="initF()" class="btn btn-gold">üî• START FINA≈ÅU</button>
            </div>
        </div>

        <div id="norm-ui">
            <div class="card">
                <h3>Rundy Normalne</h3>
                <select id="q-sel" onchange="prep()"></select>
                <button onclick="sendQ()" class="btn btn-gold" style="width:100%">WY≈öLIJ PYTANIE NA TV</button>
                <div id="ans-list" style="margin-top:10px"></div>
            </div>
            <div class="card">
                <h3>ZarzƒÖdzanie TablicƒÖ</h3>
                <div class="grid">
                    <button id="bA" onclick="team='A'; syncBtns()" class="btn active">DRU≈ªYNA A</button>
                    <button id="bB" onclick="team='B'; syncBtns()" class="btn">DRU≈ªYNA B</button>
                </div>
                <div class="grid" style="margin-top:8px">
                    <button onclick="doX()" class="btn btn-red" style="font-size:25px">‚úñ</button>
                    <button onclick="s({type:'RESET_X'})" class="btn">RESETUJ X</button>
                </div>
                <div class="grid" style="margin-top:10px">
                    <input type="number" id="scA" value="0" onchange="sync()">
                    <input type="number" id="scB" value="0" onchange="sync()">
                </div>
            </div>
        </div>

        <div id="final-ui" style="display:none">
            <div class="card" style="border: 1px solid #f5b041">
                <h3>Tryb Fina≈Çowy</h3>
                <select id="f-set-sel" onchange="loadFinalSet()"></select>
                <div class="grid" style="margin: 10px 0">
                    <button onclick="s({type:'FINAL_MODE', time:15}); curG=1;" class="btn btn-gold">GRACZ 1 (15S)</button>
                    <button onclick="s({type:'FINAL_MODE', time:20}); curG=2;" class="btn btn-gold">GRACZ 2 (20S)</button>
                </div>
                <button onclick="s({type:'START_TIMER'})" class="btn btn-red" style="width:100%">‚è± START STOPERA</button>
                <button onclick="s({type:'BUZZER'})" class="btn" style="width:100%; margin-top:5px">üîî D≈πWIƒòK POWT√ìRZENIA</button>
                <div id="f-inputs" style="margin-top:15px"></div>
                <button onclick="location.reload()" class="btn" style="width:100%; margin-top:10px">ZAKO≈ÉCZ FINA≈Å</button>
            </div>
        </div>
    </div>

    <script>
        const db = {
            norm: [
                {q:"Wiƒôcej ni≈º jedno zwierzƒô?", a:[["Owce",40],["Lama",25],["Stado",15],["Wataha",5]]},
                {q:"Przedmiot szkolny?", a:[["Matematyka",50],["Polski",30],["WF",20]]},
                {q:"Co robimy w lesie?", a:[["Spacerowaƒá",50],["Grzyby",30],["Biegaƒá",10]]},
                {q:"GorƒÖcy nap√≥j?", a:[["Herbata",55],["Kawa",30],["Kakao",10]]},
                {q:"Zimowy sport?", a:[["Narty",50],["≈Åy≈ºwy",30],["Skoki",15]]},
                {q:"Pieczywo?", a:[["Chleb",60],["Bu≈Çka",25],["Rogal",10]]},
                {q:"Zwierzƒô domowe?", a:[["Pies",55],["Kot",35],["Chomik",5]]},
                {q:"Co jest czerwone?", a:[["Pomidor",45],["Krew",30],["Serce",15]]},
                {q:"≈örodek transportu?", a:[["Auto",50],["PociƒÖg",25],["Samolot",15]]},
                {q:"Danie z jajek?", a:[["Jajecznica",65],["Omlet",20],["Sadzone",10]]}
            ],
            finSets: [
                {name:"Zestaw 1", q:["Zwierzƒô na K?","Rzecz w kuchni?","Kolor kwiat√≥w?","Marka auta?","Sport?"]},
                {name:"Zestaw 2", q:["Co≈õ s≈Çodkiego?","Pa≈Ñstwo w Europie?","Instrument?","Ptak?","Drzewo?"]},
                {name:"Zestaw 3", q:["Do pisania?","Miasto w Polsce?","Czƒô≈õƒá garderoby?","Owoc?","Imiƒô ≈ºe≈Ñskie?"]},
                {name:"Zestaw 4", q:["W ogrodzie?","Mebel w salonie?","P≈Çyn do picia?","Ryba?","Metal?"]},
                {name:"Zestaw 5", q:["Czƒô≈õƒá roweru?","Zaw√≥d medyczny?","Zupa?","Pora roku?","Kraj na N?"]},
                {name:"Zestaw 6", q:["Dzikie zwierzƒô?","Pogoda?","W ≈Çazience?","Waluta?","Muzyka?"]},
                {name:"Zestaw 7", q:["Na literƒô P?","Sprzƒôt AGD?","Telefon?","Malarz?","Planeta?"]},
                {name:"Zestaw 8", q:["W kinie?","Lekkoatletyka?","Buty?","Jezioro?","Pisarz?"]},
                {name:"Zestaw 9", q:["Ma ko≈Ça?","S≈Çynna wie≈ºa?","Kuzyn konia?","Przyprawa?","Rzeka?"]},
                {name:"Zestaw 10", q:["Bohater bajki?","≈öwieci?","Zamek?","Ze szk≈Ça?","Grzyb?"]}
            ]
        };

        let peer = new Peer(), conn, team = 'A', mult = 1, curA = [], curG = 1, fTot = 0, strikes = {A:0, B:0};

        function connect() {
            conn = peer.connect(document.getElementById('tv-id').value);
            conn.on('open', () => { 
                document.getElementById('conn-box').style.display='none'; 
                document.getElementById('ui').style.display='block';
                const s = document.getElementById('q-sel'); db.norm.forEach((d,i)=>s.innerHTML+=`<option value="${i}">${d.q}</option>`);
                const fs = document.getElementById('f-set-sel'); db.finSets.forEach((set,i)=>fs.innerHTML+=`<option value="${i}">${set.name}</option>`);
                loadFinalSet(); prep();
            });
        }

        const s = (m) => { if(conn && conn.open) conn.send(m); };
        function setR(r) { mult = r; s({type:'NEXT_ROUND'}); strikes={A:0,B:0}; }
        function initF() { document.getElementById('norm-ui').style.display='none'; document.getElementById('final-ui').style.display='block'; s({type:'FINAL_MODE', time:15}); }
        function loadFinalSet() {
            const qs = db.finSets[document.getElementById('f-set-sel').value].q;
            const fins = document.getElementById('f-inputs'); fins.innerHTML = "";
            for(let i=0; i<5; i++) fins.innerHTML += `<div class="f-row"><input id="fa${i}" placeholder="${qs[i]}"><input id="fp${i}" type="number" style="width:45px"><button onclick="revF(${i})" class="btn" style="width:40px;margin:0;padding:5px">OK</button></div>`;
        }
        function prep() {
            const d = db.norm[document.getElementById('q-sel').value]; curA = d.a;
            const l = document.getElementById('ans-list'); l.innerHTML = "";
            d.a.forEach((a,i)=>l.innerHTML+=`<div style="display:flex;justify-content:space-between;background:#222;padding:8px;margin-bottom:4px;border-radius:4px"><span>${a[0]} (${a[1]})</span><button onclick="rev(${i})" class="btn" style="width:60px;margin:0;padding:5px">OK</button></div>`);
        }
        function sendQ() { s({type:'SETUP', a: curA.map(x=>({t:x[0], p:x[1]}))}); s({type:'RESET_X'}); strikes={A:0,B:0}; }
        function rev(i) { let p = curA[i][1]*mult; let e = document.getElementById('sc'+team); e.value = parseInt(e.value)+p; sync(); s({type:'REVEAL', index:i, total: getSum()}); }
        function doX() { if(strikes[team]<3) { strikes[team]++; s({type:'STRIKE', team:team, num:strikes[team]}); } }
        function getSum() { return parseInt(document.getElementById('scA').value)+parseInt(document.getElementById('scB').value); }
        function sync() { s({type:'UPDATE', sc: getSum()}); }
        function syncBtns() { document.getElementById('bA').className = 'btn '+(team=='A'?'active':''); document.getElementById('bB').className = 'btn '+(team=='B'?'active':''); }
        function revF(i) { let p = parseInt(document.getElementById('fp'+i).value)||0; fTot += p; s({type:'FINAL_REVEAL', gracz:curG, index:i, ans:document.getElementById('fa'+i).value, pts:p, total:fTot}); }
    </script>
</body>
</html>
