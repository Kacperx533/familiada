<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>PANEL STEROWANIA</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #111; color: #fff; padding: 10px; }
        .card { background: #222; padding: 15px; border-radius: 10px; margin-bottom: 10px; border: 1px solid #444; }
        .btn { border: none; padding: 12px; border-radius: 5px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 5px; color: white; }
        .btn-gold { background: #f5b041; color: #000; }
        .btn-red { background: #d35400; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; }
        input, select { width: 100%; padding: 10px; margin: 5px 0; background: #000; color: #fff; border: 1px solid #444; box-sizing: border-box; }
        .active { outline: 3px solid #f5b041; }
    </style>
</head>
<body>
    <div class="card">
        <input type="text" id="tv-id" placeholder="KOD TV">
        <button onclick="connect()" class="btn btn-gold">POŁĄCZ</button>
    </div>

    <div id="ctrl" style="display:none">
        <div class="card">
            <div class="grid">
                <button onclick="s({type:'PLAY_VIDEO', file:'czolowka.mp4'})" class="btn">CZOŁÓWKA</button>
                <button onclick="s({type:'PLAY_VIDEO', file:'napisy.mp4'})" class="btn">NAPISY</button>
            </div>
            <div class="grid">
                <button onclick="setR(1)" class="btn">x1</button>
                <button onclick="setR(2)" class="btn">x2</button>
                <button onclick="setR(3)" class="btn">x3</button>
                <button onclick="goFinal()" class="btn btn-gold">FINAŁ</button>
            </div>
        </div>

        <div id="norm">
            <div class="card">
                <select id="q-sel" onchange="prep()"></select>
                <button onclick="sendQ()" class="btn btn-gold">WYŚLIJ PYTANIE</button>
                <div id="ans-list"></div>
            </div>
            <div class="card">
                <div class="grid">
                    <button id="bA" onclick="setT('A')" class="btn active">TEAM A</button>
                    <button id="bB" onclick="setT('B')" class="btn">TEAM B</button>
                </div>
                <div class="grid">
                    <button onclick="doX()" class="btn btn-red" style="font-size:30px">✖</button>
                    <button onclick="s({type:'RESET_X'})" class="btn">RESET X</button>
                </div>
                <div class="grid">
                    <input type="number" id="scA" value="0" onchange="sync()">
                    <input type="number" id="scB" value="0" onchange="sync()">
                </div>
            </div>
        </div>

        <div id="fin" style="display:none">
            <div class="card">
                <div class="grid">
                    <button onclick="s({type:'FINAL_MODE', time:15}); curG=1;" class="btn btn-gold">GRACZ 1 (15s)</button>
                    <button onclick="s({type:'FINAL_MODE', time:20}); curG=2;" class="btn btn-gold">GRACZ 2 (20s)</button>
                </div>
                <button onclick="s({type:'START_TIMER'})" class="btn btn-red">START CZASU</button>
                <button onclick="s({type:'BUZZER'})" class="btn">POWTÓRZENIE (BUZZ)</button>
                <div id="f-ins"></div>
                <button onclick="location.reload()" class="btn">KONIEC FINAŁU (RESET)</button>
            </div>
        </div>
    </div>

    <script>
        const db = {
            norm: [
                { q: "Więcej niż jedno zwierzę?", a: [["Owce", 40], ["Lama", 25], ["Stado", 15]] },
                { q: "Przedmiot szkolny?", a: [["Matematyka", 50], ["Polski", 30], ["WF", 20]] }
            ],
            fin: [
                "Zwierzę na K?", "Rzecz w kuchni?", "Kolor kwiatów?", "Marka auta?", "Dyscyplina sportu?"
            ]
        };

        let peer = new Peer(), conn, team = 'A', mult = 1, curA = [], curG = 1, fTot = 0, strikes = {A:0, B:0};

        function connect() {
            conn = peer.connect(document.getElementById('tv-id').value);
            conn.on('open', () => { 
                document.getElementById('ctrl').style.display='block';
                const sel = document.getElementById('q-sel');
                db.norm.forEach((d,i) => sel.innerHTML += `<option value="${i}">${d.q}</option>`);
                let fins = document.getElementById('f-ins');
                for(let i=0; i<5; i++) fins.innerHTML += `<div class="grid"><input id="fa${i}" placeholder="${db.fin[i]}"><input id="fp${i}" type="number" style="width:50px"><button onclick="revF(${i})" class="btn" style="width:40px">OK</button></div>`;
                prep();
            });
        }

        function s(m) { if(conn) conn.send(m); }
        function setR(r) { mult = r; s({type:'NEXT_ROUND'}); strikes={A:0, B:0}; }
        function goFinal() { document.getElementById('norm').style.display='none'; document.getElementById('fin').style.display='block'; s({type:'FINAL_MODE', time:15}); }
        function prep() {
            const d = db.norm[document.getElementById('q-sel').value]; curA = d.a;
            const l = document.getElementById('ans-list'); l.innerHTML = "";
            d.a.forEach((a, i) => l.innerHTML += `<div class="grid"><span>${a[0]}</span><button onclick="rev(${i})" class="btn btn-gold" style="width:60px">OK</button></div>`);
        }
        function sendQ() { s({type:'SETUP', a: curA.map(x=>({t:x[0], p:x[1]}))}); }
        function rev(i) {
            let pts = curA[i][1] * mult;
            let el = document.getElementById('sc'+team); el.value = parseInt(el.value) + pts;
            sync(); s({type:'REVEAL', index:i, total: document.getElementById('scA').value*1 + document.getElementById('scB').value*1});
        }
        function doX() { if(strikes[team]<3) { strikes[team]++; s({type:'STRIKE', team: team, num: strikes[team]}); } }
        function setT(t) { team = t; document.getElementById('bA').className = 'btn '+(t=='A'?'active':''); document.getElementById('bB').className = 'btn '+(t=='B'?'active':''); }
        function sync() { let val = document.getElementById('scA').value*1 + document.getElementById('scB').value*1; s({type:'UPDATE', sc: val}); }
        function revF(i) {
            let p = parseInt(document.getElementById('fp'+i).value) || 0;
            fTot += p;
            s({type:'FINAL_REVEAL', gracz: curG, index: i, ans: document.getElementById('fa'+i).value, pts: p, total: fTot});
        }
    </script>
</body>
</html>
